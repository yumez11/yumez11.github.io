(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{129:function(t,e){"use strict";e.__esModule=!0,e.default=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},130:function(t,e,a){"use strict";e.__esModule=!0;var i=function(t){return t&&t.__esModule?t:{default:t}}(a(140));e.default=function(){function t(t,e){for(var a,n=0;n<e.length;n++)(a=e[n]).enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),(0,i.default)(t,a.key,a)}return function(e,a,i){return a&&t(e.prototype,a),i&&t(e,i),e}}()},147:function(t,e,a){a(148),t.exports=a(2).Math.log10},148:function(t,e,a){var i=a(17);i(i.S,"Math",{log10:function(t){return Math.log(t)*Math.LOG10E}})},171:function(t,e,a){t.exports={default:a(147),__esModule:!0}},172:function(t,e,a){var i=a(265);i.__esModule&&(i=i.default),"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);(0,a(4).default)("a9bef350",i,!0,{})},173:function(t,e,a){var i=a(267);i.__esModule&&(i=i.default),"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);(0,a(4).default)("02abbc69",i,!0,{})},174:function(t,e,a){var i=a(269);i.__esModule&&(i=i.default),"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);(0,a(4).default)("799ef69c",i,!0,{})},262:function(t,e,a){t.exports=a.p+"media/adiou--audio.mp3"},264:function(t,e,a){"use strict";var i=a(172);a.n(i)},265:function(t,e,a){(t.exports=a(3)(!1)).push([t.i,".test-area[data-v-7140d01f]{height:350px;width:600px;background:#fff;border-radius:6px;position:relative;display:flex;flex-direction:column}.test-area .top-title[data-v-7140d01f]{width:100%;height:30px;background:#3cc2ff;color:#fff;border-top-left-radius:5px;border-top-right-radius:5px;line-height:30px;padding:0 22px;display:flex;justify-content:space-between}.test-area .top-title .mark[data-v-7140d01f]{display:inline-block;height:12px;width:5px;background:#fff;margin-right:10px;margin-top:1px;border-radius:3px}.test-area .top-title i[data-v-7140d01f]{cursor:pointer}.test-area .body[data-v-7140d01f]{flex:1;display:flex;justify-content:center;align-items:center;flex-direction:column;padding:30px 46px}.test-area .body .confirm-btn[data-v-7140d01f]{height:30px;line-height:30px;padding:0;width:100px;background:#01c4ff;border-radius:15px;border-color:#01c4ff;font-size:1.4rem;box-shadow:0 4px 10px 0 rgba(60,194,255,.65)}.test-area .body .confirm-btn.not-clear[data-v-7140d01f]{background:#fff;color:#3cc2ff}.test-area .body canvas[data-v-7140d01f]{margin-top:20px}.test-area .body i[data-v-7140d01f]{font-size:72px;color:#ffb512}",""])},266:function(t,e,a){"use strict";var i=a(173);a.n(i)},267:function(t,e,a){(t.exports=a(3)(!1)).push([t.i,".loading-wrapper[data-v-7c306d00]{overflow:hidden;position:absolute;width:100%;height:80%;left:0;top:10%;z-index:9991;background:#fff;display:flex;justify-content:center;align-items:center}.loading-text[data-v-7c306d00]{font-family:sans-serif;font-size:26px;color:#666;vertical-align:top;line-height:100px;animation:fadein-data-v-7c306d00 .75s ease-out}.loading-img[data-v-7c306d00]{width:100px;margin:15px -10px;display:inline-block;vertical-align:middle;animation:increase-data-v-7c306d00 .5s ease-out}@keyframes fadein-data-v-7c306d00{0%{opacity:0}to{opacity:1}}@keyframes increase-data-v-7c306d00{0%{opacity:0;width:0;margin:52px 40px}to{opacity:1;width:100px;margin:15px -10px}}",""])},268:function(t,e,a){"use strict";var i=a(174);a.n(i)},269:function(t,e,a){(t.exports=a(3)(!1)).push([t.i,".wrapper[data-v-75b40b92]{display:flex;flex-direction:column;width:100%;height:100%}.wrapper .check-main[data-v-75b40b92]{flex:1;display:flex;align-items:center;flex-direction:column;margin-top:150px}.wrapper .check-main .exam-table[data-v-75b40b92]{width:556px;border:1px solid #cecece;border-radius:6px;color:#333}.wrapper .check-main .exam-table .row[data-v-75b40b92]{display:flex}.wrapper .check-main .exam-table .row .column[data-v-75b40b92]{height:45px;line-height:45px}.wrapper .check-main .exam-table .row .left-column[data-v-75b40b92]{width:30%;text-align:right;padding-right:10px;border-right:1px solid #cecece}.wrapper .check-main .exam-table .row .right-column[data-v-75b40b92]{width:70%;padding-left:10px;text-align:left}.wrapper .check-main .bottom-btn[data-v-75b40b92]{margin-top:50px}.wrapper .check-main .bottom-btn .btn[data-v-75b40b92]{height:32px;line-height:32px;padding:0;width:170px;background:#ffb512;box-shadow:0 4px 6px 0 #f0e2c4;border-radius:15px;border-color:#ffb512;font-size:1.4rem}.wrapper .check-main .bottom-btn .btn.headset[data-v-75b40b92]{background:#3cc2ff;border-color:#3cc2ff;box-shadow:0 4px 6px 0 #c0f0ff}.wrapper .mask-wrapper[data-v-75b40b92]{display:flex;justify-content:center;align-items:center}",""])},353:function(t,e,a){"use strict";a.r(e);var i=a(119),n=a.n(i),o=a(122),r=a(133),s={name:"voice-check",props:{close:{type:Function,default:function(){}}},data:function(){return{step:1,audio:null,animationFrameId:null,isNotClear:!1,recorder:null,isDeviceReady:!0,recording:!1,checkResult:null,audioCtx:null}},methods:{testHeadset:function(){var t=this;this.audio=new Audio,this.audio.src="static/kanong.mp3",this.audio.play(),this.$nextTick((function(){t.analysisVoice(t.audio)}))},closeTest:function(){this.audioCtx&&this.audioCtx.close(),this.recorder&&this.recorder.closeAudioContext(),this.audio.pause(),this.close()},stopAudioAndAnimation:function(){if(this.audio&&this.animationFrameId){this.audio.pause(),cancelAnimationFrame(this.animationFrameId);var t=document.getElementById("canvas");this.initCanvasWaves(t)}},notClear:function(){this.isNotClear=!0,this.stopAudioAndAnimation()},isClear:function(){var t=this;this.stopAudioAndAnimation(),this.step=2,this.$nextTick((function(){t.checkMic()}))},reTest:function(){this.isNotClear=!1,this.testHeadset()},checkMic:function(){var t=this;this.recording=!0,this.recorder.checkDevice(10);var e=document.getElementById("micCanvas");this.recorder.on("audioprocess",(function(a){t.paintCanvasWaves(e,a)})),this.recorder.on("checkEnd",(function(a){t.recording=!1,t.checkResult=!!a,t.initCanvasWaves(e)}))},initRecorder:function(){var t=this;this.recorder||(this.recorder=new r.a,this.recorder.on("ready",(function(){var e=t.recorder;t.isDeviceReady=e.supported,e.supported&&t.listenDeviceChange()})))},listenDeviceChange:function(){var t=this;this.recorder.on("devicechange",(function(){t.$notify({title:"警告",message:"检测到音频设备发生了变化，需要重新初始化音频环境！",type:"warning"}),t.recorder=t.recorder.destroy(),t.initRecorder()}))},analysisVoice:function(t){this.audioCtx=new AudioContext;var e=this.audioCtx.createAnalyser();this.audioCtx.createMediaElementSource(t).connect(e),e.connect(this.audioCtx.destination),e.fftSize=512;var a=document.getElementById("canvas"),i=this;!function t(){console.log("run"),i.animationFrameId=requestAnimationFrame(t);var n=new Uint8Array(e.frequencyBinCount);e.getByteFrequencyData(n),i.paintCanvasWaves(a,n)}()},paintCanvasWaves:function(t,e){var a=Math.floor;if(t&&e&&!(0>=e.length)){var i=t.getContext("2d"),n=t.width,o=t.height,r=a(n/13),s=a(e.length/r);i.clearRect(0,0,n,o),i.beginPath(),i.fillStyle="#3CC2FF";for(var c,d=0;d<r;d++)c=e[d*s],i.fillRect(13*d,c*(o/256),5,60);i.fill(),i.closePath()}},initCanvasWaves:function(t){for(var e=[],a=0;256>a;a++)e.push(0);this.paintCanvasWaves(t,e)}},mounted:function(){this.testHeadset(),this.initRecorder()}},c=(a(264),a(15)),d=Object(c.a)(s,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"test-area"},[a("div",{staticClass:"top-title"},[t._m(0),t._v(" "),a("i",{staticClass:"iconfont iconchahao",on:{click:function(){return t.closeTest()}}})]),t._v(" "),1===t.step?a("div",{staticClass:"body"},[a("div",[t._v("您能清晰听到这段语音吗？")]),t._v(" "),t._m(1),t._v(" "),a("div",{staticClass:"margin-t-10"},[t._v("如果正常听到声音，请点击“清晰”按钮 ，如果不能清晰听到声音，请检查耳机和话筒设备。")]),t._v(" "),a("canvas",{attrs:{id:"canvas",width:"400",height:"70"}}),t._v(" "),t.isNotClear?t._e():a("div",{staticStyle:{"margin-top":"40px"}},[a("el-button",{staticClass:"confirm-btn",attrs:{type:"primary"},on:{click:function(){return t.isClear()}}},[t._v("清晰")]),t._v(" "),a("el-button",{staticClass:"confirm-btn not-clear",attrs:{type:"primary"},on:{click:function(){return t.notClear()}}},[t._v("不清晰")])],1),t._v(" "),t.isNotClear?a("div",{staticStyle:{"margin-top":"40px"}},[a("el-button",{staticClass:"confirm-btn",attrs:{type:"primary"},on:{click:function(){return t.reTest()}}},[t._v("重新检测")])],1):t._e()]):t._e(),t._v(" "),2!==t.step||t.isDeviceReady?t._e():a("div",{staticClass:"body"},[a("div",[t._v("初始化麦克风设备失败，请检查1、是否禁用麦克风权限；2、是否禁用音频设备。")])]),t._v(" "),2===t.step&&t.isDeviceReady?a("div",{staticClass:"body"},[a("div",{staticClass:"margin-t-10"},[t._v("请说出一段话，测试麦克风功能。")]),t._v(" "),a("canvas",{attrs:{id:"micCanvas",width:"400",height:"70"}}),t._v(" "),t.recording||t.checkResult?t._e():a("i",{staticClass:"iconfont iconsadness"}),t._v(" "),t.recording||t.checkResult?t._e():a("div",{staticStyle:{"margin-top":"-6px"}},[t._v("没有声音！")]),t._v(" "),!t.recording&&t.checkResult?a("i",{staticClass:"iconfont iconsmile"}):t._e(),t._v(" "),!t.recording&&t.checkResult?a("div",{staticStyle:{"margin-top":"-6px"}},[t._v("录音正常！")]):t._e(),t._v(" "),t.recording||t.checkResult?t._e():a("div",{staticStyle:{"margin-top":"20px"}},[a("el-button",{staticClass:"confirm-btn",attrs:{type:"primary"},on:{click:function(){return t.checkMic()}}},[t._v("重新检测")])],1),t._v(" "),!t.recording&&t.checkResult?a("div",{staticStyle:{"margin-top":"20px"}},[a("el-button",{staticClass:"confirm-btn",attrs:{type:"primary"},on:{click:function(){return t.closeTest()}}},[t._v("确认")])],1):t._e()]):t._e()])}),[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("span",{staticClass:"mark"}),a("span",[t._v("耳机麦克风测试")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("audio",{attrs:{src:a(262),autoplay:""}})])}],!1,null,"7140d01f",null).exports,l=a(7),u=a(126),p=a(101),f={name:"loading",components:{TopBar:o.a}},m=(a(266),Object(c.a)(f,(function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)}),[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"loading-wrapper"},[a("img",{staticClass:"loading-img",attrs:{src:"static/loading.gif"}}),t._v(" "),a("span",{staticClass:"loading-text"},[t._v("加载试卷中...")])])}],!1,null,"7c306d00",null).exports),v=new(a(1).a),h={name:"voice-check",components:{TopBar:o.a,VoiceCheck:d,Loading:m},computed:n()({},Object(l.c)("Common",["studentInfo"]),Object(l.c)("Exam",["examInfo"])),data:function(){return{showTest:!1,loadingPaper:!1,defaultPath:"",stuanser:"",examCategory:null,query:{value:{},examInfo:{},studentInfo:{},batchInfo:{}}}},methods:n()({},Object(l.b)("Exam",["set_paper_json","set_exam_info","change_subject_order","set_paper_group_id"]),{startExam:function(){var t=this;u.a.getPaperUrl({userId:this.studentInfo.userId,examId:this.$route.query.examInfo.examId,batchId:this.$route.query.batchInfo.id}).then((function(e){if(0===e.code){if(t.loadingPaper=!0,t.set_paper_group_id(e.paperGroupId||null),p.ipcRenderer.send("download-exam-data",{url:e.result.url,urls:e.result.urls,userId:t.studentInfo.userId,studentanser:e.result.studentanser,paperId:e.paperId,paperIds:e.paperIds,examId:t.$route.query.examInfo.examId,stuPaperId:e.result.stuPaperId,questionsJson:e.result.questionsJson,paperType:e.result.paperType,currentTime:e.currentTime}),null==e.result.studentanser)return;t.stuanser=e.result.studentanser}else t.$notify.info({title:"提示",message:e.message})}))},formatDate:function(){this.$route.query.batchInfo.formatBeginTime=v.formatConversion(this.$route.query.batchInfo.beginTime),this.$route.query.batchInfo.formatEndTime=v.formatConversion(this.$route.query.batchInfo.endTime)},testHeadset:function(){this.showTest=!0},close:function(){this.showTest=!1},initIpc:function(){var t=this;p.ipcRenderer.on("download-exam-data-finished",(function(e,a,i,n,o){!1===o&&u.a.updateTestPaper({paper:n,stuInfo:i}),t.set_paper_json({data:a,order:t.$route.query.examInfo.subjectOrder}||null),t.$route.query.studentInfo.currentTime=i.currentTime,t.$router.push({path:"/exam",query:{studentanser:t.stuanser,batchInfo:t.$route.query.batchInfo,examInfo:t.$route.query.examInfo,studentInfo:t.$route.query.studentInfo}}),t.loadingPaper=!1})),p.ipcRenderer.on("download-exam-data-error",(function(){t.loadingPaper=!1,t.$notify.error({title:"错误",message:"试卷下载错误，请联系监考老师！"})}))}}),created:function(){var t=sessionStorage.getItem("examInfo"),e=JSON.parse(t);this.examCategory=e.examCategory,this.formatDate()},mounted:function(){this.query=this.$route.query,this.initIpc()}},b=(a(268),Object(c.a)(h,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"wrapper"},[a("top-bar"),t._v(" "),a("div",{staticClass:"check-main"},[a("div",{staticClass:"exam-table"},[a("div",{staticClass:"row",staticStyle:{"border-bottom":"1px solid #cecece"}},[a("div",{staticClass:"left-column column"},[t._v("当前批次：")]),t._v(" "),a("div",{staticClass:"right-column column"},[t._v("\n                    第 "+t._s(t.query.batchInfo.batchNo||"")+" 批次\n                ")])]),t._v(" "),a("div",{staticClass:"row",staticStyle:{"border-bottom":"1px solid #cecece"}},[a("div",{staticClass:"left-column column"},[t._v("试卷名称：")]),t._v(" "),a("div",{staticClass:"right-column column"},[t._v("\n                "+t._s(t.query.batchInfo.paperName||"")+"\n              ")])]),t._v(" "),a("div",{staticClass:"row",staticStyle:{"border-bottom":"1px solid #cecece"}},[a("div",{staticClass:"left-column column"},[t._v("考试准备时间：")]),t._v(" "),a("div",{staticClass:"right-column column"},[t._v("\n                    "+t._s(t.query.examInfo.prepareTime||"")+" 分钟\n                    ")])]),t._v(" "),a("div",{staticClass:"row",staticStyle:{"border-bottom":"1px solid #cecece"}},[a("div",{staticClass:"left-column column"},[t._v("考试时长：")]),t._v(" "),a("div",{staticClass:"right-column column"},[t._v("\n                    "+t._s(t.query.batchInfo.answerTimeSetting||"")+" 分钟\n                ")])]),t._v(" "),a("div",{staticClass:"row",staticStyle:{"border-bottom":"1px solid #cecece"}},[a("div",{staticClass:"left-column column"},[t._v("允许提前交卷时间：")]),t._v(" "),a("div",{staticClass:"right-column column"},[t._v("\n                    "+t._s(t.query.examInfo.finishTime||"-")+" 分钟\n                ")])]),t._v(" "),3===t.examCategory?t._e():a("div",{staticClass:"row",staticStyle:{"border-bottom":"1px solid #cecece"}},[a("div",{staticClass:"left-column column"},[t._v("开始时间：")]),t._v(" "),a("div",{staticClass:"right-column column"},[t._v("\n                    "+t._s(t.query.batchInfo.formatBeginTime||"-")+"\n                ")])]),t._v(" "),3===t.examCategory?t._e():a("div",{staticClass:"row"},[a("div",{staticClass:"left-column column"},[t._v("结束时间：")]),t._v(" "),a("div",{staticClass:"right-column column"},[t._v("\n                    "+t._s(t.query.batchInfo.formatEndTime||"-")+"\n                ")])])]),t._v(" "),a("div",{staticClass:"bottom-btn"},[a("el-button",{staticClass:"btn headset",attrs:{type:"primary"},on:{click:function(){return t.testHeadset()}}},[t._v("耳机测试")]),t._v(" "),a("el-button",{staticClass:"btn",attrs:{type:"primary"},on:{click:function(){return t.startExam()}}},[t._v("开始考试")])],1)]),t._v(" "),t.showTest?a("div",{staticClass:"mask-wrapper"},[a("VoiceCheck",{attrs:{close:t.close}})],1):t._e(),t._v(" "),t.loadingPaper?a("Loading"):t._e()],1)}),[],!1,null,"75b40b92",null));e.default=b.exports}}]);