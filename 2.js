(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{120:function(e,t,a){var s=a(124);s.__esModule&&(s=s.default),"string"==typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);(0,a(4).default)("255b05f0",s,!0,{})},122:function(e,t,a){"use strict";var s=a(119),n=a.n(s),r=a(101),i=a(7),o=a(104),_=a.n(o),l={name:"exam-top-bar",props:{leftTime:Number,required:!0},computed:n()({},Object(i.c)("Common",["studentInfo"])),data:function(){return{name:"",maxshow:!1,backColor:"iconshanchu1",timer:null,seatNo:1}},methods:{gitback:function(){(0===this.leftTime||void 0===this.leftTime)&&(this.backColor="iconshanchu2")},minmum:function(){r.ipcRenderer.send("min",!0)},close:function(){0===this.leftTime||void 0===this.leftTime?(this.backColor="iconshanchu2",r.ipcRenderer.send("reload",{})):console.log(this.leftTime)},max:function(){r.ipcRenderer.send("max"),this.maxshow=!0},unmax:function(){r.ipcRenderer.send("unmax"),this.maxshow=!1},debuges:function(){r.ipcRenderer.send("debug")},onClick:function(e){window.event.ctrlKey&&67===e.keyCode&&(e.returnValue=!1),116===e.keyCode&&(e.returnValue=!1)},initSeat:function(){var e=this;_.a.get("seat_config",(function(t,a){t&&console.log(t),a.seatNo&&(e.seatNo=a.seatNo)}))}},mounted:function(){var e=this;window.addEventListener("keydown",this.onClick),this.initSeat(),setInterval((function(){e.gitback()}),2e3)}},f=(a(123),a(15)),c=Object(f.a)(l,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"top-wrapper"},[a("div",{staticClass:"logo item"},[a("img",{attrs:{src:"static/img/logo.png"}}),e._v(" "),a("div",{staticClass:"seat-area"},[e._v("座位号："+e._s(e.seatNo))])]),e._v(" "),a("div",{staticClass:"right-area"},[a("div",{staticClass:"item"},[e._v("欢迎： "+e._s(e.studentInfo.studentName)+"同学 准考证号： "+e._s(e.studentInfo.userId)+"  IP地址： "+e._s(e.studentInfo.ip))])])])}),[],!1,null,"797cd628",null);t.a=c.exports},123:function(e,t,a){"use strict";var s=a(120);a.n(s)},124:function(e,t,a){(e.exports=a(3)(!1)).push([e.i,".top-wrapper[data-v-797cd628]{display:flex;justify-content:space-between;border-bottom:1px solid #e5e5e5;height:50px;line-height:50px;background-image:linear-gradient(-145deg,#6fe3ff,#3cc2ff);color:#fff;font-weight:700;padding:0 20px}.top-wrapper .logo[data-v-797cd628]{font-size:20px;display:flex;align-items:center}.top-wrapper .logo img[data-v-797cd628]{height:20px}.top-wrapper .iconshanchu1[data-v-797cd628]{color:#ccc;cursor:not-allowed}.top-wrapper .iconshanchu2[data-v-797cd628]{color:#fff;cursor:pointer}.top-wrapper .seat-area[data-v-797cd628]{font-size:22px;margin-left:20px}.top-wrapper .right-area[data-v-797cd628]{display:flex;font-size:16px}.top-wrapper .right-area .minmum[data-v-797cd628]{-webkit-app-region:no-drag;margin-left:20px;cursor:pointer}.top-wrapper .right-area .minmum .el-icon-full-screen[data-v-797cd628]:before,.top-wrapper .right-area .minmum[data-v-797cd628] .el-icon-refresh-left:before{font-weight:800;font-size:17px}",""])},126:function(e,t,a){"use strict";var s=a(127);t.a={login:function(e){return s.a.post("/exam/login",e)},logOut:function(e){return s.a.post("/exam/login/logout",e)},getPaperUrl:function(e){return s.a.get("/exam/paper",e)},heartbeat:function(e){return s.a.post("/exam/heartbeat",e)},submitPaper:function(e,t){return s.a.upload(e,"/exam/submit",t)},answerStatus:function(e){return s.a.post("/exam/status",e)},ping:function(){return s.a.get("/exam/ping",{})},getLatestVersion:function(){return s.a.get("/exam/version/getLatestVersion",{})},saveStatus:function(e){return s.a.post("/exam/saveStatus",e)},updateStuSeat:function(e){return s.a.post("/exam/updateStudentSeatNo",e)},getStuInfo:function(e){return s.a.get("/exam/getStuInfo",e)},updateTestPaper:function(e){return s.a.post("/exam/updateTestPaper",e)},uploadWavFile:function(e,t){return s.a.uploadWavFile(e,"/exam/uploadFile",t)}}},127:function(e,t,a){"use strict";function s(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"get",t=arguments[1],a=arguments[2],s=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},i=h()(s,[]),_=void 0!==i.needLoading&&i.needLoading,f=void 0!==i.needSuccessInfo&&i.needSuccessInfo,u=void 0!==i.needIntercept&&i.needIntercept,p=a?JSON.parse(c()(a)):a;e=e.toLowerCase();var d=_?S.Loading.service({lock:!0,text:"加载中...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}):null;return i.authId&&(!i.headers&&(i.headers={}),i.headers["x-auth-id"]=i.authId),new b.a((function(a,s){r().then((function(r){n(r),B(l()(o()({url:t,method:e},/^p/i.test(e)?"data":"params",p),i)).then((function(e){var t=e.data;return d&&d.close(),0!==t.code&&u?(S.Notification.closeAll(),Object(S.Notification)({title:"错误",dangerouslyUseHTMLString:!0,message:"错误码："+t.code+"<br/>错误信息："+t.message,type:"error",duration:3e3}),a(t)):(f&&(S.Notification.closeAll(),Object(S.Notification)({title:"成功",message:"操作成功",type:"success",duration:3e3})),a(t))})).catch((function(e){if(e.response&&u){var t=e.response.status;Object(S.Notification)({dangerouslyUseHTMLString:!0,title:"错误",message:"错误码："+t+"<br/>错误信息："+e.response.data.message,type:"error",duration:3e3}),d&&d.close()}return s(e)}))}))}))}function n(e){B.defaults.baseURL=e}function r(){return new b.a((function(e){A.a.get("teacher_config",(function(t,a){if(t)e("http://127.0.0.1:3000");else{var s="http://"+a.host+":"+a.port;e(s)}}))}))}var i=a(139),o=a.n(i),_=a(119),l=a.n(_),f=a(18),c=a.n(f),u=a(141),h=a.n(u),p=a(125),b=a.n(p),d=a(21),m=a.n(d),v=a(142),g=a.n(v),S=a(22),R=(a.n(S),a(104)),A=a.n(R),B=m.a.create({baseURL:"http://192.168.0.111:3000",withCredentials:!0,timeout:6e4,paramsSerializer:function(e){return g.a.stringify(e,{indices:!1})}});B.interceptors.request.use((function(e){return e.headers["x-from-site"]=process.env.VUE_APP_WEB_SITE_ID,e.headers["Content-Type"]="application/json;charset=UTF-8","get"===e.method&&(e.headers["If-Modified-Since"]="Mon, 26 Jul 1997 05:00:00 GMT",e.headers["Cache-Control"]="no-cache",e.headers.Pragma="no-cache"),e}),(function(e){b.a.reject(e)})),s.get=function(e,t,a){return s("get",e,t,a)},s.post=function(e,t,a){return s("post",e,t,a)},s.upload=function(e,t,a){return function(e,t,a){var s=a.userId,n=new FormData,i=new File([e],s+".zip",{type:"application/zip"});n.append("test",i),n.append("userId",s),n.append("examId",a.examId),n.append("batchId",a.batchId);var o={headers:{"Content-Type":"multipart/form-data"}};return new b.a((function(e,a){r().then((function(s){m.a.post(s+t,n,o).then((function(t){e(t.data)})).catch((function(e){a(e)}))}))}))}(e,t,a)},s.uploadWavFile=function(e,t,a){return function(e,t,a){var s=a.userId,n=a.fileName,i=new FormData,o=new File([e],n,{type:"audio/wav"});i.append("test",o),i.append("userId",s);var _={headers:{"Content-Type":"multipart/form-data"}};return new b.a((function(e,a){r().then((function(s){m.a.post(s+t,i,_).then((function(t){e(t.data)})).catch((function(e){a(e)}))}))}))}(e,t,a)},s.setBaseUrl=function(e){return n(e)},t.a=s},133:function(e,t,a){"use strict";function s(){function e(e){return new Int32Array(e)}function t(e){return new Float32Array(e)}function a(e){if(1==e.length)return t(e[0]);var s=e[0];e=e.slice(1);for(var n=[],r=0;r<s;r++)n.push(a(e));return n}function o(t){if(1==t.length)return e(t[0]);var a=t[0];t=t.slice(1);for(var s=[],n=0;n<a;n++)s.push(o(t));return s}function _(e){if(1==e.length)return Array(e[0]);var t=e[0];e=e.slice(1);for(var a=[],s=0;s<t;s++)a.push(_(e));return a}function l(e){this.ordinal=e}function f(e){this.ordinal=e}function c(e){this.ordinal=function(){return e}}function u(){this.getLameVersion=function(){return"3.98.4"},this.getLameShortVersion=function(){return"3.98.4"},this.getLameVeryShortVersion=function(){return"LAME3.98r"},this.getPsyVersion=function(){return"0.93"},this.getLameUrl=function(){return"http://www.mp3dev.org/"},this.getLameOsBitness=function(){return"32bits"}}function h(){function e(e,t,a,s,n,r){for(;0!=n--;)a[s]=1e-10+e[t+0]*r[0]-a[s-1]*r[1]+e[t-1]*r[2]-a[s-2]*r[3]+e[t-2]*r[4]-a[s-3]*r[5]+e[t-3]*r[6]-a[s-4]*r[7]+e[t-4]*r[8]-a[s-5]*r[9]+e[t-5]*r[10]-a[s-6]*r[11]+e[t-6]*r[12]-a[s-7]*r[13]+e[t-7]*r[14]-a[s-8]*r[15]+e[t-8]*r[16]-a[s-9]*r[17]+e[t-9]*r[18]-a[s-10]*r[19]+e[t-10]*r[20],++s,++t}function t(e,t,a,s,n,r){for(;0!=n--;)a[s]=e[t+0]*r[0]-a[s-1]*r[1]+e[t-1]*r[2]-a[s-2]*r[3]+e[t-2]*r[4],++s,++t}function a(e){return e*e}var s=h.RMS_WINDOW_TIME_NUMERATOR,n=h.RMS_WINDOW_TIME_DENOMINATOR,r=[[.038575994352,-3.84664617118067,-.02160367184185,7.81501653005538,-.00123395316851,-11.34170355132042,-9291677959e-14,13.05504219327545,-.01655260341619,-12.28759895145294,.02161526843274,9.4829380631979,-.02074045215285,-5.87257861775999,.00594298065125,2.75465861874613,.00306428023191,-.86984376593551,.00012025322027,.13919314567432,.00288463683916],[.0541865640643,-3.47845948550071,-.02911007808948,6.36317777566148,-.00848709379851,-8.54751527471874,-.00851165645469,9.4769360780128,-.00834990904936,-8.81498681370155,.02245293253339,6.85401540936998,-.02596338512915,-4.39470996079559,.01624864962975,2.19611684890774,-.00240879051584,-.75104302451432,.00674613682247,.13149317958808,-.00187763777362],[.15457299681924,-2.37898834973084,-.09331049056315,2.84868151156327,-.06247880153653,-2.64577170229825,.02163541888798,2.23697657451713,-.05588393329856,-1.67148153367602,.04781476674921,1.00595954808547,.00222312597743,-.45953458054983,.03174092540049,.16378164858596,-.01390589421898,-.05032077717131,.00651420667831,.0234789740702,-.00881362733839],[.30296907319327,-1.61273165137247,-.22613988682123,1.0797749225997,-.08587323730772,-.2565625775407,.03282930172664,-.1627671912044,-.00915702933434,-.22638893773906,-.02364141202522,.39120800788284,-.00584456039913,-.22138138954925,.06276101321749,.04500235387352,-828086748e-14,.02005851806501,.00205861885564,.00302439095741,-.02950134983287],[.33642304856132,-1.49858979367799,-.2557224142557,.87350271418188,-.11828570177555,.12205022308084,.11921148675203,-.80774944671438,-.07834489609479,.47854794562326,-.0046997791438,-.12453458140019,-.0058950022444,-.04067510197014,.05724228140351,.08333755284107,.00832043980773,-.04237348025746,-.0163538138454,.02977207319925,-.0176017656815],[.4491525660845,-.62820619233671,-.14351757464547,.29661783706366,-.22784394429749,-.372563729424,-.01419140100551,.00213767857124,.04078262797139,-.42029820170918,-.12398163381748,.22199650564824,.04097565135648,.00613424350682,.10478503600251,.06747620744683,-.01863887810927,.05784820375801,-.03193428438915,.03222754072173,.00541907748707],[.56619470757641,-1.04800335126349,-.75464456939302,.29156311971249,.1624213774223,-.26806001042947,.16744243493672,.00819999645858,-.18901604199609,.45054734505008,.3093178284183,-.33032403314006,-.27562961986224,.0673936833311,.00647310677246,-.04784254229033,.08647503780351,.01639907836189,-.0378898455484,.01807364323573,-.00588215443421],[.58100494960553,-.51035327095184,-.53174909058578,-.31863563325245,-.14289799034253,-.20256413484477,.17520704835522,.1472815413433,.02377945217615,.38952639978999,.15558449135573,-.23313271880868,-.25344790059353,-.05246019024463,.01628462406333,-.02505961724053,.06920467763959,.02442357316099,-.03721611395801,.01818801111503,-.00749618797172],[.53648789255105,-.2504987195602,-.42163034350696,-.43193942311114,-.00275953611929,-.03424681017675,.04267842219415,-.04678328784242,-.10214864179676,.26408300200955,.14590772289388,.15113130533216,-.02459864859345,-.17556493366449,-.11202315195388,-.18823009262115,-.04060034127,.05477720428674,.0478866554818,.0470440968812,-.02217936801134]],i=[[.98621192462708,-1.97223372919527,-1.97242384925416,.97261396931306,.98621192462708],[.98500175787242,-1.96977855582618,-1.97000351574484,.9702284756635,.98500175787242],[.97938932735214,-1.95835380975398,-1.95877865470428,.95920349965459,.97938932735214],[.97531843204928,-1.95002759149878,-1.95063686409857,.95124613669835,.97531843204928],[.97316523498161,-1.94561023566527,-1.94633046996323,.94705070426118,.97316523498161],[.96454515552826,-1.92783286977036,-1.92909031105652,.93034775234268,.96454515552826],[.96009142950541,-1.91858953033784,-1.92018285901082,.92177618768381,.96009142950541],[.95856916599601,-1.9154210807478,-1.91713833199203,.91885558323625,.95856916599601],[.94597685600279,-1.88903307939452,-1.89195371200558,.89487434461664,.94597685600279]];this.InitGainAnalysis=function(e,t){e:{for(var a=0;a<MAX_ORDER;a++)e.linprebuf[a]=e.lstepbuf[a]=e.loutbuf[a]=e.rinprebuf[a]=e.rstepbuf[a]=e.routbuf[a]=0;switch(0|t){case 48e3:e.reqindex=0;break;case 44100:e.reqindex=1;break;case 32e3:e.reqindex=2;break;case 24e3:e.reqindex=3;break;case 22050:e.reqindex=4;break;case 16e3:e.reqindex=5;break;case 12e3:e.reqindex=6;break;case 11025:e.reqindex=7;break;case 8e3:e.reqindex=8;break;default:t=INIT_GAIN_ANALYSIS_ERROR;break e}e.sampleWindow=0|(t*s+n-1)/n,e.lsum=0,e.rsum=0,e.totsamp=0,se.ill(e.A,0),t=INIT_GAIN_ANALYSIS_OK}return t==INIT_GAIN_ANALYSIS_OK?(e.linpre=MAX_ORDER,e.rinpre=MAX_ORDER,e.lstep=MAX_ORDER,e.rstep=MAX_ORDER,e.lout=MAX_ORDER,e.rout=MAX_ORDER,se.fill(e.B,0),INIT_GAIN_ANALYSIS_OK):INIT_GAIN_ANALYSIS_ERROR},this.AnalyzeSamples=function(s,n,o,_,l,f,c){if(0==f)return GAIN_ANALYSIS_OK;var u=0,p=f;switch(c){case 1:_=n,l=o;break;case 2:break;default:return GAIN_ANALYSIS_ERROR}for(f<MAX_ORDER?(ne.arraycopy(n,o,s.linprebuf,MAX_ORDER,f),ne.arraycopy(_,l,s.rinprebuf,MAX_ORDER,f)):(ne.arraycopy(n,o,s.linprebuf,MAX_ORDER,MAX_ORDER),ne.arraycopy(_,l,s.rinprebuf,MAX_ORDER,MAX_ORDER));0<p;){var b=p>s.sampleWindow-s.totsamp?s.sampleWindow-s.totsamp:p;if(u<MAX_ORDER){c=s.linpre+u;var d=s.linprebuf,m=s.rinpre+u,v=s.rinprebuf;b>MAX_ORDER-u&&(b=MAX_ORDER-u)}else c=o+u,d=n,m=l+u,v=_;e(d,c,s.lstepbuf,s.lstep+s.totsamp,b,r[s.reqindex]),e(v,m,s.rstepbuf,s.rstep+s.totsamp,b,r[s.reqindex]),t(s.lstepbuf,s.lstep+s.totsamp,s.loutbuf,s.lout+s.totsamp,b,i[s.reqindex]),t(s.rstepbuf,s.rstep+s.totsamp,s.routbuf,s.rout+s.totsamp,b,i[s.reqindex]),c=s.lout+s.totsamp,d=s.loutbuf,m=s.rout+s.totsamp,v=s.routbuf;for(var g=b%8;0!=g--;)s.lsum+=a(d[c++]),s.rsum+=a(v[m++]);for(g=b/8;0!=g--;)s.lsum+=a(d[c+0])+a(d[c+1])+a(d[c+2])+a(d[c+3])+a(d[c+4])+a(d[c+5])+a(d[c+6])+a(d[c+7]),c+=8,s.rsum+=a(v[m+0])+a(v[m+1])+a(v[m+2])+a(v[m+3])+a(v[m+4])+a(v[m+5])+a(v[m+6])+a(v[m+7]),m+=8;if(p-=b,u+=b,s.totsamp+=b,s.totsamp==s.sampleWindow&&((c=0>=(c=10*h.STEPS_per_dB*T()((s.lsum+s.rsum)/s.totsamp*.5+1e-37))?0:0|c)>=s.A.length&&(c=s.A.length-1),s.A[c]++,s.lsum=s.rsum=0,ne.arraycopy(s.loutbuf,s.totsamp,s.loutbuf,0,MAX_ORDER),ne.arraycopy(s.routbuf,s.totsamp,s.routbuf,0,MAX_ORDER),ne.arraycopy(s.lstepbuf,s.totsamp,s.lstepbuf,0,MAX_ORDER),ne.arraycopy(s.rstepbuf,s.totsamp,s.rstepbuf,0,MAX_ORDER),s.totsamp=0),s.totsamp>s.sampleWindow)return GAIN_ANALYSIS_ERROR}return f<MAX_ORDER?(ne.arraycopy(s.linprebuf,f,s.linprebuf,0,MAX_ORDER-f),ne.arraycopy(s.rinprebuf,f,s.rinprebuf,0,MAX_ORDER-f),ne.arraycopy(n,o,s.linprebuf,MAX_ORDER-f,f),ne.arraycopy(_,l,s.rinprebuf,MAX_ORDER-f,f)):(ne.arraycopy(n,o+f-MAX_ORDER,s.linprebuf,0,MAX_ORDER),ne.arraycopy(_,l+f-MAX_ORDER,s.rinprebuf,0,MAX_ORDER)),GAIN_ANALYSIS_OK},this.GetTitleGain=function(e){var t,a=e.A,s=e.A.length,n=0;for(t=0;t<s;t++)n+=a[t];if(0==n)a=GAIN_NOT_ENOUGH_SAMPLES;else{for(n=0|ae(n*(1-.95)),t=s;0<t--&&!(0>=(n-=a[t])););a=64.82-t/h.STEPS_per_dB}for(s=0;s<e.A.length;s++)e.B[s]+=e.A[s],e.A[s]=0;for(s=0;s<MAX_ORDER;s++)e.linprebuf[s]=e.lstepbuf[s]=e.loutbuf[s]=e.rinprebuf[s]=e.rstepbuf[s]=e.routbuf[s]=0;return e.totsamp=0,e.lsum=e.rsum=0,a}}function p(){function e(e,t,a,s,n,r,i,o,_,l,f,c,u,h,p){this.vbr_q=e,this.quant_comp=t,this.quant_comp_s=a,this.expY=s,this.st_lrm=n,this.st_s=r,this.masking_adj=i,this.masking_adj_short=o,this.ath_lower=_,this.ath_curve=l,this.ath_sensitivity=f,this.interch=c,this.safejoint=u,this.sfb21mod=h,this.msfix=p}function t(e,t,a,s,n,r,i,o,_,l,f,c,u,h){this.quant_comp=t,this.quant_comp_s=a,this.safejoint=s,this.nsmsfix=n,this.st_lrm=r,this.st_s=i,this.nsbass=o,this.scale=_,this.masking_adj=l,this.ath_lower=f,this.ath_curve=c,this.interch=u,this.sfscale=h}function a(e,t,a){var s=e.VBR==f.vbr_rh?o:_,n=e.VBR_q_frac,r=s[t];s=s[t+1],r.st_lrm+=n*(s.st_lrm-r.st_lrm),r.st_s+=n*(s.st_s-r.st_s),r.masking_adj+=n*(s.masking_adj-r.masking_adj),r.masking_adj_short+=n*(s.masking_adj_short-r.masking_adj_short),r.ath_lower+=n*(s.ath_lower-r.ath_lower),r.ath_curve+=n*(s.ath_curve-r.ath_curve),r.ath_sensitivity+=n*(s.ath_sensitivity-r.ath_sensitivity),r.interch+=n*(s.interch-r.interch),r.msfix+=n*(s.msfix-r.msfix),0>(s=r.vbr_q)&&(s=0),9<s&&(s=9),e.VBR_q=s,e.VBR_q_frac=0,0==a&&0<te(e.quant_comp- -1)||(e.quant_comp=r.quant_comp),0==a&&0<te(e.quant_comp_short- -1)||(e.quant_comp_short=r.quant_comp_s),0!=r.expY&&(e.experimentalY=0!=r.expY),0==a&&0<te(e.internal_flags.nsPsy.attackthre- -1)||(e.internal_flags.nsPsy.attackthre=r.st_lrm),0==a&&0<te(e.internal_flags.nsPsy.attackthre_s- -1)||(e.internal_flags.nsPsy.attackthre_s=r.st_s),0==a&&0<te(e.maskingadjust-0)||(e.maskingadjust=r.masking_adj),0==a&&0<te(e.maskingadjust_short-0)||(e.maskingadjust_short=r.masking_adj_short),0==a&&0<te(10*-e.ATHlower)||(e.ATHlower=-r.ath_lower/10),0==a&&0<te(e.ATHcurve- -1)||(e.ATHcurve=r.ath_curve),0==a&&0<te(e.athaa_sensitivity- -1)||(e.athaa_sensitivity=r.ath_sensitivity),0<r.interch&&(0==a&&0<te(e.interChRatio- -1)||(e.interChRatio=r.interch)),0<r.safejoint&&(e.exp_nspsytune|=r.safejoint),0<r.sfb21mod&&(e.exp_nspsytune|=r.sfb21mod<<20),0==a&&0<te(e.msfix- -1)||(e.msfix=r.msfix),0==a&&(e.VBR_q=t,e.VBR_q_frac=n)}function s(e,t,a){var s=n.nearestBitrateFullIndex(t);if(e.VBR=f.vbr_abr,e.VBR_mean_bitrate_kbps=t,e.VBR_mean_bitrate_kbps=i(e.VBR_mean_bitrate_kbps,320),e.VBR_mean_bitrate_kbps=r(e.VBR_mean_bitrate_kbps,8),e.brate=e.VBR_mean_bitrate_kbps,320<e.VBR_mean_bitrate_kbps&&(e.disable_reservoir=!0),0<l[s].safejoint&&(e.exp_nspsytune|=2),0<l[s].sfscale&&(e.internal_flags.noise_shaping=2),0<te(l[s].nsbass)){var o=int(4*l[s].nsbass);0>o&&(o+=64),e.exp_nspsytune|=o<<2}return 0==a&&0<te(e.quant_comp- -1)||(e.quant_comp=l[s].quant_comp),0==a&&0<te(e.quant_comp_short- -1)||(e.quant_comp_short=l[s].quant_comp_s),0==a&&0<te(e.msfix- -1)||(e.msfix=l[s].nsmsfix),0==a&&0<te(e.internal_flags.nsPsy.attackthre- -1)||(e.internal_flags.nsPsy.attackthre=l[s].st_lrm),0==a&&0<te(e.internal_flags.nsPsy.attackthre_s- -1)||(e.internal_flags.nsPsy.attackthre_s=l[s].st_s),0==a&&0<te(e.scale- -1)||(e.scale=l[s].scale),0==a&&0<te(e.maskingadjust-0)||(e.maskingadjust=l[s].masking_adj),0<l[s].masking_adj?0==a&&0<te(e.maskingadjust_short-0)||(e.maskingadjust_short=.9*l[s].masking_adj):0==a&&0<te(e.maskingadjust_short-0)||(e.maskingadjust_short=1.1*l[s].masking_adj),0==a&&0<te(10*-e.ATHlower)||(e.ATHlower=-l[s].ath_lower/10),0==a&&0<te(e.ATHcurve- -1)||(e.ATHcurve=l[s].ath_curve),0==a&&0<te(e.interChRatio- -1)||(e.interChRatio=l[s].interch),t}var n;this.setModules=function(e){n=e};var o=[new e(0,9,9,0,5.2,125,-4.2,-6.3,4.8,1,0,0,2,21,.97),new e(1,9,9,0,5.3,125,-3.6,-5.6,4.5,1.5,0,0,2,21,1.35),new e(2,9,9,0,5.6,125,-2.2,-3.5,2.8,2,0,0,2,21,1.49),new e(3,9,9,1,5.8,130,-1.8,-2.8,2.6,3,-4,0,2,20,1.64),new e(4,9,9,1,6,135,-.7,-1.1,1.1,3.5,-8,0,2,0,1.79),new e(5,9,9,1,6.4,140,.5,.4,-7.5,4,-12,2e-4,0,0,1.95),new e(6,9,9,1,6.6,145,.67,.65,-14.7,6.5,-19,4e-4,0,0,2.3),new e(7,9,9,1,6.6,145,.8,.75,-19.7,8,-22,6e-4,0,0,2.7),new e(8,9,9,1,6.6,145,1.2,1.15,-27.5,10,-23,7e-4,0,0,0),new e(9,9,9,1,6.6,145,1.6,1.6,-36,11,-25,8e-4,0,0,0),new e(10,9,9,1,6.6,145,2,2,-36,12,-25,8e-4,0,0,0)],_=[new e(0,9,9,0,4.2,25,-7,-4,7.5,1,0,0,2,26,.97),new e(1,9,9,0,4.2,25,-5.6,-3.6,4.5,1.5,0,0,2,21,1.35),new e(2,9,9,0,4.2,25,-4.4,-1.8,2,2,0,0,2,18,1.49),new e(3,9,9,1,4.2,25,-3.4,-1.25,1.1,3,-4,0,2,15,1.64),new e(4,9,9,1,4.2,25,-2.2,.1,0,3.5,-8,0,2,0,1.79),new e(5,9,9,1,4.2,25,-1,1.65,-7.7,4,-12,2e-4,0,0,1.95),new e(6,9,9,1,4.2,25,-0,2.47,-7.7,6.5,-19,4e-4,0,0,2),new e(7,9,9,1,4.2,25,.5,2,-14.5,8,-22,6e-4,0,0,2),new e(8,9,9,1,4.2,25,1,2.4,-22,10,-23,7e-4,0,0,2),new e(9,9,9,1,4.2,25,1.5,2.95,-30,11,-25,8e-4,0,0,2),new e(10,9,9,1,4.2,25,2,2.95,-36,12,-30,8e-4,0,0,2)],l=[new t(8,9,9,0,0,6.6,145,0,.95,0,-30,11,.0012,1),new t(16,9,9,0,0,6.6,145,0,.95,0,-25,11,.001,1),new t(24,9,9,0,0,6.6,145,0,.95,0,-20,11,.001,1),new t(32,9,9,0,0,6.6,145,0,.95,0,-15,11,.001,1),new t(40,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new t(48,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new t(56,9,9,0,0,6.6,145,0,.95,0,-6,11,8e-4,1),new t(64,9,9,0,0,6.6,145,0,.95,0,-2,11,8e-4,1),new t(80,9,9,0,0,6.6,145,0,.95,0,0,8,7e-4,1),new t(96,9,9,0,2.5,6.6,145,0,.95,0,1,5.5,6e-4,1),new t(112,9,9,0,2.25,6.6,145,0,.95,0,2,4.5,5e-4,1),new t(128,9,9,0,1.95,6.4,140,0,.95,0,3,4,2e-4,1),new t(160,9,9,1,1.79,6,135,0,.95,-2,5,3.5,0,1),new t(192,9,9,1,1.49,5.6,125,0,.97,-4,7,3,0,0),new t(224,9,9,1,1.25,5.2,125,0,.98,-6,9,2,0,0),new t(256,9,9,1,.97,5.2,125,0,1,-8,10,1,0,0),new t(320,9,9,1,.9,5.2,125,0,1,-10,12,0,0,0)];this.apply_preset=function(e,t,n){switch(t){case q.R3MIX:t=q.V3,e.VBR=f.vbr_mtrh;break;case q.MEDIUM:t=q.V4,e.VBR=f.vbr_rh;break;case q.MEDIUM_FAST:t=q.V4,e.VBR=f.vbr_mtrh;break;case q.STANDARD:t=q.V2,e.VBR=f.vbr_rh;break;case q.STANDARD_FAST:t=q.V2,e.VBR=f.vbr_mtrh;break;case q.EXTREME:t=q.V0,e.VBR=f.vbr_rh;break;case q.EXTREME_FAST:t=q.V0,e.VBR=f.vbr_mtrh;break;case q.INSANE:return t=320,e.preset=t,s(e,t,n),e.VBR=f.vbr_off,t}switch(e.preset=t,t){case q.V9:return a(e,9,n),t;case q.V8:return a(e,8,n),t;case q.V7:return a(e,7,n),t;case q.V6:return a(e,6,n),t;case q.V5:return a(e,5,n),t;case q.V4:return a(e,4,n),t;case q.V3:return a(e,3,n),t;case q.V2:return a(e,2,n),t;case q.V1:return a(e,1,n),t;case q.V0:return a(e,0,n),t}return 8<=t&&320>=t?s(e,t,n):(e.preset=0,t)}}function b(){function t(e){this.bits=0|e}function a(e,t,a,s,n,r){for(t=.5946/t,e>>=1;0!=e--;)n[r++]=t>a[s++]?0:1,n[r++]=t>a[s++]?0:1}function s(e,t,a,s,n,r){var i=(e>>=1)%2;for(e>>=1;0!=e--;){var _=a[s++]*t,l=a[s++]*t,f=0|_,c=a[s++]*t,u=0|l,h=a[s++]*t,p=0|c;_+=o.adj43[f],f=0|h,l+=o.adj43[u],n[r++]=0|_,c+=o.adj43[p],n[r++]=0|l,h+=o.adj43[f],n[r++]=0|c,n[r++]=0|h}0!=i&&(_=a[s++]*t,l=a[s++]*t,_+=o.adj43[0|_],l+=o.adj43[0|l],n[r++]=0|_,n[r++]=0|l)}function n(e,t,a,s){var n,r=t,i=n=0;do{var o=e[r++],_=e[r++];n<o&&(n=o),i<_&&(i=_)}while(r<a);switch(n<i&&(n=i),n){case 0:return n;case 1:r=t,t=0,n=oe.ht[1].hlen;do{i=2*e[r+0]+e[r+1],r+=2,t+=n[i]}while(r<a);return s.bits+=t,1;case 2:case 3:r=t,t=l[n-1],n=0,i=oe.ht[t].xlen,o=2==t?oe.table23:oe.table56;do{_=e[r+0]*i+e[r+1],r+=2,n+=o[_]}while(r<a);return e=65535&n,(n>>=16)>e&&(n=e,t++),s.bits+=n,t;case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:r=t,t=l[n-1],o=i=n=0,_=oe.ht[t].xlen;var f=oe.ht[t].hlen,c=oe.ht[t+1].hlen,u=oe.ht[t+2].hlen;do{var h=e[r+0]*_+e[r+1];r+=2,n+=f[h],i+=c[h],o+=u[h]}while(r<a);return e=t,n>i&&(n=i,e++),n>o&&(n=o,e=t+2),s.bits+=n,e;default:if(n>x.IXMAX_VAL)return s.bits=x.LARGE_BITS,-1;for(n-=15,r=24;32>r&&!(oe.ht[r].linmax>=n);r++);for(i=r-8;24>i&&!(oe.ht[i].linmax>=n);i++);n=i,o=65536*oe.ht[n].xlen+oe.ht[r].xlen,i=0;do{0!=(_=e[t++])&&(14<_&&(_=15,i+=o),_*=16),0!=(f=e[t++])&&(14<f&&(f=15,i+=o),_+=f),i+=oe.largetbl[_]}while(t<a);return e=65535&i,(i>>=16)>e&&(i=e,n=r),s.bits+=i,n}}function r(e,a,s,r,i,o,_,l){for(var f,c,u=a.big_values,h=2;h<H.SBMAX_l+1&&!((f=e.scalefac_band.l[h])>=u)&&(c=i[h-2]+a.count1bits,!(s.part2_3_length<=c));h++)f=n(r,f,u,c=new t(c)),c=c.bits,s.part2_3_length<=c||(s.assign(a),s.part2_3_length=c,s.region0_count=o[h-2],s.region1_count=h-2-o[h-2],s.table_select[0]=_[h-2],s.table_select[1]=l[h-2],s.table_select[2]=f)}var o=null;this.qupvt=null,this.setModules=function(e){o=this.qupvt=e};var _=[[0,0],[0,0],[0,0],[0,0],[0,0],[0,1],[1,1],[1,1],[1,2],[2,2],[2,3],[2,3],[3,4],[3,4],[3,4],[4,5],[4,5],[4,6],[5,6],[5,6],[5,7],[6,7],[6,7]],l=[1,2,5,7,7,10,10,13,13,13,13,13,13,13,13];this.noquant_count_bits=function(e,a,s){var r=a.l3_enc,o=i(576,a.max_nonzero_coeff+2>>1<<1);for(null!=s&&(s.sfb_count1=0);1<o&&0==(r[o-1]|r[o-2]);o-=2);a.count1=o;for(var _,l=0,f=0;3<o&&!(1<(2147483647&(r[o-1]|r[o-2]|r[o-3]|r[o-4])));o-=4)_=2*(2*(2*r[o-4]+r[o-3])+r[o-2])+r[o-1],l+=oe.t32l[_],f+=oe.t33l[_];if(_=l,a.count1table_select=0,l>f&&(_=f,a.count1table_select=1),a.count1bits=_,a.big_values=o,0==o)return _;if(a.block_type==H.SHORT_TYPE?((l=3*e.scalefac_band.s[3])>a.big_values&&(l=a.big_values),f=a.big_values):a.block_type==H.NORM_TYPE?(l=a.region0_count=e.bv_scf[o-2],f=a.region1_count=e.bv_scf[o-1],f=e.scalefac_band.l[l+f+2],l=e.scalefac_band.l[l+1],f<o&&(_=new t(_),a.table_select[2]=n(r,f,o,_),_=_.bits)):(a.region0_count=7,a.region1_count=H.SBMAX_l-1-7-1,(l=e.scalefac_band.l[8])>(f=o)&&(l=f)),l=i(l,o),f=i(f,o),0<l&&(_=new t(_),a.table_select[0]=n(r,0,l,_),_=_.bits),l<f&&(_=new t(_),a.table_select[1]=n(r,l,f,_),_=_.bits),2==e.use_best_huffman&&(a.part2_3_length=_,best_huffman_divide(e,a),_=a.part2_3_length),null!=s&&a.block_type==H.NORM_TYPE){for(r=0;e.scalefac_band.l[r]<a.big_values;)r++;s.sfb_count1=r}return _},this.count_bits=function(e,t,n,r){var i=n.l3_enc,_=x.IXMAX_VAL/o.IPOW20(n.global_gain);if(n.xrpow_max>_)return x.LARGE_BITS;_=o.IPOW20(n.global_gain);var l,f=0,c=0,u=0,h=0,p=0,b=i,d=0,m=t,v=0,g=null!=r&&n.global_gain==r.global_gain,S=n.block_type==H.SHORT_TYPE?38:21;for(l=0;l<=S;l++){var R=-1;if((g||n.block_type==H.NORM_TYPE)&&(R=n.global_gain-(n.scalefac[l]+(0==n.preflag?0:o.pretab[l])<<n.scalefac_scale+1)-8*n.subblock_gain[n.window[l]]),g&&r.step[l]==R)0!=c&&(s(c,_,m,v,b,d),c=0),0!=u&&(a(u,_,m,v,b,d),u=0);else{var A=n.width[l];if(f+n.width[l]>n.max_nonzero_coeff&&(l=n.max_nonzero_coeff-f+1,se.fill(i,n.max_nonzero_coeff,576,0),0>(A=l)&&(A=0),l=S+1),0==c&&0==u&&(b=i,d=p,m=t,v=h),null!=r&&0<r.sfb_count1&&l>=r.sfb_count1&&0<r.step[l]&&R>=r.step[l]?(0!=c&&(s(c,_,m,v,b,d),c=0,b=i,d=p,m=t,v=h),u+=A):(0!=u&&(a(u,_,m,v,b,d),u=0,b=i,d=p,m=t,v=h),c+=A),0>=A){0!=u&&(a(u,_,m,v,b,d),u=0),0!=c&&(s(c,_,m,v,b,d),c=0);break}}l<=S&&(p+=n.width[l],h+=n.width[l],f+=n.width[l])}if(0!=c&&s(c,_,m,v,b,d),0!=u&&a(u,_,m,v,b,d),0!=(2&e.substep_shaping))for(_=0,S=.634521682242439/o.IPOW20(n.global_gain+n.scalefac_scale),f=0;f<n.sfbmax;f++)if(g=n.width[f],0==e.pseudohalf[f])_+=g;else for(c=_,_+=g;c<_;++c)i[c]=t[c]>=S?i[c]:0;return this.noquant_count_bits(e,n,r)},this.best_huffman_divide=function(a,s){var i=new I,o=s.l3_enc,_=e(23),l=e(23),f=e(23),c=e(23);if(s.block_type!=H.SHORT_TYPE||1!=a.mode_gr){if(i.assign(s),s.block_type==H.NORM_TYPE){for(var u=s.big_values,h=0;22>=h;h++)_[h]=x.LARGE_BITS;for(h=0;16>h;h++){var p=a.scalefac_band.l[h+1];if(p>=u)break;var b=0,d=new t(b),m=n(o,0,p,d);b=d.bits;for(var v,g=0;8>g&&!((v=a.scalefac_band.l[h+g+2])>=u);g++)v=n(o,p,v,d=new t(d=b)),d=d.bits,_[h+g]>d&&(_[h+g]=d,l[h+g]=h,f[h+g]=m,c[h+g]=v)}r(a,i,s,o,_,l,f,c)}if(!(0==(u=i.big_values)||1<(o[u-2]|o[u-1])||(u=s.count1+2,576<u))){for(i.assign(s),i.count1=u,p=h=0;u>i.big_values;u-=4)b=2*(2*(2*o[u-4]+o[u-3])+o[u-2])+o[u-1],h+=oe.t32l[b],p+=oe.t33l[b];i.big_values=u,i.count1table_select=0,h>p&&(h=p,i.count1table_select=1),i.count1bits=h,i.block_type==H.NORM_TYPE?r(a,i,s,o,_,l,f,c):(i.part2_3_length=h,(h=a.scalefac_band.l[8])>u&&(h=u),0<h&&(a=new t(i.part2_3_length),i.table_select[0]=n(o,0,h,a),i.part2_3_length=a.bits),u>h&&(a=new t(i.part2_3_length),i.table_select[1]=n(o,h,u,a),i.part2_3_length=a.bits),s.part2_3_length>i.part2_3_length&&s.assign(i))}}};var f=[1,1,1,1,8,2,2,2,4,4,4,8,8,8,16,16],c=[1,2,4,8,1,2,4,8,2,4,8,2,4,8,4,8],u=[0,0,0,0,3,1,1,1,2,2,2,3,3,3,4,4],h=[0,1,2,3,0,1,2,3,1,2,3,1,2,3,2,3];b.slen1_tab=u,b.slen2_tab=h,this.best_scalefac_store=function(e,t,a,s){var n,r,i=s.tt[t][a],_=0;for(n=r=0;n<i.sfbmax;n++){var l=i.width[n];for(r+=l,l=-l;0>l&&0==i.l3_enc[l+r];l++);0==l&&(i.scalefac[n]=_=-2)}if(0==i.scalefac_scale&&0==i.preflag){for(n=r=0;n<i.sfbmax;n++)0<i.scalefac[n]&&(r|=i.scalefac[n]);if(0==(1&r)&&0!=r){for(n=0;n<i.sfbmax;n++)0<i.scalefac[n]&&(i.scalefac[n]>>=1);i.scalefac_scale=_=1}}if(0==i.preflag&&i.block_type!=H.SHORT_TYPE&&2==e.mode_gr){for(n=11;n<H.SBPSY_l&&!(i.scalefac[n]<o.pretab[n]&&-2!=i.scalefac[n]);n++);if(n==H.SBPSY_l){for(n=11;n<H.SBPSY_l;n++)0<i.scalefac[n]&&(i.scalefac[n]-=o.pretab[n]);i.preflag=_=1}}for(n=0;4>n;n++)s.scfsi[a][n]=0;if(2==e.mode_gr&&1==t&&s.tt[0][a].block_type!=H.SHORT_TYPE&&s.tt[1][a].block_type!=H.SHORT_TYPE){for(t=s.tt[1][a],r=s.tt[0][a],_=0;_<oe.scfsi_band.length-1;_++){for(n=oe.scfsi_band[_];n<oe.scfsi_band[_+1]&&!(r.scalefac[n]!=t.scalefac[n]&&0<=t.scalefac[n]);n++);if(n==oe.scfsi_band[_+1]){for(n=oe.scfsi_band[_];n<oe.scfsi_band[_+1];n++)t.scalefac[n]=-1;s.scfsi[a][_]=1}}for(n=s=a=0;11>n;n++)-1!=t.scalefac[n]&&(s++,a<t.scalefac[n]&&(a=t.scalefac[n]));for(l=r=0;n<H.SBPSY_l;n++)-1!=t.scalefac[n]&&(l++,r<t.scalefac[n]&&(r=t.scalefac[n]));for(_=0;16>_;_++)a<f[_]&&r<c[_]&&(n=u[_]*s+h[_]*l,t.part2_length>n&&(t.part2_length=n,t.scalefac_compress=_));_=0}for(n=0;n<i.sfbmax;n++)-2==i.scalefac[n]&&(i.scalefac[n]=0);0!=_&&(2==e.mode_gr?this.scale_bitcount(i):this.scale_bitcount_lsf(e,i))};var p=[0,18,36,54,54,36,54,72,54,72,90,72,90,108,108,126],d=[0,18,36,54,51,35,53,71,52,70,88,69,87,105,104,122],m=[0,10,20,30,33,21,31,41,32,42,52,43,53,63,64,74];this.scale_bitcount=function(e){var t,a=0,s=0,n=e.scalefac;if(e.block_type==H.SHORT_TYPE){var r=p;0!=e.mixed_block_flag&&(r=d)}else if(r=m,0==e.preflag){for(t=11;t<H.SBPSY_l&&!(n[t]<o.pretab[t]);t++);if(t==H.SBPSY_l)for(e.preflag=1,t=11;t<H.SBPSY_l;t++)n[t]-=o.pretab[t]}for(t=0;t<e.sfbdivide;t++)a<n[t]&&(a=n[t]);for(;t<e.sfbmax;t++)s<n[t]&&(s=n[t]);for(e.part2_length=x.LARGE_BITS,t=0;16>t;t++)a<f[t]&&s<c[t]&&e.part2_length>r[t]&&(e.part2_length=r[t],e.scalefac_compress=t);return e.part2_length==x.LARGE_BITS};var v=[[15,15,7,7],[15,15,7,0],[7,3,0,0],[15,31,31,0],[7,7,7,0],[3,3,0,0]];this.scale_bitcount_lsf=function(t,a){var s,n,r,i,_=e(4),l=a.scalefac;for(t=0==a.preflag?0:2,r=0;4>r;r++)_[r]=0;if(a.block_type==H.SHORT_TYPE){var f=1,c=o.nr_of_sfb_block[t][f];for(s=i=0;4>s;s++){var u=c[s]/3;for(r=0;r<u;r++,i++)for(n=0;3>n;n++)l[3*i+n]>_[s]&&(_[s]=l[3*i+n])}}else for(f=0,c=o.nr_of_sfb_block[t][f],s=i=0;4>s;s++)for(u=c[s],r=0;r<u;r++,i++)l[i]>_[s]&&(_[s]=l[i]);for(u=!1,s=0;4>s;s++)_[s]>v[t][s]&&(u=!0);if(!u){for(a.sfb_partition_table=o.nr_of_sfb_block[t][f],s=0;4>s;s++)a.slen[s]=g[_[s]];f=a.slen[0],s=a.slen[1],_=a.slen[2],n=a.slen[3],0===t?a.scalefac_compress=(5*f+s<<4)+(_<<2)+n:1===t?a.scalefac_compress=400+(5*f+s<<2)+_:2===t?a.scalefac_compress=500+3*f+s:ne.err.printf("intensity stereo not implemented yet\n")}if(!u)for(s=a.part2_length=0;4>s;s++)a.part2_length+=a.slen[s]*a.sfb_partition_table[s];return u};var g=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4];this.huffman_init=function(e){for(var t=2;576>=t;t+=2){for(var a,s=0;e.scalefac_band.l[++s]<t;);for(a=_[s][0];e.scalefac_band.l[a+1]>t;)a--;for(0>a&&(a=_[s][0]),e.bv_scf[t-2]=a,a=_[s][1];e.scalefac_band.l[a+e.bv_scf[t-2]+2]>t;)a--;0>a&&(a=_[s][1]),e.bv_scf[t-1]=a}}}function d(){var e;this.setModules=function(t){e=t},this.ResvFrameBegin=function(t,a){var s=t.internal_flags,n=s.l3_side,r=e.getframebits(t);a.bits=(r-8*s.sideinfo_len)/s.mode_gr;var o=2048*s.mode_gr-8;if(320<t.brate)var _=8*int(1e3*t.brate/(t.out_samplerate/1152)/8+.5);else _=11520,t.strict_ISO&&(_=8*int(32e4/(t.out_samplerate/1152)/8+.5));return s.ResvMax=_-r,s.ResvMax>o&&(s.ResvMax=o),(0>s.ResvMax||t.disable_reservoir)&&(s.ResvMax=0),(t=a.bits*s.mode_gr+i(s.ResvSize,s.ResvMax))>_&&(t=_),n.resvDrain_pre=0,null!=s.pinfo&&(s.pinfo.mean_bits=a.bits/2,s.pinfo.resvsize=s.ResvSize),t},this.ResvMaxBits=function(e,t,a,s){var n=e.internal_flags,r=n.ResvSize,i=n.ResvMax;return 0!=s&&(r+=t),0!=(1&n.substep_shaping)&&(i*=.9),a.bits=t,10*r>9*i?(s=r-9*i/10,a.bits+=s,n.substep_shaping|=128):(s=0,n.substep_shaping&=127,e.disable_reservoir||0!=(1&n.substep_shaping)||(a.bits-=.1*t)),e=r<6*n.ResvMax/10?r:6*n.ResvMax/10,0>(e-=s)&&(e=0),e},this.ResvAdjust=function(e,t){e.ResvSize-=t.part2_3_length+t.part2_length},this.ResvFrameEnd=function(e,t){var a,s=e.l3_side;e.ResvSize+=t*e.mode_gr,t=0,s.resvDrain_post=0,s.resvDrain_pre=0,0!=(a=e.ResvSize%8)&&(t+=a),0<(a=e.ResvSize-t-e.ResvMax)&&(t+=a),a=i(8*s.main_data_begin,t)/8,s.resvDrain_pre+=8*a,t-=8*a,e.ResvSize-=8*a,s.main_data_begin-=a,s.resvDrain_post+=t,e.ResvSize-=t}}function m(){function t(e,t,a){for(;0<a;){if(0==w){if(w=8,B++,e.header[e.w_ptr].write_timing==A){var s=e;ne.arraycopy(s.header[s.w_ptr].buf,0,R,B,s.sideinfo_len),B+=s.sideinfo_len,A+=8*s.sideinfo_len,s.w_ptr=s.w_ptr+1&X.MAX_HEADER_BUF-1}R[B]=0}a-=s=i(a,w),w-=s,R[B]|=t>>a<<w,A+=s}}function s(e,a){var s,n=e.internal_flags;if(8<=a&&(t(n,76,8),a-=8),8<=a&&(t(n,65,8),a-=8),8<=a&&(t(n,77,8),a-=8),8<=a&&(t(n,69,8),a-=8),32<=a){var r=g.getLameShortVersion();if(32<=a)for(s=0;s<r.length&&8<=a;++s)a-=8,t(n,r.charAt(s),8)}for(;1<=a;--a)t(n,n.ancillary_flag,1),n.ancillary_flag^=e.disable_reservoir?0:1}function n(e,t,a){for(var s,n=e.header[e.h_ptr].ptr;0<a;)a-=s=i(a,8-(7&n)),e.header[e.h_ptr].buf[n>>3]|=t>>a<<8-(7&n)-s,n+=s;e.header[e.h_ptr].ptr=n}function o(e,t){e<<=8;for(var a=0;8>a;a++)0!=(65536&((t<<=1)^(e<<=1)))&&(t^=32773);return t}function _(e,a){var s,n=oe.ht[a.count1table_select+32],r=0,i=a.big_values,o=a.big_values;for(s=(a.count1-a.big_values)/4;0<s;--s){var _=0,l=0,f=a.l3_enc[i+0];0!=f&&(l+=8,0>a.xr[o+0]&&_++),0!=(f=a.l3_enc[i+1])&&(l+=4,_*=2,0>a.xr[o+1]&&_++),0!=(f=a.l3_enc[i+2])&&(l+=2,_*=2,0>a.xr[o+2]&&_++),0!=(f=a.l3_enc[i+3])&&(l++,_*=2,0>a.xr[o+3]&&_++),i+=4,o+=4,t(e,_+n.table[l],n.hlen[l]),r+=n.hlen[l]}return r}function l(e,a,s,n,r){var i=oe.ht[a],o=0;if(0==a)return o;for(;s<n;s+=2){var _=0,l=0,f=i.xlen,c=i.xlen,u=0,h=r.l3_enc[s],p=r.l3_enc[s+1];0!=h&&(0>r.xr[s]&&u++,_--),15<a&&(14<h&&(u|=h-15<<1,l=f,h=15),14<p&&(u<<=f,u|=c=p-15,l+=f,p=15),c=16),0!=p&&(u<<=1,0>r.xr[s+1]&&u++,_--),h=h*c+p,l-=_,_+=i.hlen[h],t(e,i.table[h],_),t(e,u,l),o+=_+l}return o}function f(e,t){var a=3*e.scalefac_band.s[3];return a>t.big_values&&(a=t.big_values),l(e,t.table_select[0],0,a,t)+l(e,t.table_select[1],a,t.big_values,t)}function c(e,t){var a=t.big_values,s=t.region0_count+1,n=e.scalefac_band.l[s];s+=t.region1_count+1;var r=e.scalefac_band.l[s];return n>a&&(n=a),r>a&&(r=a),s=l(e,t.table_select[0],0,n,t),(s+=l(e,t.table_select[1],n,r,t))+l(e,t.table_select[2],r,a,t)}function u(){this.total=0}function p(e,t){var a=e.internal_flags,s=a.w_ptr,n=a.h_ptr-1;-1==n&&(n=X.MAX_HEADER_BUF-1);var r=a.header[n].write_timing-A;if(t.total=r,0<=r){var i=1+n-s;n<s&&(i=1+n-s+X.MAX_HEADER_BUF),r-=8*i*a.sideinfo_len}return r+=e=d.getframebits(e),t.total+=e,t.total=0==t.total%8?t.total/8:1+t.total/8,t.total+=B+1,0>r&&ne.err.println("strange error flushing buffer ... \n"),r}var d=this,m=null,v=null,g=null,S=null;this.setModules=function(e,t,a,s){m=e,v=t,g=a,S=s};var R=null,A=0,B=0,w=0;this.getframebits=function(e){var t=e.internal_flags;return 8*(0|72e3*(e.version+1)*(0==t.bitrate_index?e.brate:oe.bitrate_table[e.version][t.bitrate_index])/e.out_samplerate+t.padding)},this.CRC_writeheader=function(e,t){var a=o(255&t[2],65535);a=o(255&t[3],a);for(var s=6;s<e.sideinfo_len;s++)a=o(255&t[s],a);t[4]=byte(a>>8),t[5]=byte(255&a)},this.flush_bitstream=function(e){var t,a=e.internal_flags,n=a.l3_side;0>(t=p(e,new u))||(s(e,t),a.ResvSize=0,n.main_data_begin=0,a.findReplayGain&&(n=m.GetTitleGain(a.rgdata),a.RadioGain=0|ee(10*n+.5)),a.findPeakSample&&(a.noclipGainChange=0|ae(200*T()(a.PeakSample/32767)),a.noclipScale=0<a.noclipGainChange&&(EQ(e.scale,1)||EQ(e.scale,0))?ee(32767/a.PeakSample*100)/100:-1))},this.add_dummy_byte=function(e,t,a){e=e.internal_flags;for(var s;0<a--;){s=t;for(var n=8;0<n;){0==w&&(w=8,B++,R[B]=0);var r=i(n,w);n-=r,w-=r,R[B]|=s>>n<<w,A+=r}for(s=0;s<X.MAX_HEADER_BUF;++s)e.header[s].write_timing+=8}},this.format_bitstream=function(e){var a=e.internal_flags,i=a.l3_side,o=this.getframebits(e);s(e,i.resvDrain_pre);var l,h,d=e.internal_flags,m=d.l3_side;if(d.header[d.h_ptr].ptr=0,se.fill(d.header[d.h_ptr].buf,0,d.sideinfo_len,0),16e3>e.out_samplerate?n(d,4094,12):n(d,4095,12),n(d,e.version,1),n(d,1,2),n(d,e.error_protection?0:1,1),n(d,d.bitrate_index,4),n(d,d.samplerate_index,2),n(d,d.padding,1),n(d,e.extension,1),n(d,e.mode.ordinal(),2),n(d,d.mode_ext,2),n(d,e.copyright,1),n(d,e.original,1),n(d,e.emphasis,2),e.error_protection&&n(d,0,16),1==e.version){for(n(d,m.main_data_begin,9),2==d.channels_out?n(d,m.private_bits,3):n(d,m.private_bits,5),h=0;h<d.channels_out;h++)for(l=0;4>l;l++)n(d,m.scfsi[h][l],1);for(l=0;2>l;l++)for(h=0;h<d.channels_out;h++){var v=m.tt[l][h];n(d,v.part2_3_length+v.part2_length,12),n(d,v.big_values/2,9),n(d,v.global_gain,8),n(d,v.scalefac_compress,4),v.block_type==H.NORM_TYPE?(n(d,0,1),14==v.table_select[0]&&(v.table_select[0]=16),n(d,v.table_select[0],5),14==v.table_select[1]&&(v.table_select[1]=16),n(d,v.table_select[1],5),14==v.table_select[2]&&(v.table_select[2]=16),n(d,v.table_select[2],5),n(d,v.region0_count,4),n(d,v.region1_count,3)):(n(d,1,1),n(d,v.block_type,2),n(d,v.mixed_block_flag,1),14==v.table_select[0]&&(v.table_select[0]=16),n(d,v.table_select[0],5),14==v.table_select[1]&&(v.table_select[1]=16),n(d,v.table_select[1],5),n(d,v.subblock_gain[0],3),n(d,v.subblock_gain[1],3),n(d,v.subblock_gain[2],3)),n(d,v.preflag,1),n(d,v.scalefac_scale,1),n(d,v.count1table_select,1)}}else for(n(d,m.main_data_begin,8),n(d,m.private_bits,d.channels_out),h=l=0;h<d.channels_out;h++)n(d,(v=m.tt[l][h]).part2_3_length+v.part2_length,12),n(d,v.big_values/2,9),n(d,v.global_gain,8),n(d,v.scalefac_compress,9),v.block_type==H.NORM_TYPE?(n(d,0,1),14==v.table_select[0]&&(v.table_select[0]=16),n(d,v.table_select[0],5),14==v.table_select[1]&&(v.table_select[1]=16),n(d,v.table_select[1],5),14==v.table_select[2]&&(v.table_select[2]=16),n(d,v.table_select[2],5),n(d,v.region0_count,4),n(d,v.region1_count,3)):(n(d,1,1),n(d,v.block_type,2),n(d,v.mixed_block_flag,1),14==v.table_select[0]&&(v.table_select[0]=16),n(d,v.table_select[0],5),14==v.table_select[1]&&(v.table_select[1]=16),n(d,v.table_select[1],5),n(d,v.subblock_gain[0],3),n(d,v.subblock_gain[1],3),n(d,v.subblock_gain[2],3)),n(d,v.scalefac_scale,1),n(d,v.count1table_select,1);e.error_protection&&CRC_writeheader(d,d.header[d.h_ptr].buf),m=d.h_ptr,d.h_ptr=m+1&X.MAX_HEADER_BUF-1,d.header[d.h_ptr].write_timing=d.header[m].write_timing+o,d.h_ptr==d.w_ptr&&ne.err.println("Error: MAX_HEADER_BUF too small in bitstream.c \n"),d=8*a.sideinfo_len;var g=0,S=e.internal_flags,R=S.l3_side;if(1==e.version)for(m=0;2>m;m++)for(h=0;h<S.channels_out;h++){var B=R.tt[m][h],w=b.slen1_tab[B.scalefac_compress],y=b.slen2_tab[B.scalefac_compress];for(l=v=0;l<B.sfbdivide;l++)-1!=B.scalefac[l]&&(t(S,B.scalefac[l],w),v+=w);for(;l<B.sfbmax;l++)-1!=B.scalefac[l]&&(t(S,B.scalefac[l],y),v+=y);v=B.block_type==H.SHORT_TYPE?v+f(S,B):v+c(S,B),g+=v+=_(S,B)}else for(h=m=0;h<S.channels_out;h++){var k=0;if(y=l=v=0,(B=R.tt[m][h]).block_type==H.SHORT_TYPE){for(;4>y;y++){var T=B.sfb_partition_table[y]/3,E=B.slen[y];for(w=0;w<T;w++,l++)t(S,r(B.scalefac[3*l],0),E),t(S,r(B.scalefac[3*l+1],0),E),t(S,r(B.scalefac[3*l+2],0),E),k+=3*E}v+=f(S,B)}else{for(;4>y;y++)for(T=B.sfb_partition_table[y],E=B.slen[y],w=0;w<T;w++,l++)t(S,r(B.scalefac[l],0),E),k+=E;v+=c(S,B)}g+=k+(v+=_(S,B))}if(d+=g,s(e,i.resvDrain_post),d+=i.resvDrain_post,i.main_data_begin+=(o-d)/8,p(e,new u)!=a.ResvSize&&ne.err.println("Internal buffer inconsistency. flushbits <> ResvSize"),8*i.main_data_begin!=a.ResvSize&&(ne.err.printf("bit reservoir error: \nl3_side.main_data_begin: %d \nResvoir size:             %d \nresv drain (post)         %d \nresv drain (pre)          %d \nheader and sideinfo:      %d \ndata bits:                %d \ntotal bits:               %d (remainder: %d) \nbitsperframe:             %d \n",8*i.main_data_begin,a.ResvSize,i.resvDrain_post,i.resvDrain_pre,8*a.sideinfo_len,d-i.resvDrain_post-8*a.sideinfo_len,d,d%8,o),ne.err.println("This is a fatal error.  It has several possible causes:"),ne.err.println("90%%  LAME compiled with buggy version of gcc using advanced optimizations"),ne.err.println(" 9%%  Your system is overclocked"),ne.err.println(" 1%%  bug in LAME encoding library"),a.ResvSize=8*i.main_data_begin),1e9<A){for(e=0;e<X.MAX_HEADER_BUF;++e)a.header[e].write_timing-=A;A=0}return 0},this.copy_buffer=function(t,s,n,r,i){var o=B+1;if(0>=o)return 0;if(0!=r&&o>r)return-1;if(ne.arraycopy(R,0,s,n,o),B=-1,w=0,0!=i&&((r=e(1))[0]=t.nMusicCRC,S.updateMusicCRC(r,s,n,o),t.nMusicCRC=r[0],0<o&&(t.VBR_seek_table.nBytesWritten+=o),t.decode_on_the_fly)){r=a([2,1152]),i=o;for(var _,l=-1;0!=l;)if(l=v.hip_decode1_unclipped(t.hip,s,n,i,r[0],r[1]),i=0,-1==l&&(l=0),0<l){if(t.findPeakSample){for(_=0;_<l;_++)r[0][_]>t.PeakSample?t.PeakSample=r[0][_]:-r[0][_]>t.PeakSample&&(t.PeakSample=-r[0][_]);if(1<t.channels_out)for(_=0;_<l;_++)r[1][_]>t.PeakSample?t.PeakSample=r[1][_]:-r[1][_]>t.PeakSample&&(t.PeakSample=-r[1][_])}if(t.findReplayGain&&m.AnalyzeSamples(t.rgdata,r[0],0,r[1],0,l,t.channels_out)==h.GAIN_ANALYSIS_ERROR)return-6}}return o},this.init_bit_stream_w=function(e){R=new Int8Array(q.LAME_MAXMP3BUFFER),e.h_ptr=e.w_ptr=0,e.header[e.h_ptr].write_timing=0,B=-1,A=w=0}}function v(){function e(e,t){var a=255&e[t+0];return(a=(a=a<<8|255&e[t+1])<<8|255&e[t+2])<<8|255&e[t+3]}function t(e,t,a){e[t+0]=255&a>>24,e[t+1]=255&a>>16,e[t+2]=255&a>>8,e[t+3]=255&a}function a(e,t,a){e[t+0]=255&a>>8,e[t+1]=255&a}function s(e,t,a){return 255&(e<<t|a&~(-1<<t))}function n(e,t){var a=e.internal_flags;t[0]=s(t[0],8,255),t[1]=s(t[1],3,7),t[1]=s(t[1],1,16e3>e.out_samplerate?0:1),t[1]=s(t[1],1,e.version),t[1]=s(t[1],2,1),t[1]=s(t[1],1,e.error_protection?0:1),t[2]=s(t[2],4,a.bitrate_index),t[2]=s(t[2],2,a.samplerate_index),t[2]=s(t[2],1,0),t[2]=s(t[2],1,e.extension),t[3]=s(t[3],2,e.mode.ordinal()),t[3]=s(t[3],2,a.mode_ext),t[3]=s(t[3],1,e.copyright),t[3]=s(t[3],1,e.original),t[3]=s(t[3],2,e.emphasis),t[0]=255,a=241&t[1];var n=1==e.version?128:16e3>e.out_samplerate?32:64;e.VBR==f.vbr_off&&(n=e.brate),n=e.free_format?0:255&16*i.BitrateIndex(n,e.version,e.out_samplerate),t[1]=1==e.version?255&(10|a):255&(2|a),a=13&t[2],t[2]=255&(n|a)}function r(e,t){return t>>8^h[255&(t^e)]}var i,o,_;this.setModules=function(e,t,a){i=e,o=t,_=a};var c=v.NUMTOCENTRIES,u=v.MAXFRAMESIZE,h=[0,49345,49537,320,49921,960,640,49729,50689,1728,1920,51009,1280,50625,50305,1088,52225,3264,3456,52545,3840,53185,52865,3648,2560,51905,52097,2880,51457,2496,2176,51265,55297,6336,6528,55617,6912,56257,55937,6720,7680,57025,57217,8e3,56577,7616,7296,56385,5120,54465,54657,5440,55041,6080,5760,54849,53761,4800,4992,54081,4352,53697,53377,4160,61441,12480,12672,61761,13056,62401,62081,12864,13824,63169,63361,14144,62721,13760,13440,62529,15360,64705,64897,15680,65281,16320,16e3,65089,64001,15040,15232,64321,14592,63937,63617,14400,10240,59585,59777,10560,60161,11200,10880,59969,60929,11968,12160,61249,11520,60865,60545,11328,58369,9408,9600,58689,9984,59329,59009,9792,8704,58049,58241,9024,57601,8640,8320,57409,40961,24768,24960,41281,25344,41921,41601,25152,26112,42689,42881,26432,42241,26048,25728,42049,27648,44225,44417,27968,44801,28608,28288,44609,43521,27328,27520,43841,26880,43457,43137,26688,30720,47297,47489,31040,47873,31680,31360,47681,48641,32448,32640,48961,32e3,48577,48257,31808,46081,29888,30080,46401,30464,47041,46721,30272,29184,45761,45953,29504,45313,29120,28800,45121,20480,37057,37249,20800,37633,21440,21120,37441,38401,22208,22400,38721,21760,38337,38017,21568,39937,23744,23936,40257,24320,40897,40577,24128,23040,39617,39809,23360,39169,22976,22656,38977,34817,18624,18816,35137,19200,35777,35457,19008,19968,36545,36737,20288,36097,19904,19584,35905,17408,33985,34177,17728,34561,18368,18048,34369,33281,17088,17280,33601,16640,33217,32897,16448];this.addVbrFrame=function(e){var t=e.internal_flags,a=t.VBR_seek_table;if(e=oe.bitrate_table[e.version][t.bitrate_index],a.nVbrNumFrames++,a.sum+=e,a.seen++,!(a.seen<a.want)&&(a.pos<a.size&&(a.bag[a.pos]=a.sum,a.pos++,a.seen=0),a.pos==a.size)){for(e=1;e<a.size;e+=2)a.bag[e/2]=a.bag[e];a.want*=2,a.pos/=2}},this.getVbrTag=function(t){var a=new VBRTagData,s=0;a.flags=0;var n=1&t[s+1]>>3,r=3&t[s+2]>>2,i=3&t[s+3]>>6,o=15&t[s+2]>>4;if(o=oe.bitrate_table[n][o],a.samprate=14==t[s+1]>>4?oe.samplerate_table[2][r]:oe.samplerate_table[n][r],r=s=0==n?3==i?s+13:s+21:3==i?s+21:s+36,!new String(t,r,4(),null).equals("Xing")&&!new String(t,r,4(),null).equals("Info"))return null;if(s+=4,a.hId=n,r=a.flags=e(t,s),s+=4,0!=(1&r)&&(a.frames=e(t,s),s+=4),0!=(2&r)&&(a.bytes=e(t,s),s+=4),0!=(4&r)){if(null!=a.toc)for(i=0;i<c;i++)a.toc[i]=t[s+i];s+=c}return a.vbrScale=-1,0!=(8&r)&&(a.vbrScale=e(t,s),s+=4),a.headersize=72e3*(n+1)*o/a.samprate,n=t[(s+=21)+0]<<4,n+=t[s+1]>>4,o=(15&t[s+1])<<8,(0>n||3e3<n)&&(n=-1),(0>(o+=255&t[s+2])||3e3<o)&&(o=-1),a.encDelay=n,a.encPadding=o,a},this.InitVbrTag=function(e){var t=e.internal_flags,a=1==e.version?128:16e3>e.out_samplerate?32:64;e.VBR==f.vbr_off&&(a=e.brate),a=72e3*(e.version+1)*a/e.out_samplerate;var s=t.sideinfo_len+(c+4+4+4+4+4+9+1+1+8+1+1+3+1+1+2+4+2+2);if(t.VBR_seek_table.TotalFrameSize=a,a<s||a>u)e.bWriteVbrTag=!1;else for(t.VBR_seek_table.nVbrNumFrames=0,t.VBR_seek_table.nBytesWritten=0,t.VBR_seek_table.sum=0,t.VBR_seek_table.seen=0,t.VBR_seek_table.want=1,t.VBR_seek_table.pos=0,null==t.VBR_seek_table.bag&&(t.VBR_seek_table.bag=new int[400],t.VBR_seek_table.size=400),n(e,a=new Int8Array(u)),t=t.VBR_seek_table.TotalFrameSize,s=0;s<t;++s)o.add_dummy_byte(e,255&a[s],1)},this.updateMusicCRC=function(e,t,a,s){for(var n=0;n<s;++n)e[0]=r(t[a+n],e[0])},this.getLameTagFrame=function(e,s){var i=e.internal_flags;if(!e.bWriteVbrTag||i.Class_ID!=q.LAME_ID||0>=i.VBR_seek_table.pos)return 0;if(s.length<i.VBR_seek_table.TotalFrameSize)return i.VBR_seek_table.TotalFrameSize;se.fill(s,0,i.VBR_seek_table.TotalFrameSize,0),n(e,s);var f=new Int8Array(c);if(e.free_format)for(var u=1;u<c;++u)f[u]=255&255*u/100;else{var h=i.VBR_seek_table;if(!(0>=h.pos))for(u=1;u<c;++u){var p=0|ee(u/c*h.pos);p>h.pos-1&&(p=h.pos-1),255<(p=0|256*h.bag[p]/h.sum)&&(p=255),f[u]=255&p}}p=i.sideinfo_len,e.error_protection&&(p-=2),s[p++]=0,s[p++]=0,s[p++]=0,s[p++]=0,t(s,p,15),t(s,p+=4,i.VBR_seek_table.nVbrNumFrames),t(s,p+=4,0|(h=i.VBR_seek_table.nBytesWritten+i.VBR_seek_table.TotalFrameSize)),p+=4,ne.arraycopy(f,0,s,p,f.length),p+=f.length,e.error_protection&&o.CRC_writeheader(i,s);var b=0;for(u=0;u<p;u++)b=r(s[u],b);f=p,u=b;var d=e.internal_flags;p=0,b=e.encoder_delay;var m,v=e.encoder_padding,g=100-10*e.VBR_q-e.quality,S=_.getLameVeryShortVersion(),R=[1,5,3,2,4,0,3],A=0|(255<e.lowpassfreq/100+.5?255:e.lowpassfreq/100+.5),B=0,w=0,y=e.internal_flags.noise_shaping,k=0,T=0!=(1&e.exp_nspsytune),E=0!=(2&e.exp_nspsytune),x=m=!1,M=e.internal_flags.nogap_total,I=e.internal_flags.nogap_current,P=e.ATHtype;switch(e.VBR){case vbr_abr:var L=e.VBR_mean_bitrate_kbps;break;case vbr_off:L=e.brate;break;default:L=e.VBR_min_bitrate_kbps}switch(R=0+(e.VBR.ordinal()<R.length?R[e.VBR.ordinal()]:0),d.findReplayGain&&(510<d.RadioGain&&(d.RadioGain=510),-510>d.RadioGain&&(d.RadioGain=-510),w=11264,w=0<=d.RadioGain?w|d.RadioGain:512|w|-d.RadioGain),d.findPeakSample&&(B=te(0|d.PeakSample/32767*8388608+.5)),-1!=M&&(0<I&&(x=!0),I<M-1&&(m=!0)),T=P+((T?1:0)<<4)+((E?1:0)<<5)+((m?1:0)<<6)+((x?1:0)<<7),0>g&&(g=0),e.mode){case MONO:E=0;break;case STEREO:E=1;break;case DUAL_CHANNEL:E=2;break;case JOINT_STEREO:E=e.force_ms?4:3;break;default:E=7}for(m=32e3>=e.in_samplerate?0:48e3==e.in_samplerate?2:48e3<e.in_samplerate?3:1,(e.short_blocks==l.short_block_forced||e.short_blocks==l.short_block_dispensed||-1==e.lowpassfreq&&-1==e.highpassfreq||e.scale_left<e.scale_right||e.scale_left>e.scale_right||e.disable_reservoir&&320>e.brate||e.noATH||e.ATHonly||0==P||32e3>=e.in_samplerate)&&(k=1),y=y+(E<<2)+(k<<5)+(m<<6),d=d.nMusicCRC,t(s,f+p,g),p+=4,g=0;9>g;g++)s[f+p+g]=255&S.charAt(g);for(s[f+(p+=9)]=255&R,s[f+ ++p]=255&A,t(s,f+ ++p,B),a(s,f+(p+=4),w),a(s,f+(p+=2),0),s[f+(p+=2)]=255&T,s[f+ ++p]=255<=L?255:255&L,s[f+ ++p]=255&b>>4,s[f+p+1]=255&(b<<4)+(v>>8),s[f+p+2]=255&v,s[f+(p+=3)]=255&y,p++,s[f+p++]=0,a(s,f+p,e.preset),t(s,f+(p+=2),h),a(s,f+(p+=4),d),p+=2,e=0;e<p;e++)u=r(s[f+e],u);return a(s,f+p,u),i.VBR_seek_table.TotalFrameSize},this.putVbrTag=function(e,t){if(0>=e.internal_flags.VBR_seek_table.pos)return-1;if(t.seek(t.length()),0==t.length())return-1;t.seek(0);var a=new Int8Array(10);return t.readFully(a),a=new String(a,"ISO-8859-1").startsWith("ID3")?0:((127&a[6])<<21|(127&a[7])<<14|(127&a[8])<<7|127&a[9])+a.length,t.seek(a),a=new Int8Array(u),(e=getLameTagFrame(e,a))>a.length?-1:(1>e||t.write(a,0,e),0)}}function g(e,t,a,s){this.xlen=e,this.linmax=t,this.table=a,this.hlen=s}function S(e){this.bits=e}function R(){this.setModules=function(){}}function A(){this.bits=this.over_SSD=this.over_count=this.max_noise=this.tot_noise=this.over_noise=0}function B(){this.scale_right=this.scale_left=this.scale=this.out_samplerate=this.in_samplerate=this.num_channels=this.num_samples=this.class_id=0,this.decode_only=this.bWriteVbrTag=this.analysis=!1,this.quality=0,this.mode=c.STEREO,this.write_id3tag_automatic=this.decode_on_the_fly=this.findReplayGain=this.free_format=this.force_ms=!1,this.error_protection=this.emphasis=this.extension=this.original=this.copyright=this.compression_ratio=this.brate=0,this.disable_reservoir=this.strict_ISO=!1,this.quant_comp_short=this.quant_comp=0,this.experimentalY=!1,this.preset=this.exp_nspsytune=this.experimentalZ=0,this.VBR=null,this.maskingadjust_short=this.maskingadjust=this.highpasswidth=this.lowpasswidth=this.highpassfreq=this.lowpassfreq=this.VBR_hard_min=this.VBR_max_bitrate_kbps=this.VBR_min_bitrate_kbps=this.VBR_mean_bitrate_kbps=this.VBR_q=this.VBR_q_frac=0,this.noATH=this.ATHshort=this.ATHonly=!1,this.athaa_sensitivity=this.athaa_loudapprox=this.athaa_type=this.ATHlower=this.ATHcurve=this.ATHtype=0,this.short_blocks=null,this.useTemporal=!1,this.msfix=this.interChRatio=0,this.tune=!1,this.lame_allocated_gfp=this.frameNum=this.framesize=this.encoder_padding=this.encoder_delay=this.version=this.tune_value_a=0,this.internal_flags=null}function w(){this.linprebuf=t(2*h.MAX_ORDER),this.linpre=0,this.lstepbuf=t(h.MAX_SAMPLES_PER_WINDOW+h.MAX_ORDER),this.lstep=0,this.loutbuf=t(h.MAX_SAMPLES_PER_WINDOW+h.MAX_ORDER),this.lout=0,this.rinprebuf=t(2*h.MAX_ORDER),this.rinpre=0,this.rstepbuf=t(h.MAX_SAMPLES_PER_WINDOW+h.MAX_ORDER),this.rstep=0,this.routbuf=t(h.MAX_SAMPLES_PER_WINDOW+h.MAX_ORDER),this.first=this.freqindex=this.rsum=this.lsum=this.totsamp=this.sampleWindow=this.rout=0,this.A=e(0|h.STEPS_per_dB*h.MAX_dB),this.B=e(0|h.STEPS_per_dB*h.MAX_dB)}function y(a){this.quantize=a,this.iteration_loop=function(a,s,r,i){var o=a.internal_flags,_=t(_e.SFBMAX),l=t(576),f=e(2),c=o.l3_side,u=new S(0);this.quantize.rv.ResvFrameBegin(a,u),u=u.bits;for(var h,p=0;p<o.mode_gr;p++)for(h=this.quantize.qupvt.on_pe(a,s,f,u,p,p),o.mode_ext==H.MPG_MD_MS_LR&&(this.quantize.ms_convert(o.l3_side,p),this.quantize.qupvt.reduce_side(f,r[p],u,h)),h=0;h<o.channels_out;h++){var b=c.tt[p][h];if(b.block_type!=H.SHORT_TYPE){var d=0;d=o.PSY.mask_adjust-d}else d=0,d=o.PSY.mask_adjust_short-d;o.masking_lower=n(10,.1*d),this.quantize.init_outer_loop(o,b),this.quantize.init_xrpow(o,b,l)&&(this.quantize.qupvt.calc_xmin(a,i[p][h],b,_),this.quantize.outer_loop(a,b,_,l,h,f[h])),this.quantize.iteration_finish_one(o,p,h)}this.quantize.rv.ResvFrameEnd(o,u)}}function k(){this.floor=this.decay=this.adjustLimit=this.adjust=this.aaSensitivityP=this.useAdjust=0,this.l=t(H.SBMAX_l),this.s=t(H.SBMAX_s),this.psfb21=t(H.PSFB21),this.psfb12=t(H.PSFB12),this.cb_l=t(H.CBANDS),this.cb_s=t(H.CBANDS),this.eql_w=t(H.BLKSIZE/2)}function E(){this.l=e(1+H.SBMAX_l),this.s=e(1+H.SBMAX_s),this.psfb21=e(1+H.PSFB21),this.psfb12=e(1+H.PSFB12);var t=this.l,a=this.s;4==arguments.length&&(this.arrL=arguments[0],this.arrS=arguments[1],this.arr21=arguments[2],this.arr12=arguments[3],ne.arraycopy(this.arrL,0,t,0,i(this.arrL.length,this.l.length)),ne.arraycopy(this.arrS,0,a,0,i(this.arrS.length,this.s.length)),ne.arraycopy(this.arr21,0,this.psfb21,0,i(this.arr21.length,this.psfb21.length)),ne.arraycopy(this.arr12,0,this.psfb12,0,i(this.arr12.length,this.psfb12.length)))}function x(){function a(e,t){return t=l.ATHformula(t,e),n(10,(t-100)/10+e.ATHlower)}function s(e){this.s=e}var o=null,_=null,l=null;this.setModules=function(e,t,a){o=e,_=t,l=a},this.IPOW20=function(e){return d[e]};var c=x.IXMAX_VAL+2,u=x.Q_MAX,h=x.Q_MAX2;this.nr_of_sfb_block=[[[6,5,5,5],[9,9,9,9],[6,9,9,9]],[[6,5,7,3],[9,9,12,6],[6,9,12,6]],[[11,10,0,0],[18,18,0,0],[15,18,0,0]],[[7,7,7,0],[12,12,12,0],[6,15,12,0]],[[6,6,6,3],[12,9,9,6],[6,12,9,6]],[[8,8,5,0],[15,12,9,0],[6,18,9,0]]];var p=[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,2,2,3,3,3,2,0];this.pretab=p,this.sfBandIndex=[new E([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,24,32,42,56,74,100,132,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new E([0,6,12,18,24,30,36,44,54,66,80,96,114,136,162,194,232,278,332,394,464,540,576],[0,4,8,12,18,26,36,48,62,80,104,136,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new E([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new E([0,4,8,12,16,20,24,30,36,44,52,62,74,90,110,134,162,196,238,288,342,418,576],[0,4,8,12,16,22,30,40,52,66,84,106,136,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new E([0,4,8,12,16,20,24,30,36,42,50,60,72,88,106,128,156,190,230,276,330,384,576],[0,4,8,12,16,22,28,38,50,64,80,100,126,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new E([0,4,8,12,16,20,24,30,36,44,54,66,82,102,126,156,194,240,296,364,448,550,576],[0,4,8,12,16,22,30,42,58,78,104,138,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new E([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new E([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new E([0,12,24,36,48,60,72,88,108,132,160,192,232,280,336,400,476,566,568,570,572,574,576],[0,8,16,24,36,52,72,96,124,160,162,164,166,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0])];var b=t(u+h+1),d=t(u),v=t(c),g=t(c);this.adj43=g,this.iteration_init=function(e){var t=e.internal_flags,s=t.l3_side;if(0==t.iteration_init_init){t.iteration_init_init=1,s.main_data_begin=0,s=e.internal_flags.ATH.l;for(var r=e.internal_flags.ATH.psfb21,_=e.internal_flags.ATH.s,l=e.internal_flags.ATH.psfb12,f=e.internal_flags,p=e.out_samplerate,m=0;m<H.SBMAX_l;m++){var S=f.scalefac_band.l[m],R=f.scalefac_band.l[m+1];for(s[m]=ie.MAX_VALUE;S<R;S++){var A=S*p/1152;A=a(e,A),s[m]=i(s[m],A)}}for(m=0;m<H.PSFB21;m++)for(S=f.scalefac_band.psfb21[m],R=f.scalefac_band.psfb21[m+1],r[m]=ie.MAX_VALUE;S<R;S++)A=a(e,A=S*p/1152),r[m]=i(r[m],A);for(m=0;m<H.SBMAX_s;m++){for(S=f.scalefac_band.s[m],R=f.scalefac_band.s[m+1],_[m]=ie.MAX_VALUE;S<R;S++)A=a(e,A=S*p/384),_[m]=i(_[m],A);_[m]*=f.scalefac_band.s[m+1]-f.scalefac_band.s[m]}for(m=0;m<H.PSFB12;m++){for(S=f.scalefac_band.psfb12[m],R=f.scalefac_band.psfb12[m+1],l[m]=ie.MAX_VALUE;S<R;S++)A=a(e,A=S*p/384),l[m]=i(l[m],A);l[m]*=f.scalefac_band.s[13]-f.scalefac_band.s[12]}if(e.noATH){for(m=0;m<H.SBMAX_l;m++)s[m]=1e-20;for(m=0;m<H.PSFB21;m++)r[m]=1e-20;for(m=0;m<H.SBMAX_s;m++)_[m]=1e-20;for(m=0;m<H.PSFB12;m++)l[m]=1e-20}for(f.ATH.floor=10*T()(a(e,-1)),v[0]=0,s=1;s<c;s++)v[s]=n(s,4/3);for(s=0;s<c-1;s++)g[s]=s+1-n(.5*(v[s]+v[s+1]),.75);for(g[s]=.5,s=0;s<u;s++)d[s]=n(2,-.1875*(s-210));for(s=0;s<=u+h;s++)b[s]=n(2,.25*(s-210-h));for(o.huffman_init(t),32<=(s=63&e.exp_nspsytune>>2)&&(s-=64),r=n(10,s/4/10),32<=(s=63&e.exp_nspsytune>>8)&&(s-=64),_=n(10,s/4/10),32<=(s=63&e.exp_nspsytune>>14)&&(s-=64),l=n(10,s/4/10),32<=(s=63&e.exp_nspsytune>>20)&&(s-=64),e=l*n(10,s/4/10),s=0;s<H.SBMAX_l;s++)f=6>=s?r:13>=s?_:20>=s?l:e,t.nsPsy.longfact[s]=f;for(s=0;s<H.SBMAX_s;s++)f=5>=s?r:10>=s?_:11>=s?l:e,t.nsPsy.shortfact[s]=f}},this.on_pe=function(t,a,s,n,o,l){var f,c=t.internal_flags,u=0,h=e(2);u=new S(u),t=_.ResvMaxBits(t,n,u,l);var p=(u=u.bits)+t;for(p>X.MAX_BITS_PER_GRANULE&&(p=X.MAX_BITS_PER_GRANULE),f=l=0;f<c.channels_out;++f)s[f]=i(X.MAX_BITS_PER_CHANNEL,u/c.channels_out),h[f]=0|s[f]*a[o][f]/700-s[f],h[f]>3*n/4&&(h[f]=3*n/4),0>h[f]&&(h[f]=0),h[f]+s[f]>X.MAX_BITS_PER_CHANNEL&&(h[f]=r(0,X.MAX_BITS_PER_CHANNEL-s[f])),l+=h[f];if(l>t)for(f=0;f<c.channels_out;++f)h[f]=t*h[f]/l;for(f=0;f<c.channels_out;++f)s[f]+=h[f],t-=h[f];for(f=l=0;f<c.channels_out;++f)l+=s[f];if(l>X.MAX_BITS_PER_GRANULE)for(f=0;f<c.channels_out;++f)s[f]*=X.MAX_BITS_PER_GRANULE,s[f]/=l;return p},this.reduce_side=function(e,t,a,s){0>(t=.33*(.5-t)/.5)&&(t=0),.5<t&&(t=.5),(t=0|.5*t*(e[0]+e[1]))>X.MAX_BITS_PER_CHANNEL-e[0]&&(t=X.MAX_BITS_PER_CHANNEL-e[0]),0>t&&(t=0),125<=e[1]&&(125<e[1]-t?(e[0]<a&&(e[0]+=t),e[1]-=t):(e[0]+=e[1]-125,e[1]=125)),(t=e[0]+e[1])>s&&(e[0]=s*e[0]/t,e[1]=s*e[1]/t)},this.athAdjust=function(e,t,a){t=re.FAST_LOG10_X(t,10);var s=0;return t-=a,1e-20<(e*=e)&&(s=1+re.FAST_LOG10_X(e,10/90.30873362)),0>s&&(s=0),n(10,.1*(t*s+(a+90.30873362-94.82444863)))},this.calc_xmin=function(e,t,a,s){var n,r=0,i=e.internal_flags,o=0,_=0,l=i.ATH,c=a.xr,u=e.VBR==f.vbr_mtrh?1:0,h=i.masking_lower;for((e.VBR==f.vbr_mtrh||e.VBR==f.vbr_mt)&&(h=1),n=0;n<a.psy_lmax;n++){var p=e.VBR==f.vbr_rh||e.VBR==f.vbr_mtrh?athAdjust(l.adjust,l.l[n],l.floor):l.adjust*l.l[n],b=a.width[n],d=p/b,v=2220446049250313e-31,g=b>>1,S=0;do{var R=c[o]*c[o];S+=R,v+=R<d?R:d,S+=R=c[++o]*c[o],v+=R<d?R:d,o++}while(0<--g);S>p&&_++,n==H.SBPSY_l&&(v<(d=p*i.nsPsy.longfact[n])&&(v=d)),0!=u&&(p=v),e.ATHonly||0<(v=t.en.l[n])&&(d=S*t.thm.l[n]*h/v,0!=u&&(d*=i.nsPsy.longfact[n]),p<d&&(p=d)),s[r++]=0==u?p*i.nsPsy.longfact[n]:p}if(S=575,a.block_type!=H.SHORT_TYPE)for(p=576;0!=p--&&m.EQ(c[p],0);)S=p;a.max_nonzero_coeff=S;for(var A=a.sfb_smin;n<a.psymax;A++,n+=3){var B,w=e.VBR==f.vbr_rh||e.VBR==f.vbr_mtrh?athAdjust(l.adjust,l.s[A],l.floor):l.adjust*l.s[A];for(b=a.width[n],B=0;3>B;B++){S=0,g=b>>1,d=w/b,v=2220446049250313e-31;do{S+=R=c[o]*c[o],v+=R<d?R:d,S+=R=c[++o]*c[o],v+=R<d?R:d,o++}while(0<--g);S>w&&_++,A==H.SBPSY_s&&(v<(d=w*i.nsPsy.shortfact[A])&&(v=d)),p=0==u?w:v,e.ATHonly||e.ATHshort||0<(v=t.en.s[A][B])&&(d=S*t.thm.s[A][B]*h/v,0!=u&&(d*=i.nsPsy.shortfact[A]),p<d&&(p=d)),s[r++]=0==u?p*i.nsPsy.shortfact[A]:p}e.useTemporal&&(s[r-3]>s[r-3+1]&&(s[r-3+1]+=(s[r-3]-s[r-3+1])*i.decay),s[r-3+1]>s[r-3+2]&&(s[r-3+2]+=(s[r-3+1]-s[r-3+2])*i.decay))}return _},this.calc_noise_core=function(e,a,s,n){var r=0,i=a.s,o=e.l3_enc;if(i>e.count1)for(;0!=s--;){var _=e.xr[i];i++,r+=_*_,_=e.xr[i],i++,r+=_*_}else if(i>e.big_values){var l=t(2);for(l[0]=0,l[1]=n;0!=s--;)_=te(e.xr[i])-l[o[i]],i++,r+=_*_,_=te(e.xr[i])-l[o[i]],i++,r+=_*_}else for(;0!=s--;)_=te(e.xr[i])-v[o[i]]*n,i++,r+=_*_,_=te(e.xr[i])-v[o[i]]*n,i++,r+=_*_;return a.s=i,r},this.calc_noise=function(e,t,a,n,i){var o,_=0,l=0,f=0,c=0,u=0,h=-20,d=0,m=e.scalefac,v=0;for(o=n.over_SSD=0;o<e.psymax;o++){var g=e.global_gain-(m[v++]+(0==e.preflag?0:p[o])<<e.scalefac_scale+1)-8*e.subblock_gain[e.window[o]];if(null!=i&&i.step[o]==g){var S=i.noise[o];d+=e.width[o],a[_++]=S/t[l++],S=i.noise_log[o]}else{S=b[g+x.Q_MAX2];var R=e.width[o]>>1;d+e.width[o]>e.max_nonzero_coeff&&(R=0<(R=e.max_nonzero_coeff-d+1)?R>>1:0),d=new s(d),S=this.calc_noise_core(e,d,R,S),d=d.s,null!=i&&(i.step[o]=g,i.noise[o]=S),S=a[_++]=S/t[l++],S=re.FAST_LOG10(r(S,1e-20)),null!=i&&(i.noise_log[o]=S)}null!=i&&(i.global_gain=e.global_gain),u+=S,0<S&&(g=r(0|10*S+.5,1),n.over_SSD+=g*g,f++,c+=S),h=r(h,S)}return n.over_count=f,n.tot_noise=u,n.over_noise=c,n.max_noise=h,f},this.set_pinfo=function(e,a,s,n,i){var o,_,l=e.internal_flags,f=0==a.scalefac_scale?.5:1,c=a.scalefac,u=t(_e.SFBMAX),h=t(_e.SFBMAX),b=new A;calc_xmin(e,s,a,u),calc_noise(a,u,h,b,null);var d=0,m=a.sfb_lmax;for(a.block_type!=H.SHORT_TYPE&&0==a.mixed_block_flag&&(m=22),o=0;o<m;o++){var v=l.scalefac_band.l[o],g=l.scalefac_band.l[o+1],S=g-v;for(_=0;d<g;d++)_+=a.xr[d]*a.xr[d];_/=S;var R=1e15;l.pinfo.en[n][i][o]=R*_,l.pinfo.xfsf[n][i][o]=R*u[o]*h[o]/S,_=0<s.en.l[o]&&!e.ATHonly?_/s.en.l[o]:0,l.pinfo.thr[n][i][o]=R*r(_*s.thm.l[o],l.ATH.l[o]),l.pinfo.LAMEsfb[n][i][o]=0,0!=a.preflag&&11<=o&&(l.pinfo.LAMEsfb[n][i][o]=-f*p[o]),o<H.SBPSY_l&&(l.pinfo.LAMEsfb[n][i][o]-=f*c[o])}if(a.block_type==H.SHORT_TYPE)for(m=o,o=a.sfb_smin;o<H.SBMAX_s;o++){v=l.scalefac_band.s[o],S=(g=l.scalefac_band.s[o+1])-v;for(var B=0;3>B;B++){for(_=0,R=v;R<g;R++)_+=a.xr[d]*a.xr[d],d++;_=r(_/S,1e-20),R=1e15,l.pinfo.en_s[n][i][3*o+B]=R*_,l.pinfo.xfsf_s[n][i][3*o+B]=R*u[m]*h[m]/S,_=0<s.en.s[o][B]?_/s.en.s[o][B]:0,(e.ATHonly||e.ATHshort)&&(_=0),l.pinfo.thr_s[n][i][3*o+B]=R*r(_*s.thm.s[o][B],l.ATH.s[o]),l.pinfo.LAMEsfb_s[n][i][3*o+B]=-2*a.subblock_gain[B],o<H.SBPSY_s&&(l.pinfo.LAMEsfb_s[n][i][3*o+B]-=f*c[m]),m++}}l.pinfo.LAMEqss[n][i]=a.global_gain,l.pinfo.LAMEmainbits[n][i]=a.part2_3_length+a.part2_length,l.pinfo.LAMEsfbits[n][i]=a.part2_length,l.pinfo.over[n][i]=b.over_count,l.pinfo.max_noise[n][i]=10*b.max_noise,l.pinfo.over_noise[n][i]=10*b.over_noise,l.pinfo.tot_noise[n][i]=10*b.tot_noise,l.pinfo.over_SSD[n][i]=b.over_SSD}}function M(){this.sfb_count1=this.global_gain=0,this.step=e(39),this.noise=t(39),this.noise_log=t(39)}function I(){this.xr=t(576),this.l3_enc=e(576),this.scalefac=e(_e.SFBMAX),this.mixed_block_flag=this.block_type=this.scalefac_compress=this.global_gain=this.count1=this.big_values=this.part2_3_length=this.xrpow_max=0,this.table_select=e(3),this.subblock_gain=e(4),this.sfbdivide=this.psymax=this.sfbmax=this.psy_lmax=this.sfb_smin=this.sfb_lmax=this.part2_length=this.count1table_select=this.scalefac_scale=this.preflag=this.region1_count=this.region0_count=0,this.width=e(_e.SFBMAX),this.window=e(_e.SFBMAX),this.count1bits=0,this.sfb_partition_table=null,this.slen=e(4),this.max_nonzero_coeff=0;var a=this;this.assign=function(e){a.xr=new Float32Array(e.xr),a.l3_enc=new Int32Array(e.l3_enc),a.scalefac=new Int32Array(e.scalefac),a.xrpow_max=e.xrpow_max,a.part2_3_length=e.part2_3_length,a.big_values=e.big_values,a.count1=e.count1,a.global_gain=e.global_gain,a.scalefac_compress=e.scalefac_compress,a.block_type=e.block_type,a.mixed_block_flag=e.mixed_block_flag,a.table_select=new Int32Array(e.table_select),a.subblock_gain=new Int32Array(e.subblock_gain),a.region0_count=e.region0_count,a.region1_count=e.region1_count,a.preflag=e.preflag,a.scalefac_scale=e.scalefac_scale,a.count1table_select=e.count1table_select,a.part2_length=e.part2_length,a.sfb_lmax=e.sfb_lmax,a.sfb_smin=e.sfb_smin,a.psy_lmax=e.psy_lmax,a.sfbmax=e.sfbmax,a.psymax=e.psymax,a.sfbdivide=e.sfbdivide,a.width=new Int32Array(e.width),a.window=new Int32Array(e.window),a.count1bits=e.count1bits,a.sfb_partition_table=e.sfb_partition_table.slice(0),a.slen=new Int32Array(e.slen),a.max_nonzero_coeff=e.max_nonzero_coeff}}function P(){function e(e){this.ordinal=e}function a(e){for(var t=0;t<e.sfbmax;t++)if(0==e.scalefac[t]+e.subblock_gain[e.window[t]])return!1;return!0}var s,i;this.rv=null,this.qupvt=null;var o,_,l=new R;this.setModules=function(e,t,a,n){s=e,this.rv=i=t,this.qupvt=o=a,_=n,l.setModules(o,_)},this.ms_convert=function(e,t){for(var a=0;576>a;++a){var s=e.tt[t][0].xr[a],n=e.tt[t][1].xr[a];e.tt[t][0].xr[a]=.5*(s+n)*re.SQRT2,e.tt[t][1].xr[a]=.5*(s-n)*re.SQRT2}},this.init_xrpow=function(e,t,a){var s=0|t.max_nonzero_coeff;t.xrpow_max=0,se.fill(a,s,576,0);for(var n,r,i=n=0;i<=s;++i)n+=r=te(t.xr[i]),a[i]=$(r*$(r)),a[i]>t.xrpow_max&&(t.xrpow_max=a[i]);if(1e-20<n){for(a=0,0!=(2&e.substep_shaping)&&(a=1),s=0;s<t.psymax;s++)e.pseudohalf[s]=a;return!0}return se.fill(t.l3_enc,0,576,0),!1},this.init_outer_loop=function(e,a){a.part2_3_length=0,a.big_values=0,a.count1=0,a.global_gain=210,a.scalefac_compress=0,a.table_select[0]=0,a.table_select[1]=0,a.table_select[2]=0,a.subblock_gain[0]=0,a.subblock_gain[1]=0,a.subblock_gain[2]=0,a.subblock_gain[3]=0,a.region0_count=0,a.region1_count=0,a.preflag=0,a.scalefac_scale=0,a.count1table_select=0,a.part2_length=0,a.sfb_lmax=H.SBPSY_l,a.sfb_smin=H.SBPSY_s,a.psy_lmax=e.sfb21_extra?H.SBMAX_l:H.SBPSY_l,a.psymax=a.psy_lmax,a.sfbmax=a.sfb_lmax,a.sfbdivide=11;for(var s=0;s<H.SBMAX_l;s++)a.width[s]=e.scalefac_band.l[s+1]-e.scalefac_band.l[s],a.window[s]=3;if(a.block_type==H.SHORT_TYPE){var n=t(576);a.sfb_smin=0,a.sfb_lmax=0,0!=a.mixed_block_flag&&(a.sfb_smin=3,a.sfb_lmax=2*e.mode_gr+4),a.psymax=a.sfb_lmax+3*((e.sfb21_extra?H.SBMAX_s:H.SBPSY_s)-a.sfb_smin),a.sfbmax=a.sfb_lmax+3*(H.SBPSY_s-a.sfb_smin),a.sfbdivide=a.sfbmax-18,a.psy_lmax=a.sfb_lmax;var r=e.scalefac_band.l[a.sfb_lmax];for(ne.arraycopy(a.xr,0,n,0,576),s=a.sfb_smin;s<H.SBMAX_s;s++)for(var i=e.scalefac_band.s[s],_=e.scalefac_band.s[s+1],l=0;3>l;l++)for(var f=i;f<_;f++)a.xr[r++]=n[3*f+l];for(n=a.sfb_lmax,s=a.sfb_smin;s<H.SBMAX_s;s++)a.width[n]=a.width[n+1]=a.width[n+2]=e.scalefac_band.s[s+1]-e.scalefac_band.s[s],a.window[n]=0,a.window[n+1]=1,a.window[n+2]=2,n+=3}if(a.count1bits=0,a.sfb_partition_table=o.nr_of_sfb_block[0][0],a.slen[0]=0,a.slen[1]=0,a.slen[2]=0,a.slen[3]=0,a.max_nonzero_coeff=575,se.fill(a.scalefac,0),s=e.ATH,n=a.xr,a.block_type!=H.SHORT_TYPE)for(a=!1,r=H.PSFB21-1;0<=r&&!a;r--)for(i=e.scalefac_band.psfb21[r],_=e.scalefac_band.psfb21[r+1],l=o.athAdjust(s.adjust,s.psfb21[r],s.floor),1e-12<e.nsPsy.longfact[21]&&(l*=e.nsPsy.longfact[21]),--_;_>=i;_--){if(!(te(n[_])<l)){a=!0;break}n[_]=0}else for(l=0;3>l;l++)for(a=!1,r=H.PSFB12-1;0<=r&&!a;r--)for(_=(i=3*e.scalefac_band.s[12]+(e.scalefac_band.s[13]-e.scalefac_band.s[12])*l+(e.scalefac_band.psfb12[r]-e.scalefac_band.psfb12[0]))+(e.scalefac_band.psfb12[r+1]-e.scalefac_band.psfb12[r]),f=o.athAdjust(s.adjust,s.psfb12[r],s.floor),1e-12<e.nsPsy.shortfact[12]&&(f*=e.nsPsy.shortfact[12]),--_;_>=i;_--){if(!(te(n[_])<f)){a=!0;break}n[_]=0}},e.BINSEARCH_NONE=new e(0),e.BINSEARCH_UP=new e(1),e.BINSEARCH_DOWN=new e(2),this.trancate_smallspectrums=function(e,a,s,n){var r=t(_e.SFBMAX);if((0!=(4&e.substep_shaping)||a.block_type!=H.SHORT_TYPE)&&0==(128&e.substep_shaping)){o.calc_noise(a,s,r,new A,null);for(var i,l=0;576>l;l++)i=0,0!=a.l3_enc[l]&&(i=te(a.xr[l])),n[l]=i;l=0,i=8,a.block_type==H.SHORT_TYPE&&(i=6);do{var f,c,u=a.width[i];if(l+=u,!(1<=r[i]||(se.sort(n,l-u,u),m.EQ(n[l-1],0)))){var h=(1-r[i])*s[i],p=f=0;do{for(c=1;p+c<u&&!m.NEQ(n[p+l-u],n[p+l+c-u]);c++);var b=n[p+l-u]*n[p+l-u]*c;if(h<b){0!=p&&(f=n[p+l-u-1]);break}h-=b,p+=c}while(p<u);if(!m.EQ(f,0))do{te(a.xr[l-u])<=f&&(a.l3_enc[l-u]=0)}while(0<--u)}}while(++i<a.psymax);a.part2_3_length=_.noquant_count_bits(e,a,null)}},this.outer_loop=function(s,i,l,c,u,h){var p,b=s.internal_flags,d=new I,v=t(576),g=t(_e.SFBMAX),S=new A,R=new M,B=9999999,w=!1,y=!1,k=0,T=b.CurrentStep[u],E=!1,x=b.OldValue[u],P=e.BINSEARCH_NONE;for(i.global_gain=x,p=h-i.part2_length;;){var L=_.count_bits(b,c,i,null);if(1==T||L==p)break;L>p?(P==e.BINSEARCH_DOWN&&(E=!0),E&&(T/=2),P=e.BINSEARCH_UP,L=T):(P==e.BINSEARCH_UP&&(E=!0),E&&(T/=2),P=e.BINSEARCH_DOWN,L=-T),i.global_gain+=L,0>i.global_gain&&(i.global_gain=0,E=!0),255<i.global_gain&&(i.global_gain=255,E=!0)}for(;L>p&&255>i.global_gain;)i.global_gain++,L=_.count_bits(b,c,i,null);if(b.CurrentStep[u]=4<=x-i.global_gain?4:2,b.OldValue[u]=i.global_gain,i.part2_3_length=L,0==b.noise_shaping)return 100;for(o.calc_noise(i,l,g,S,R),S.bits=i.part2_3_length,d.assign(i),u=0,ne.arraycopy(c,0,v,0,576);!w;){do{if(p=new A,E=255,T=0==(2&b.substep_shaping)?3:20,b.sfb21_extra){if(1<g[d.sfbmax])break;if(d.block_type==H.SHORT_TYPE&&(1<g[d.sfbmax+1]||1<g[d.sfbmax+2]))break}x=d,L=c,P=s.internal_flags;for(var V=x,O=g,N=L,D=s.internal_flags,C=0==V.scalefac_scale?1.2968395546510096:1.6817928305074292,X=0,F=0;F<V.sfbmax;F++)X<O[F]&&(X=O[F]);switch(3==(F=D.noise_shaping_amp)&&(F=y?2:1),F){case 2:break;case 1:X=1<X?n(X,.5):.95*X;break;default:X=1<X?1:.95*X}var Y=0;for(F=0;F<V.sfbmax;F++){var q=V.width[F];if(Y+=q,!(O[F]<X)){if(0!=(2&D.substep_shaping)&&(D.pseudohalf[F]=0==D.pseudohalf[F]?1:0,0==D.pseudohalf[F]&&2==D.noise_shaping_amp))break;for(V.scalefac[F]++,q=-q;0>q;q++)N[Y+q]*=C,N[Y+q]>V.xrpow_max&&(V.xrpow_max=N[Y+q]);if(2==D.noise_shaping_amp)break}}if(C=a(x))x=!1;else if(C=2==P.mode_gr?_.scale_bitcount(x):_.scale_bitcount_lsf(P,x)){if(1<P.noise_shaping)if(se.fill(P.pseudohalf,0),0==x.scalefac_scale){for(C=x,O=V=0;O<C.sfbmax;O++){if(D=C.width[O],N=C.scalefac[O],0!=C.preflag&&(N+=o.pretab[O]),V+=D,0!=(1&N))for(N++,D=-D;0>D;D++)L[V+D]*=1.2968395546510096,L[V+D]>C.xrpow_max&&(C.xrpow_max=L[V+D]);C.scalefac[O]=N>>1}C.preflag=0,C.scalefac_scale=1,C=!1}else if(x.block_type==H.SHORT_TYPE&&0<P.subblock_gain){e:{for(C=P,O=L,N=(V=x).scalefac,L=0;L<V.sfb_lmax;L++)if(16<=N[L]){L=!0;break e}for(D=0;3>D;D++){for(F=X=0,L=V.sfb_lmax+D;L<V.sfbdivide;L+=3)X<N[L]&&(X=N[L]);for(;L<V.sfbmax;L+=3)F<N[L]&&(F=N[L]);if(!(16>X&&8>F)){if(7<=V.subblock_gain[D]){L=!0;break e}for(V.subblock_gain[D]++,X=C.scalefac_band.l[V.sfb_lmax],L=V.sfb_lmax+D;L<V.sfbmax;L+=3)if(F=V.width[L],Y=N[L],0<=(Y-=4>>V.scalefac_scale))N[L]=Y,X+=3*F;else{for(N[L]=0,Y=o.IPOW20(210+(Y<<V.scalefac_scale+1)),X+=F*(D+1),q=-F;0>q;q++)O[X+q]*=Y,O[X+q]>V.xrpow_max&&(V.xrpow_max=O[X+q]);X+=F*(3-D-1)}for(Y=o.IPOW20(202),X+=V.width[L]*(D+1),q=-V.width[L];0>q;q++)O[X+q]*=Y,O[X+q]>V.xrpow_max&&(V.xrpow_max=O[X+q])}}L=!1}C=L||a(x)}C||(C=2==P.mode_gr?_.scale_bitcount(x):_.scale_bitcount_lsf(P,x)),x=!C}else x=!0;if(!x)break;if(0!=d.scalefac_scale&&(E=254),0>=(x=h-d.part2_length))break;for(;(d.part2_3_length=_.count_bits(b,c,d,R))>x&&d.global_gain<=E;)d.global_gain++;if(d.global_gain>E)break;if(0==S.over_count){for(;(d.part2_3_length=_.count_bits(b,c,d,R))>B&&d.global_gain<=E;)d.global_gain++;if(d.global_gain>E)break}switch(o.calc_noise(d,l,g,p,R),p.bits=d.part2_3_length,E=S,x=p,C=d,L=g,P=i.block_type==H.SHORT_TYPE?s.quant_comp_short:s.quant_comp){default:case 9:0<E.over_count?(P=x.over_SSD<=E.over_SSD,x.over_SSD==E.over_SSD&&(P=x.bits<E.bits)):P=0>x.max_noise&&10*x.max_noise+x.bits<=10*E.max_noise+E.bits;break;case 0:P=x.over_count<E.over_count||x.over_count==E.over_count&&x.over_noise<E.over_noise||x.over_count==E.over_count&&m.EQ(x.over_noise,E.over_noise)&&x.tot_noise<E.tot_noise;break;case 8:for(P=x,O=1e-37,V=0;V<C.psymax;V++)N=L[V],O+=N=re.FAST_LOG10(.368+.632*N*N*N);P.max_noise=r(1e-20,O);case 1:P=x.max_noise<E.max_noise;break;case 2:P=x.tot_noise<E.tot_noise;break;case 3:P=x.tot_noise<E.tot_noise&&x.max_noise<E.max_noise;break;case 4:P=0>=x.max_noise&&.2<E.max_noise||0>=x.max_noise&&0>E.max_noise&&E.max_noise>x.max_noise-.2&&x.tot_noise<E.tot_noise||0>=x.max_noise&&0<E.max_noise&&E.max_noise>x.max_noise-.2&&x.tot_noise<E.tot_noise+E.over_noise||0<x.max_noise&&-.05<E.max_noise&&E.max_noise>x.max_noise-.1&&x.tot_noise+x.over_noise<E.tot_noise+E.over_noise||0<x.max_noise&&-.1<E.max_noise&&E.max_noise>x.max_noise-.15&&x.tot_noise+x.over_noise+x.over_noise<E.tot_noise+E.over_noise+E.over_noise;break;case 5:P=x.over_noise<E.over_noise||m.EQ(x.over_noise,E.over_noise)&&x.tot_noise<E.tot_noise;break;case 6:P=x.over_noise<E.over_noise||m.EQ(x.over_noise,E.over_noise)&&(x.max_noise<E.max_noise||m.EQ(x.max_noise,E.max_noise)&&x.tot_noise<=E.tot_noise);break;case 7:P=x.over_count<E.over_count||x.over_noise<E.over_noise}if(0==E.over_count&&(P=P&&x.bits<E.bits),0!=(P=P?1:0))B=i.part2_3_length,S=p,i.assign(d),u=0,ne.arraycopy(c,0,v,0,576);else if(0==b.full_outer_loop){if(++u>T&&0==S.over_count)break;if(3==b.noise_shaping_amp&&y&&30<u)break;if(3==b.noise_shaping_amp&&y&&15<d.global_gain-k)break}}while(255>d.global_gain+d.scalefac_scale);3==b.noise_shaping_amp?y?w=!0:(d.assign(i),ne.arraycopy(v,0,c,0,576),u=0,k=d.global_gain,y=!0):w=!0}return s.VBR==f.vbr_rh||s.VBR==f.vbr_mtrh?ne.arraycopy(v,0,c,0,576):0!=(1&b.substep_shaping)&&trancate_smallspectrums(b,i,l,c),S.over_count},this.iteration_finish_one=function(e,t,a){var s=e.l3_side,n=s.tt[t][a];_.best_scalefac_store(e,t,a,s),1==e.use_best_huffman&&_.best_huffman_divide(e,n),i.ResvAdjust(e,n)},this.VBR_encode_granule=function(e,a,s,n,r,i,o){var _=e.internal_flags,l=new I,f=t(576),c=o,u=(o+i)/2,h=0,p=_.sfb21_extra;se.fill(l.l3_enc,0);do{_.sfb21_extra=!(u>c-42)&&p;var b=outer_loop(e,a,s,n,r,u);0>=b?(h=1,o=a.part2_3_length,l.assign(a),ne.arraycopy(n,0,f,0,576),b=(o-=32)-i,u=(o+i)/2):(b=o-(i=u+32),u=(o+i)/2,0!=h&&(h=2,a.assign(l),ne.arraycopy(f,0,n,0,576)))}while(12<b);_.sfb21_extra=p,2==h&&ne.arraycopy(l.l3_enc,0,a.l3_enc,0,576)},this.get_framebits=function(e,t){var a=e.internal_flags;a.bitrate_index=a.VBR_min_bitrate,s.getframebits(e),a.bitrate_index=1;for(var n=s.getframebits(e),r=1;r<=a.VBR_max_bitrate;r++)a.bitrate_index=r,n=new S(n),t[r]=i.ResvFrameBegin(e,n),n=n.bits},this.VBR_old_prepare=function(e,t,a,s,r,_,l,f,c){var u=e.internal_flags,h=1,p=0;u.bitrate_index=u.VBR_max_bitrate;var b=i.ResvFrameBegin(e,new S(0))/u.mode_gr;get_framebits(e,_);for(var d,m=0;m<u.mode_gr;m++)for(d=o.on_pe(e,t,f[m],b,m,0),u.mode_ext==H.MPG_MD_MS_LR&&(ms_convert(u.l3_side,m),o.reduce_side(f[m],a[m],b,d)),d=0;d<u.channels_out;++d){var v=u.l3_side.tt[m][d];if(v.block_type!=H.SHORT_TYPE){var g=1.28/(1+J(3.5-t[m][d]/300))-.05;g=u.PSY.mask_adjust-g}else g=2.56/(1+J(3.5-t[m][d]/300))-.14,g=u.PSY.mask_adjust_short-g;u.masking_lower=n(10,.1*g),init_outer_loop(u,v),c[m][d]=o.calc_xmin(e,s[m][d],v,r[m][d]),0!=c[m][d]&&(h=0),l[m][d]=126,p+=f[m][d]}for(m=0;m<u.mode_gr;m++)for(d=0;d<u.channels_out;d++)p>_[u.VBR_max_bitrate]&&(f[m][d]*=_[u.VBR_max_bitrate],f[m][d]/=p),l[m][d]>f[m][d]&&(l[m][d]=f[m][d]);return h},this.bitpressure_strategy=function(e,t,a,s){for(var n=0;n<e.mode_gr;n++)for(var i=0;i<e.channels_out;i++){for(var o=e.l3_side.tt[n][i],_=t[n][i],l=0,f=0;f<o.psy_lmax;f++)_[l++]*=1+.029*f*f/H.SBMAX_l/H.SBMAX_l;if(o.block_type==H.SHORT_TYPE)for(f=o.sfb_smin;f<H.SBMAX_s;f++)_[l++]*=1+.029*f*f/H.SBMAX_s/H.SBMAX_s,_[l++]*=1+.029*f*f/H.SBMAX_s/H.SBMAX_s,_[l++]*=1+.029*f*f/H.SBMAX_s/H.SBMAX_s;s[n][i]=0|r(a[n][i],.9*s[n][i])}},this.VBR_new_prepare=function(e,t,a,s,r,_){var l=e.internal_flags,f=1,c=0,u=0;if(e.free_format){l.bitrate_index=0,c=new S(c);var h=i.ResvFrameBegin(e,c);c=c.bits,r[0]=h}else l.bitrate_index=l.VBR_max_bitrate,c=new S(c),i.ResvFrameBegin(e,c),c=c.bits,get_framebits(e,r),h=r[l.VBR_max_bitrate];for(r=0;r<l.mode_gr;r++){o.on_pe(e,t,_[r],c,r,0),l.mode_ext==H.MPG_MD_MS_LR&&ms_convert(l.l3_side,r);for(var p,b=0;b<l.channels_out;++b)p=l.l3_side.tt[r][b],l.masking_lower=n(10,.1*l.PSY.mask_adjust),init_outer_loop(l,p),0!=o.calc_xmin(e,a[r][b],p,s[r][b])&&(f=0),u+=_[r][b]}for(r=0;r<l.mode_gr;r++)for(b=0;b<l.channels_out;b++)u>h&&(_[r][b]*=h,_[r][b]/=u);return f},this.calc_target_bits=function(e,t,a,n,r,_){var l=e.internal_flags,f=l.l3_side;l.bitrate_index=l.VBR_max_bitrate;var c=new S(0);_[0]=i.ResvFrameBegin(e,c),l.bitrate_index=1,c=s.getframebits(e)-8*l.sideinfo_len,r[0]=c/(l.mode_gr*l.channels_out),c=e.VBR_mean_bitrate_kbps*e.framesize*1e3,0!=(1&l.substep_shaping)&&(c*=1.09),c/=e.out_samplerate,c-=8*l.sideinfo_len,c/=l.mode_gr*l.channels_out;var u=.93+.07*(11-e.compression_ratio)/5.5;for(.9>u&&(u=.9),1<u&&(u=1),e=0;e<l.mode_gr;e++){var h=0;for(r=0;r<l.channels_out;r++){if(n[e][r]=int(u*c),700<t[e][r]){var p=int((t[e][r]-700)/1.4),b=f.tt[e][r];n[e][r]=int(u*c),b.block_type==H.SHORT_TYPE&&p<c/2&&(p=c/2),p>3*c/2?p=3*c/2:0>p&&(p=0),n[e][r]+=p}n[e][r]>X.MAX_BITS_PER_CHANNEL&&(n[e][r]=X.MAX_BITS_PER_CHANNEL),h+=n[e][r]}if(h>X.MAX_BITS_PER_GRANULE)for(r=0;r<l.channels_out;++r)n[e][r]*=X.MAX_BITS_PER_GRANULE,n[e][r]/=h}if(l.mode_ext==H.MPG_MD_MS_LR)for(e=0;e<l.mode_gr;e++)o.reduce_side(n[e],a[e],c*l.channels_out,X.MAX_BITS_PER_GRANULE);for(e=t=0;e<l.mode_gr;e++)for(r=0;r<l.channels_out;r++)n[e][r]>X.MAX_BITS_PER_CHANNEL&&(n[e][r]=X.MAX_BITS_PER_CHANNEL),t+=n[e][r];if(t>_[0])for(e=0;e<l.mode_gr;e++)for(r=0;r<l.channels_out;r++)n[e][r]*=_[0],n[e][r]/=t}}function L(){function e(e,t,s){for(var n=10,r=t+238-14-286,i=-15;0>i;i++){var o=a[n+-10],_=e[r+-224]*o,l=e[t+224]*o;o=a[n+-9],_+=e[r+-160]*o,l+=e[t+160]*o,o=a[n+-8],_+=e[r+-96]*o,l+=e[t+96]*o,o=a[n+-7],_+=e[r+-32]*o,l+=e[t+32]*o,o=a[n+-6],_+=e[r+32]*o,l+=e[t+-32]*o,o=a[n+-5],_+=e[r+96]*o,l+=e[t+-96]*o,o=a[n+-4],_+=e[r+160]*o,l+=e[t+-160]*o,o=a[n+-3],_+=e[r+224]*o,l+=e[t+-224]*o,o=a[n+-2],_+=e[t+-256]*o,l-=e[r+256]*o,o=a[n+-1],_+=e[t+-192]*o,l-=e[r+192]*o,o=a[n+0],_+=e[t+-128]*o,l-=e[r+128]*o,o=a[n+1],_+=e[t+-64]*o,l-=e[r+64]*o,o=a[n+2],_+=e[t+0]*o,l-=e[r+0]*o,o=a[n+3],_+=e[t+64]*o,l-=e[r+-64]*o,o=a[n+4],_+=e[t+128]*o,l-=e[r+-128]*o,o=a[n+5],_+=e[t+192]*o,o=(l-=e[r+-192]*o)-(_*=a[n+6]),s[30+2*i]=l+_,s[31+2*i]=a[n+7]*o,n+=18,t--,r++}l=e[t+-16]*a[n+-10],_=e[t+-32]*a[n+-2],l+=(e[t+-48]-e[t+16])*a[n+-9],_+=e[t+-96]*a[n+-1],l+=(e[t+-80]+e[t+48])*a[n+-8],_+=e[t+-160]*a[n+0],l+=(e[t+-112]-e[t+80])*a[n+-7],_+=e[t+-224]*a[n+1],l+=(e[t+-144]+e[t+112])*a[n+-6],_-=e[t+32]*a[n+2],l+=(e[t+-176]-e[t+144])*a[n+-5],_-=e[t+96]*a[n+3],l+=(e[t+-208]+e[t+176])*a[n+-4],_-=e[t+160]*a[n+4],l+=(e[t+-240]-e[t+208])*a[n+-3],e=(_-=e[t+224])-l,t=_+l,l=s[14],_=s[15]-l,s[31]=t+l,s[30]=e+_,s[15]=e-_,s[14]=t-l,_=s[28]-s[0],s[0]+=s[28],s[28]=_*a[n+-36+7],_=s[29]-s[1],s[1]+=s[29],s[29]=_*a[n+-36+7],_=s[26]-s[2],s[2]+=s[26],s[26]=_*a[n+-72+7],_=s[27]-s[3],s[3]+=s[27],s[27]=_*a[n+-72+7],_=s[24]-s[4],s[4]+=s[24],s[24]=_*a[n+-108+7],_=s[25]-s[5],s[5]+=s[25],s[25]=_*a[n+-108+7],_=s[22]-s[6],s[6]+=s[22],s[22]=_*re.SQRT2,_=s[23]-s[7],s[7]+=s[23],s[23]=_*re.SQRT2-s[7],s[7]-=s[6],s[22]-=s[7],s[23]-=s[22],_=s[6],s[6]=s[31]-_,s[31]+=_,_=s[7],s[7]=s[30]-_,s[30]+=_,_=s[22],s[22]=s[15]-_,s[15]+=_,_=s[23],s[23]=s[14]-_,s[14]+=_,_=s[20]-s[8],s[8]+=s[20],s[20]=_*a[n+-180+7],_=s[21]-s[9],s[9]+=s[21],s[21]=_*a[n+-180+7],_=s[18]-s[10],s[10]+=s[18],s[18]=_*a[n+-216+7],_=s[19]-s[11],s[11]+=s[19],s[19]=_*a[n+-216+7],_=s[16]-s[12],s[12]+=s[16],s[16]=_*a[n+-252+7],_=s[17]-s[13],s[13]+=s[17],s[17]=_*a[n+-252+7],_=-s[20]+s[24],s[20]+=s[24],s[24]=_*a[n+-216+7],_=-s[21]+s[25],s[21]+=s[25],s[25]=_*a[n+-216+7],_=s[4]-s[8],s[4]+=s[8],s[8]=_*a[n+-216+7],_=s[5]-s[9],s[5]+=s[9],s[9]=_*a[n+-216+7],_=s[0]-s[12],s[0]+=s[12],s[12]=_*a[n+-72+7],_=s[1]-s[13],s[1]+=s[13],s[13]=_*a[n+-72+7],_=s[16]-s[28],s[16]+=s[28],s[28]=_*a[n+-72+7],_=-s[17]+s[29],s[17]+=s[29],s[29]=_*a[n+-72+7],_=re.SQRT2*(s[2]-s[10]),s[2]+=s[10],s[10]=_,_=re.SQRT2*(s[3]-s[11]),s[3]+=s[11],s[11]=_,_=re.SQRT2*(-s[18]+s[26]),s[18]+=s[26],s[26]=_-s[18],_=re.SQRT2*(-s[19]+s[27]),s[19]+=s[27],s[27]=_-s[19],_=s[2],s[19]-=s[3],s[3]-=_,s[2]=s[31]-_,s[31]+=_,_=s[3],s[11]-=s[19],s[18]-=_,s[3]=s[30]-_,s[30]+=_,_=s[18],s[27]-=s[11],s[19]-=_,s[18]=s[15]-_,s[15]+=_,_=s[19],s[10]-=_,s[19]=s[14]-_,s[14]+=_,_=s[10],s[11]-=_,s[10]=s[23]-_,s[23]+=_,_=s[11],s[26]-=_,s[11]=s[22]-_,s[22]+=_,_=s[26],s[27]-=_,s[26]=s[7]-_,s[7]+=_,_=s[27],s[27]=s[6]-_,s[6]+=_,_=re.SQRT2*(s[0]-s[4]),s[0]+=s[4],s[4]=_,_=re.SQRT2*(s[1]-s[5]),s[1]+=s[5],s[5]=_,_=re.SQRT2*(s[16]-s[20]),s[16]+=s[20],s[20]=_,_=re.SQRT2*(s[17]-s[21]),s[17]+=s[21],s[21]=_,_=-re.SQRT2*(s[8]-s[12]),s[8]+=s[12],s[12]=_-s[8],_=-re.SQRT2*(s[9]-s[13]),s[9]+=s[13],s[13]=_-s[9],_=-re.SQRT2*(s[25]-s[29]),s[25]+=s[29],s[29]=_-s[25],_=-re.SQRT2*(s[24]+s[28]),s[24]-=s[28],s[28]=_-s[24],_=s[24]-s[16],s[24]=_,_=s[20]-_,s[20]=_,_=s[28]-_,s[28]=_,_=s[25]-s[17],s[25]=_,_=s[21]-_,s[21]=_,_=s[29]-_,s[29]=_,_=s[17]-s[1],s[17]=_,_=s[9]-_,s[9]=_,_=s[25]-_,s[25]=_,_=s[5]-_,s[5]=_,_=s[21]-_,s[21]=_,_=s[13]-_,s[13]=_,_=s[29]-_,s[29]=_,_=s[1]-s[0],s[1]=_,_=s[16]-_,s[16]=_,_=s[17]-_,s[17]=_,_=s[8]-_,s[8]=_,_=s[9]-_,s[9]=_,_=s[24]-_,s[24]=_,_=s[25]-_,s[25]=_,_=s[4]-_,s[4]=_,_=s[5]-_,s[5]=_,_=s[20]-_,s[20]=_,_=s[21]-_,s[21]=_,_=s[12]-_,s[12]=_,_=s[13]-_,s[13]=_,_=s[28]-_,s[28]=_,_=s[29]-_,s[29]=_,_=s[0],s[0]+=s[31],s[31]-=_,_=s[1],s[1]+=s[30],s[30]-=_,_=s[16],s[16]+=s[15],s[15]-=_,_=s[17],s[17]+=s[14],s[14]-=_,_=s[8],s[8]+=s[23],s[23]-=_,_=s[9],s[9]+=s[22],s[22]-=_,_=s[24],s[24]+=s[7],s[7]-=_,_=s[25],s[25]+=s[6],s[6]-=_,_=s[4],s[4]+=s[27],s[27]-=_,_=s[5],s[5]+=s[26],s[26]-=_,_=s[20],s[20]+=s[11],s[11]-=_,_=s[21],s[21]+=s[10],s[10]-=_,_=s[12],s[12]+=s[19],s[19]-=_,_=s[13],s[13]+=s[18],s[18]-=_,_=s[28],s[28]+=s[3],s[3]-=_,_=s[29],s[29]+=s[2],s[2]-=_}var a=[-.1482523854003001,32.308141959636465,296.40344946382766,883.1344870032432,11113.947376231741,1057.2713659324597,305.7402417275812,30.825928907280012,3.8533188138216365,59.42900443849514,709.5899960123345,5281.91112291017,-5829.66483675846,-817.6293103748613,-76.91656988279972,-4.594269939176596,.9063471690191471,.1960342806591213,-.15466694054279598,34.324387823855965,301.8067566458425,817.599602898885,11573.795901679885,1181.2520595540152,321.59731579894424,31.232021761053772,3.7107095756221318,53.650946155329365,684.167428119626,5224.56624370173,-6366.391851890084,-908.9766368219582,-89.83068876699639,-5.411397422890401,.8206787908286602,.3901806440322567,-.16070888947830023,36.147034243915876,304.11815768187864,732.7429163887613,11989.60988270091,1300.012278487897,335.28490093152146,31.48816102859945,3.373875931311736,47.232241542899175,652.7371796173471,5132.414255594984,-6909.087078780055,-1001.9990371107289,-103.62185754286375,-6.104916304710272,.7416505462720353,.5805693545089249,-.16636367662261495,37.751650073343995,303.01103387567713,627.9747488785183,12358.763425278165,1412.2779918482834,346.7496836825721,31.598286663170416,3.1598635433980946,40.57878626349686,616.1671130880391,5007.833007176154,-7454.040671756168,-1095.7960341867115,-118.24411666465777,-6.818469345853504,.6681786379192989,.7653668647301797,-.1716176790982088,39.11551877123304,298.3413246578966,503.5259106886539,12679.589408408976,1516.5821921214542,355.9850766329023,31.395241710249053,2.9164211881972335,33.79716964664243,574.8943997801362,4853.234992253242,-7997.57021486075,-1189.7624067269965,-133.6444792601766,-7.7202770609839915,.5993769336819237,.9427934736519954,-.17645823955292173,40.21879108166477,289.9982036694474,359.3226160751053,12950.259102786438,1612.1013903507662,362.85067106591504,31.045922092242872,2.822222032597987,26.988862316190684,529.8996541764288,4671.371946949588,-8535.899136645805,-1282.5898586244496,-149.58553632943463,-8.643494270763135,.5345111359507916,1.111140466039205,-.36174739330527045,41.04429910497807,277.5463268268618,195.6386023135583,13169.43812144731,1697.6433561479398,367.40983966190305,30.557037410382826,2.531473372857427,20.070154905927314,481.50208566532336,4464.970341588308,-9065.36882077239,-1373.62841526722,-166.1660487028118,-9.58289321133207,.4729647758913199,1.268786568327291,-.36970682634889585,41.393213350082036,261.2935935556502,12.935476055240873,13336.131683328815,1772.508612059496,369.76534388639965,29.751323653701338,2.4023193045459172,13.304795348228817,430.5615775526625,4237.0568611071185,-9581.931701634761,-1461.6913552409758,-183.12733958476446,-10.718010163869403,.41421356237309503,1.414213562373095,-.37677560326535325,41.619486213528496,241.05423794991074,-187.94665032361226,13450.063605744153,1836.153896465782,369.4908799925761,29.001847876923147,2.0714759319987186,6.779591200894186,377.7767837205709,3990.386575512536,-10081.709459700915,-1545.947424837898,-200.3762958015653,-11.864482073055006,.3578057213145241,1.546020906725474,-.3829366947518991,41.1516456456653,216.47684307105183,-406.1569483347166,13511.136535077321,1887.8076599260432,367.3025214564151,28.136213436723654,1.913880671464418,.3829366947518991,323.85365704338597,3728.1472257487526,-10561.233882199509,-1625.2025997821418,-217.62525175416,-13.015432208941645,.3033466836073424,1.66293922460509,-.5822628872992417,40.35639251440489,188.20071124269245,-640.2706748618148,13519.21490106562,1927.6022433578062,362.8197642637487,26.968821921868447,1.7463817695935329,-5.62650678237171,269.3016715297017,3453.386536448852,-11016.145278780888,-1698.6569643425091,-234.7658734267683,-14.16351421663124,.2504869601913055,1.76384252869671,-.5887180101749253,39.23429103868072,155.76096234403798,-889.2492977967378,13475.470561874661,1955.0535223723712,356.4450994756727,25.894952980042156,1.5695032905781554,-11.181939564328772,214.80884394039484,3169.1640829158237,-11443.321309975563,-1765.1588461316153,-251.68908574481912,-15.49755935939164,.198912367379658,1.847759065022573,-.7912582233652842,37.39369355329111,119.699486012458,-1151.0956593239027,13380.446257078214,1970.3952110853447,348.01959814116185,24.731487364283044,1.3850130831637748,-16.421408865300393,161.05030052864092,2878.3322807850063,-11838.991423510031,-1823.985884688674,-268.2854986386903,-16.81724543849939,.1483359875383474,1.913880671464418,-.7960642926861912,35.2322109610459,80.01928065061526,-1424.0212633405113,13235.794061869668,1973.804052543835,337.9908651258184,23.289159354463873,1.3934255946442087,-21.099669467133474,108.48348407242611,2583.700758091299,-12199.726194855148,-1874.2780658979746,-284.2467154529415,-18.11369784385905,.09849140335716425,1.961570560806461,-.998795456205172,32.56307803611191,36.958364584370486,-1706.075448829146,13043.287458812016,1965.3831106103316,326.43182772364605,22.175018750622293,1.198638339011324,-25.371248002043963,57.53505923036915,2288.41886619975,-12522.674544337233,-1914.8400385312243,-299.26241273417224,-19.37805630698734,.04912684976946725,1.990369453344394,.0178904535*re.SQRT2/2384e-9,.008938074*re.SQRT2/2384e-9,.0015673635*re.SQRT2/2384e-9,.001228571*re.SQRT2/2384e-9,.0004856585*re.SQRT2/2384e-9,109434e-9*re.SQRT2/2384e-9,50783e-9*re.SQRT2/2384e-9,6914e-9*re.SQRT2/2384e-9,12804.797818791945,1945.5515939597317,313.4244966442953,20.801593959731544,1995.1556208053692,9.000838926174497,-29.20218120805369],s=[[2382191739347913e-28,6423305872147834e-28,9400849094049688e-28,1122435026096556e-27,1183840321267481e-27,1122435026096556e-27,940084909404969e-27,6423305872147839e-28,2382191739347918e-28,5456116108943412e-27,4878985199565852e-27,4240448995017367e-27,3559909094758252e-27,2858043359288075e-27,2156177623817898e-27,1475637723558783e-27,8371015190102974e-28,2599706096327376e-28,-5456116108943412e-27,-4878985199565852e-27,-4240448995017367e-27,-3559909094758252e-27,-2858043359288076e-27,-2156177623817898e-27,-1475637723558783e-27,-8371015190102975e-28,-2599706096327376e-28,-2382191739347923e-28,-6423305872147843e-28,-9400849094049696e-28,-1122435026096556e-27,-1183840321267481e-27,-1122435026096556e-27,-9400849094049694e-28,-642330587214784e-27,-2382191739347918e-28],[2382191739347913e-28,6423305872147834e-28,9400849094049688e-28,1122435026096556e-27,1183840321267481e-27,1122435026096556e-27,9400849094049688e-28,6423305872147841e-28,2382191739347918e-28,5456116108943413e-27,4878985199565852e-27,4240448995017367e-27,3559909094758253e-27,2858043359288075e-27,2156177623817898e-27,1475637723558782e-27,8371015190102975e-28,2599706096327376e-28,-5461314069809755e-27,-4921085770524055e-27,-4343405037091838e-27,-3732668368707687e-27,-3093523840190885e-27,-2430835727329465e-27,-1734679010007751e-27,-974825365660928e-27,-2797435120168326e-28,0,0,0,0,0,0,-2283748241799531e-28,-4037858874020686e-28,-2146547464825323e-28],[.1316524975873958,.414213562373095,.7673269879789602,1.091308501069271,1.303225372841206,1.56968557711749,1.920982126971166,2.414213562373094,3.171594802363212,4.510708503662055,7.595754112725146,22.90376554843115,.984807753012208,.6427876096865394,.3420201433256688,.9396926207859084,-.1736481776669303,-.7660444431189779,.8660254037844387,.5,-.5144957554275265,-.4717319685649723,-.3133774542039019,-.1819131996109812,-.09457419252642064,-.04096558288530405,-.01419856857247115,-.003699974673760037,.8574929257125442,.8817419973177052,.9496286491027329,.9833145924917901,.9955178160675857,.9991605581781475,.999899195244447,.9999931550702802],[0,0,0,0,0,0,2283748241799531e-28,4037858874020686e-28,2146547464825323e-28,5461314069809755e-27,4921085770524055e-27,4343405037091838e-27,3732668368707687e-27,3093523840190885e-27,2430835727329466e-27,1734679010007751e-27,974825365660928e-27,2797435120168326e-28,-5456116108943413e-27,-4878985199565852e-27,-4240448995017367e-27,-3559909094758253e-27,-2858043359288075e-27,-2156177623817898e-27,-1475637723558782e-27,-8371015190102975e-28,-2599706096327376e-28,-2382191739347913e-28,-6423305872147834e-28,-9400849094049688e-28,-1122435026096556e-27,-1183840321267481e-27,-1122435026096556e-27,-9400849094049688e-28,-6423305872147841e-28,-2382191739347918e-28]],n=s[H.SHORT_TYPE],r=s[H.SHORT_TYPE],i=s[H.SHORT_TYPE],o=s[H.SHORT_TYPE],_=[0,1,16,17,8,9,24,25,4,5,20,21,12,13,28,29,2,3,18,19,10,11,26,27,6,7,22,23,14,15,30,31];this.mdct_sub48=function(a,l,f){for(var c=286,u=0;u<a.channels_out;u++){for(var h=0;h<a.mode_gr;h++){for(var p,b=a.l3_side.tt[h][u],d=b.xr,m=0,v=a.sb_sample[u][1-h],g=0,S=0;9>S;S++)for(e(l,c,v[g]),e(l,c+32,v[g+1]),g+=2,c+=64,p=1;32>p;p+=2)v[g-1][p]*=-1;for(p=0;32>p;p++,m+=18){v=b.block_type,g=a.sb_sample[u][h];var R=a.sb_sample[u][1-h];if(0!=b.mixed_block_flag&&2>p&&(v=0),1e-12>a.amp_filter[p])se.fill(d,m+0,m+18,0);else{if(1>a.amp_filter[p])for(S=0;18>S;S++)R[S][_[p]]*=a.amp_filter[p];if(v==H.SHORT_TYPE){for(S=-3;0>S;S++){var A=s[H.SHORT_TYPE][S+3];d[m+3*S+9]=g[9+S][_[p]]*A-g[8-S][_[p]],d[m+3*S+18]=g[14-S][_[p]]*A+g[15+S][_[p]],d[m+3*S+10]=g[15+S][_[p]]*A-g[14-S][_[p]],d[m+3*S+19]=R[2-S][_[p]]*A+R[3+S][_[p]],d[m+3*S+11]=R[3+S][_[p]]*A-R[2-S][_[p]],d[m+3*S+20]=R[8-S][_[p]]*A+R[9+S][_[p]]}for(S=d,g=m,A=0;3>A;A++){var B=S[g+6]*s[H.SHORT_TYPE][0]-S[g+15],w=B+(R=S[g+0]*s[H.SHORT_TYPE][2]-S[g+9]),y=B-R,k=(B=S[g+15]*s[H.SHORT_TYPE][0]+S[g+6])+(R=S[g+9]*s[H.SHORT_TYPE][2]+S[g+0]),T=-B+R;R=2069978111953089e-26*(S[g+3]*s[H.SHORT_TYPE][1]-S[g+12]),B=2069978111953089e-26*(S[g+12]*s[H.SHORT_TYPE][1]+S[g+3]),S[g+0]=190752519173728e-25*w+R,S[g+15]=190752519173728e-25*-k+B,y*=16519652744032674e-27,k=9537625958686404e-27*k+B,S[g+3]=y-k,S[g+6]=y+k,w=9537625958686404e-27*w-R,T*=16519652744032674e-27,S[g+9]=w+T,S[g+12]=w-T,g++}}else{for(A=t(18),S=-9;0>S;S++)w=s[v][S+27]*R[S+9][_[p]]+s[v][S+36]*R[8-S][_[p]],y=s[v][S+9]*g[S+9][_[p]]-s[v][S+18]*g[8-S][_[p]],A[S+9]=w-y*n[3+S+9],A[S+18]=w*n[3+S+9]+y;S=d,g=m;var E=(w=A)[17]-w[9],x=w[15]-w[11],M=w[14]-w[12];T=w[0]+w[8],k=w[1]+w[7],B=w[2]+w[6],y=w[3]+w[5],S[g+17]=T+B-y-(k-w[4]),A=(T+B-y)*r[19]+(k-w[4]),R=(E-x-M)*r[18],S[g+5]=R+A,S[g+6]=R-A;var I=(w[16]-w[10])*r[18];k=k*r[19]+w[4],R=E*r[12]+I+x*r[13]+M*r[14],A=-T*r[16]+k-B*r[17]+y*r[15],S[g+1]=R+A,S[g+2]=R-A,R=E*r[13]-I-x*r[14]+M*r[12],A=-T*r[17]+k-B*r[15]+y*r[16],S[g+9]=R+A,S[g+10]=R-A,R=E*r[14]-I+x*r[12]-M*r[13],A=T*r[15]-k+B*r[16]-y*r[17],S[g+13]=R+A,S[g+14]=R-A,E=w[8]-w[0],x=w[6]-w[2],M=w[5]-w[3],T=w[17]+w[9],k=w[16]+w[10],B=w[15]+w[11],y=w[14]+w[12],S[g+0]=T+B+y+(k+w[13]),R=(T+B+y)*r[19]-(k+w[13]),A=(E-x+M)*r[18],S[g+11]=R+A,S[g+12]=R-A,I=(w[7]-w[1])*r[18],k=w[13]-k*r[19],R=T*r[15]-k+B*r[16]+y*r[17],A=E*r[14]+I+x*r[12]+M*r[13],S[g+3]=R+A,S[g+4]=R-A,R=-T*r[17]+k-B*r[15]-y*r[16],A=E*r[13]+I-x*r[14]-M*r[12],S[g+7]=R+A,S[g+8]=R-A,R=-T*r[16]+k-B*r[17]-y*r[15],A=E*r[12]-I+x*r[13]-M*r[14],S[g+15]=R+A,S[g+16]=R-A}}if(v!=H.SHORT_TYPE&&0!=p)for(S=7;0<=S;--S)v=d[m+S]*i[20+S]+d[m+-1-S]*o[28+S],g=d[m+S]*o[28+S]-d[m+-1-S]*i[20+S],d[m+-1-S]=v,d[m+S]=g}}if(l=f,c=286,1==a.mode_gr)for(h=0;18>h;h++)ne.arraycopy(a.sb_sample[u][1][h],0,a.sb_sample[u][0][h],0,32)}}}function V(){this.thm=new C,this.en=new C}function H(){var s=H.FFTOFFSET,n=H.MPG_MD_MS_LR,i=null,o=this.psy=null,l=null,u=null;this.setModules=function(e,t,a,s){i=e,o=this.psy=t,l=s,u=a};var h=new L;this.lame_encode_mp3_frame=function(p,b,d,m,v,g){var S=_([2,2]);S[0][0]=new V,S[0][1]=new V,S[1][0]=new V,S[1][1]=new V;var R=_([2,2]);R[0][0]=new V,R[0][1]=new V,R[1][0]=new V,R[1][1]=new V;var A,B,w=[null,null],y=p.internal_flags,k=a([2,4]),T=[.5,.5],E=[[0,0],[0,0]],x=[[0,0],[0,0]];if((w[0]=b,w[1]=d,0==y.lame_encode_frame_init)&&0==(b=p.internal_flags).lame_encode_frame_init){d=t(2014);var M=t(2014);for(b.lame_encode_frame_init=1,B=A=0;A<286+576*(1+b.mode_gr);++A)A<576*b.mode_gr?(d[A]=0,2==b.channels_out&&(M[A]=0)):(d[A]=w[0][B],2==b.channels_out&&(M[A]=w[1][B]),++B);for(B=0;B<b.mode_gr;B++)for(A=0;A<b.channels_out;A++)b.l3_side.tt[B][A].block_type=H.SHORT_TYPE;h.mdct_sub48(b,d,M)}if(y.padding=0,0>(y.slot_lag-=y.frac_SpF)&&(y.slot_lag+=p.out_samplerate,y.padding=1),0!=y.psymodel)for(M=[null,null],A=0,B=e(2),d=0;d<y.mode_gr;d++){for(b=0;b<y.channels_out;b++)M[b]=w[b],A=576+576*d-H.FFTOFFSET;if(0!=(b=p.VBR==f.vbr_mtrh||p.VBR==f.vbr_mt?o.L3psycho_anal_vbr(p,M,A,d,S,R,E[d],x[d],k[d],B):o.L3psycho_anal_ns(p,M,A,d,S,R,E[d],x[d],k[d],B)))return-4;for(p.mode==c.JOINT_STEREO&&(T[d]=k[d][2]+k[d][3],0<T[d]&&(T[d]=k[d][3]/T[d])),b=0;b<y.channels_out;b++){var I=y.l3_side.tt[d][b];I.block_type=B[b],I.mixed_block_flag=0}}else for(d=0;d<y.mode_gr;d++)for(b=0;b<y.channels_out;b++)y.l3_side.tt[d][b].block_type=H.NORM_TYPE,y.l3_side.tt[d][b].mixed_block_flag=0,x[d][b]=E[d][b]=700;if(0==y.ATH.useAdjust?y.ATH.adjust=1:(b=y.loudness_sq[0][0],k=y.loudness_sq[1][0],2==y.channels_out?(b+=y.loudness_sq[0][1],k+=y.loudness_sq[1][1]):(b+=b,k+=k),2==y.mode_gr&&(b=r(b,k)),.03125<(b=.5*b*y.ATH.aaSensitivityP)?(1<=y.ATH.adjust?y.ATH.adjust=1:y.ATH.adjust<y.ATH.adjustLimit&&(y.ATH.adjust=y.ATH.adjustLimit),y.ATH.adjustLimit=1):(k=31.98*b+625e-6,y.ATH.adjust>=k?(y.ATH.adjust*=.075*k+.925,y.ATH.adjust<k&&(y.ATH.adjust=k)):y.ATH.adjustLimit>=k?y.ATH.adjust=k:y.ATH.adjust<y.ATH.adjustLimit&&(y.ATH.adjust=y.ATH.adjustLimit),y.ATH.adjustLimit=k)),h.mdct_sub48(y,w[0],w[1]),y.mode_ext=H.MPG_MD_LR_LR,p.force_ms)y.mode_ext=H.MPG_MD_MS_LR;else if(p.mode==c.JOINT_STEREO){for(d=M=k=0;d<y.mode_gr;d++)for(b=0;b<y.channels_out;b++)k+=x[d][b],M+=E[d][b];k<=1*M&&(k=y.l3_side.tt[0],b=y.l3_side.tt[y.mode_gr-1],k[0].block_type==k[1].block_type&&b[0].block_type==b[1].block_type&&(y.mode_ext=H.MPG_MD_MS_LR))}if(y.mode_ext==n&&(S=R,E=x),p.analysis&&null!=y.pinfo)for(d=0;d<y.mode_gr;d++)for(b=0;b<y.channels_out;b++)y.pinfo.ms_ratio[d]=y.ms_ratio[d],y.pinfo.ms_ener_ratio[d]=T[d],y.pinfo.blocktype[d][b]=y.l3_side.tt[d][b].block_type,y.pinfo.pe[d][b]=E[d][b],ne.arraycopy(y.l3_side.tt[d][b].xr,0,y.pinfo.xr[d][b],0,576),y.mode_ext==n&&(y.pinfo.ers[d][b]=y.pinfo.ers[d][b+2],ne.arraycopy(y.pinfo.energy[d][b+2],0,y.pinfo.energy[d][b],0,y.pinfo.energy[d][b].length));if(p.VBR==f.vbr_off||p.VBR==f.vbr_abr){for(R=0;18>R;R++)y.nsPsy.pefirbuf[R]=y.nsPsy.pefirbuf[R+1];for(d=x=0;d<y.mode_gr;d++)for(b=0;b<y.channels_out;b++)x+=E[d][b];for(y.nsPsy.pefirbuf[18]=x,x=y.nsPsy.pefirbuf[9],R=0;9>R;R++)x+=(y.nsPsy.pefirbuf[R]+y.nsPsy.pefirbuf[18-R])*H.fircoef[R];for(x=3350*y.mode_gr*y.channels_out/x,d=0;d<y.mode_gr;d++)for(b=0;b<y.channels_out;b++)E[d][b]*=x}if(y.iteration_loop.iteration_loop(p,E,T,S),i.format_bitstream(p),m=i.copy_buffer(y,m,v,g,1),p.bWriteVbrTag&&l.addVbrFrame(p),p.analysis&&null!=y.pinfo){for(b=0;b<y.channels_out;b++){for(v=0;v<s;v++)y.pinfo.pcmdata[b][v]=y.pinfo.pcmdata[b][v+p.framesize];for(v=s;1600>v;v++)y.pinfo.pcmdata[b][v]=w[b][v-s]}u.set_frame_pinfo(p,S)}for(y.bitrate_stereoMode_Hist[y.bitrate_index][4]++,y.bitrate_stereoMode_Hist[15][4]++,2==y.channels_out&&(y.bitrate_stereoMode_Hist[y.bitrate_index][y.mode_ext]++,y.bitrate_stereoMode_Hist[15][y.mode_ext]++),p=0;p<y.mode_gr;++p)for(w=0;w<y.channels_out;++w)v=0|y.l3_side.tt[p][w].block_type,0!=y.l3_side.tt[p][w].mixed_block_flag&&(v=4),y.bitrate_blockType_Hist[y.bitrate_index][v]++,y.bitrate_blockType_Hist[y.bitrate_index][5]++,y.bitrate_blockType_Hist[15][v]++,y.bitrate_blockType_Hist[15][5]++;return m}}function O(){this.size=this.pos=this.want=this.seen=this.sum=0,this.bag=null,this.TotalFrameSize=this.nBytesWritten=this.nVbrNumFrames=0}function N(){this.tt=[[null,null],[null,null]],this.resvDrain_post=this.resvDrain_pre=this.private_bits=this.main_data_begin=0,this.scfsi=[e(4),e(4)];for(var t=0;2>t;t++)for(var a=0;2>a;a++)this.tt[t][a]=new I}function D(){this.last_en_subshort=a([4,9]),this.lastAttacks=e(4),this.pefirbuf=t(19),this.longfact=t(H.SBMAX_l),this.shortfact=t(H.SBMAX_s),this.attackthre_s=this.attackthre=0}function C(){this.l=t(H.SBMAX_l),this.s=a([H.SBMAX_s,3]);var e=this;this.assign=function(t){ne.arraycopy(t.l,0,e.l,0,H.SBMAX_l);for(var a=0;a<H.SBMAX_s;a++)for(var s=0;3>s;s++)e.s[a][s]=t.s[a][s]}}function X(){function s(){this.ptr=this.write_timing=0,this.buf=new Int8Array(40)}this.fill_buffer_resample_init=this.iteration_init_init=this.lame_encode_frame_init=this.Class_ID=0,this.mfbuf=a([2,X.MFSIZE]),this.full_outer_loop=this.use_best_huffman=this.subblock_gain=this.noise_shaping_stop=this.psymodel=this.substep_shaping=this.noise_shaping_amp=this.noise_shaping=this.highpass2=this.highpass1=this.lowpass2=this.lowpass1=this.mode_ext=this.samplerate_index=this.bitrate_index=this.VBR_max_bitrate=this.VBR_min_bitrate=this.mf_size=this.mf_samples_to_encode=this.resample_ratio=this.channels_out=this.channels_in=this.mode_gr=0,this.l3_side=new N,this.ms_ratio=t(2),this.slot_lag=this.frac_SpF=this.padding=0,this.tag_spec=null,this.nMusicCRC=0,this.OldValue=e(2),this.CurrentStep=e(2),this.masking_lower=0,this.bv_scf=e(576),this.pseudohalf=e(_e.SFBMAX),this.sfb21_extra=!1,this.inbuf_old=[,,],this.blackfilt=Array(2*X.BPC+1),this.itime=new Float64Array(2),this.sideinfo_len=0,this.sb_sample=a([2,2,18,H.SBLIMIT]),this.amp_filter=t(32),this.header=Array(X.MAX_HEADER_BUF),this.ResvMax=this.ResvSize=this.ancillary_flag=this.w_ptr=this.h_ptr=0,this.scalefac_band=new E,this.minval_l=t(H.CBANDS),this.minval_s=t(H.CBANDS),this.nb_1=a([4,H.CBANDS]),this.nb_2=a([4,H.CBANDS]),this.nb_s1=a([4,H.CBANDS]),this.nb_s2=a([4,H.CBANDS]),this.s3_ll=this.s3_ss=null,this.decay=0,this.thm=[,,,,],this.en=[,,,,],this.tot_ener=t(4),this.loudness_sq=a([2,2]),this.loudness_sq_save=t(2),this.mld_l=t(H.SBMAX_l),this.mld_s=t(H.SBMAX_s),this.bm_l=e(H.SBMAX_l),this.bo_l=e(H.SBMAX_l),this.bm_s=e(H.SBMAX_s),this.bo_s=e(H.SBMAX_s),this.npart_s=this.npart_l=0,this.s3ind=o([H.CBANDS,2]),this.s3ind_s=o([H.CBANDS,2]),this.numlines_s=e(H.CBANDS),this.numlines_l=e(H.CBANDS),this.rnumlines_l=t(H.CBANDS),this.mld_cb_l=t(H.CBANDS),this.mld_cb_s=t(H.CBANDS),this.numlines_l_num1=this.numlines_s_num1=0,this.pe=t(4),this.ms_ener_ratio_old=this.ms_ratio_l_old=this.ms_ratio_s_old=0,this.blocktype_old=e(2),this.nsPsy=new D,this.VBR_seek_table=new O,this.PSY=this.ATH=null,this.nogap_current=this.nogap_total=0,this.findPeakSample=this.findReplayGain=this.decode_on_the_fly=!0,this.AudiophileGain=this.RadioGain=this.PeakSample=0,this.rgdata=null,this.noclipScale=this.noclipGainChange=0,this.bitrate_stereoMode_Hist=o([16,5]),this.bitrate_blockType_Hist=o([16,6]),this.hip=this.pinfo=null,this.in_buffer_nsamples=0,this.iteration_loop=this.in_buffer_1=this.in_buffer_0=null;for(var n=0;n<this.en.length;n++)this.en[n]=new C;for(n=0;n<this.thm.length;n++)this.thm[n]=new C;for(n=0;n<this.header.length;n++)this.header[n]=new s}function F(){function e(e,t,a){var s=0,r=t+(a<<=1),i=4;do{var o,_=i>>1,l=i,f=i<<1,c=f+l;i=f<<1;var u=t,h=u+_;do{var p=e[u+0]-e[u+l],b=e[u+0]+e[u+l],d=e[u+f]-e[u+c],m=e[u+f]+e[u+c];e[u+f]=b-m,e[u+0]=b+m,e[u+c]=p-d,e[u+l]=p+d,p=e[h+0]-e[h+l],b=e[h+0]+e[h+l],d=re.SQRT2*e[h+c],m=re.SQRT2*e[h+f],e[h+f]=b-m,e[h+0]=b+m,e[h+c]=p-d,e[h+l]=p+d,h+=i,u+=i}while(u<r);var v=n[s+0],g=n[s+1];for(o=1;o<_;o++){var S=1-2*g*g,R=2*g*v;u=t+o,h=t+l-o;do{var A=R*e[u+l]-S*e[h+l];m=S*e[u+l]+R*e[h+l],p=e[u+0]-m,b=e[u+0]+m;var B=e[h+0]-A,w=e[h+0]+A;A=R*e[u+c]-S*e[h+c],m=S*e[u+c]+R*e[h+c],d=e[u+f]-m,m=e[u+f]+m;var y=e[h+f]-A,k=e[h+f]+A;A=g*m-v*y,m=v*m+g*y,e[u+f]=b-m,e[u+0]=b+m,e[h+c]=B-A,e[h+l]=B+A,A=v*k-g*d,m=g*k+v*d,e[h+f]=w-m,e[h+0]=w+m,e[u+c]=p-A,e[u+l]=p+A,h+=i,u+=i}while(u<r);v=(S=v)*n[s+0]-g*n[s+1],g=S*n[s+1]+g*n[s+0]}s+=2}while(i<a)}var a=t(H.BLKSIZE),s=t(H.BLKSIZE_s/2),n=[.9238795325112867,.3826834323650898,.9951847266721969,.0980171403295606,.9996988186962042,.02454122852291229,.9999811752826011,.006135884649154475],r=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254];this.fft_short=function(t,a,n,i,o){for(t=0;3>t;t++){var _=H.BLKSIZE_s/2,l=65535&192*(t+1),f=H.BLKSIZE_s/8-1;do{var c=255&r[f<<2],u=s[c]*i[n][o+c+l],h=s[127-c]*i[n][o+c+l+128],p=u-h;u+=h;var b=s[c+64]*i[n][o+c+l+64],d=b-(h=s[63-c]*i[n][o+c+l+192]);b+=h,_-=4,a[t][_+0]=u+b,a[t][_+2]=u-b,a[t][_+1]=p+d,a[t][_+3]=p-d,p=(u=s[c+1]*i[n][o+c+l+1])-(h=s[126-c]*i[n][o+c+l+129]),u+=h,d=(b=s[c+65]*i[n][o+c+l+65])-(h=s[62-c]*i[n][o+c+l+193]),b+=h,a[t][_+H.BLKSIZE_s/2+0]=u+b,a[t][_+H.BLKSIZE_s/2+2]=u-b,a[t][_+H.BLKSIZE_s/2+1]=p+d,a[t][_+H.BLKSIZE_s/2+3]=p-d}while(0<=--f);e(a[t],_,H.BLKSIZE_s/2)}},this.fft_long=function(t,s,n,i,o){t=H.BLKSIZE/8-1;var _=H.BLKSIZE/2;do{var l=255&r[t],f=a[l]*i[n][o+l],c=a[l+512]*i[n][o+l+512],u=f-c;f+=c;var h=a[l+256]*i[n][o+l+256],p=h-(c=a[l+768]*i[n][o+l+768]);h+=c,s[(_-=4)+0]=f+h,s[_+2]=f-h,s[_+1]=u+p,s[_+3]=u-p,u=(f=a[l+1]*i[n][o+l+1])-(c=a[l+513]*i[n][o+l+513]),f+=c,p=(h=a[l+257]*i[n][o+l+257])-(c=a[l+769]*i[n][o+l+769]),h+=c,s[_+H.BLKSIZE/2+0]=f+h,s[_+H.BLKSIZE/2+2]=f-h,s[_+H.BLKSIZE/2+1]=u+p,s[_+H.BLKSIZE/2+3]=u-p}while(0<=--t);e(s,_,H.BLKSIZE/2)},this.init_fft=function(e){for(e=0;e<H.BLKSIZE;e++)a[e]=.42-.5*W(2*Q*(e+.5)/H.BLKSIZE)+.08*W(4*Q*(e+.5)/H.BLKSIZE);for(e=0;e<H.BLKSIZE_s/2;e++)s[e]=.5*(1-W(2*Q*(e+.5)/H.BLKSIZE_s))}}function Y(){function s(e,t){for(var a=0,s=0;s<H.BLKSIZE/2;++s)a+=e[s]*t.ATH.eql_w[s];return a*M}function o(e,t,a,s,n,r){if(t>e){if(!(t<e*T))return e+t;var i=t/e}else{if(e>=t*T)return e+t;i=e/t}return e+=t,6>=s+3?i>=k?e:(s=0|re.FAST_LOG10_X(i,16),e*L[s]):(s=0|re.FAST_LOG10_X(i,16),t=0==r?n.ATH.cb_l[a]*n.ATH.adjust:n.ATH.cb_s[a]*n.ATH.adjust,e<E*t?e>t?(a=1,13>=s&&(a=V[s]),t=re.FAST_LOG10_X(e/t,10/15),e*((P[s]-a)*t+a)):13<s?e:e*V[s]:e*P[s])}function _(e,t,a){if(0>e&&(e=0),0>t&&(t=0),0>=e)return t;if(0>=t)return e;var s=t>e?t/e:e/t;return-2<=a&&2>=a?s>=k?e+t:(a=0|re.FAST_LOG10_X(s,16),(e+t)*O[a]):s<T?e+t:(e<t&&(e=t),e)}function u(e,t,a,s,n){var r,i,o=0,_=0;for(r=i=0;r<H.SBMAX_s;++i,++r){var l=e.bo_s[r],f=e.npart_s;for(l=l<f?l:f;i<l;)o+=t[i],_+=a[i],i++;if(e.en[s].s[r][n]=o,e.thm[s].s[r][n]=_,i>=f){++r;break}f=1-(_=e.PSY.bo_s_weight[r]),o=_*t[i],_*=a[i],e.en[s].s[r][n]+=o,e.thm[s].s[r][n]+=_,o=f*t[i],_=f*a[i]}for(;r<H.SBMAX_s;++r)e.en[s].s[r][n]=0,e.thm[s].s[r][n]=0}function h(e,t,a,s){var n,r,i=0,o=0;for(n=r=0;n<H.SBMAX_l;++r,++n){var _=e.bo_l[n],l=e.npart_l;for(_=_<l?_:l;r<_;)i+=t[r],o+=a[r],r++;if(e.en[s].l[n]=i,e.thm[s].l[n]=o,r>=l){++n;break}l=1-(o=e.PSY.bo_l_weight[n]),i=o*t[r],o*=a[r],e.en[s].l[n]+=i,e.thm[s].l[n]+=o,i=l*t[r],o=l*a[r]}for(;n<H.SBMAX_l;++n)e.en[s].l[n]=0,e.thm[s].l[n]=0}function p(e,t,a){return 1<=a?e:0>=a?t:0<t?n(e/t,a)*t:0}function b(e,t){for(var a=309.07,s=0;s<H.SBMAX_s-1;s++)for(var n,r=0;3>r;r++)if(0<(n=e.thm.s[s][r])){n*=t;var i=e.en.s[s][r];i>n&&(a=i>1e10*n?a+23.02585092994046*N[s]:a+N[s]*re.FAST_LOG10(i/n))}return a}function d(e,t){for(var a,s=281.0575,n=0;n<H.SBMAX_l-1;n++)if(0<(a=e.thm.l[n])){a*=t;var r=e.en.l[n];r>a&&(s=r>1e10*a?s+23.02585092994046*D[n]:s+D[n]*re.FAST_LOG10(r/a))}return s}function m(e,t,a,s,n){var r,i;for(r=i=0;r<e.npart_l;++r){var o,_=0,l=0;for(o=0;o<e.numlines_l[r];++o,++i){var f=t[i];_+=f,l<f&&(l=f)}a[r]=_,s[r]=l,n[r]=_*e.rnumlines_l[r]}}function v(e,t,a,s){var n=I.length-1,r=0,i=a[r]+a[r+1];if(0<i){var o=t[r];o<t[r+1]&&(o=t[r+1]),i=20*(2*o-i)/(i*(e.numlines_l[r]+e.numlines_l[r+1]-1)),(i|=0)>n&&(i=n),s[r]=i}else s[r]=0;for(r=1;r<e.npart_l-1;r++)0<(i=a[r-1]+a[r]+a[r+1])?((o=t[r-1])<t[r]&&(o=t[r]),o<t[r+1]&&(o=t[r+1]),i=20*(3*o-i)/(i*(e.numlines_l[r-1]+e.numlines_l[r]+e.numlines_l[r+1]-1)),(i|=0)>n&&(i=n),s[r]=i):s[r]=0;0<(i=a[r-1]+a[r])?((o=t[r-1])<t[r]&&(o=t[r]),i=20*(2*o-i)/(i*(e.numlines_l[r-1]+e.numlines_l[r]-1)),(i|=0)>n&&(i=n),s[r]=i):s[r]=0}function g(e,t,a,s,o,_,l){var f=2*_;o=0<_?n(10,o):1;for(var c,u,h=0;h<l;++h){var p=e[2][h],b=e[3][h],d=t[0][h],m=t[1][h],v=t[2][h],g=t[3][h];d<=1.58*m&&m<=1.58*d?(c=a[h]*p,u=r(v,i(g,a[h]*b)),c=r(g,i(v,c))):(u=v,c=g),0<_&&(g=s[h]*o,d=i(r(d,g),r(m,g)),0<(m=(v=r(u,g))+(g=r(c,g)))&&d*f<m&&(v*=d=d*f/m,g*=d),u=i(v,u),c=i(g,c)),u>p&&(u=p),c>b&&(c=b),t[2][h]=u,t[3][h]=c}}function S(e,t){return-72>=(e=0<=e?27*-e:e*t)?0:J(.2302585093*e)}function R(e){var t=Math.atan;return 0>e&&(e=0),13*t(.76*(e*=.001))+3.5*t(e*e/56.25)}function A(a,s,r,o,_,l,f,c,u,h,p,b){var d,m=t(H.CBANDS+1),v=c/(15<b?1152:384),g=e(H.HBLKSIZE);c/=u;var S=0,A=0;for(d=0;d<H.CBANDS;d++){var B,w=R(c*S);for(m[d]=c*S,B=S;.34>R(c*B)-w&&B<=u/2;B++);for(a[d]=B-S,A=d+1;S<B;)g[S++]=d;if(S>u/2){S=u/2,++d;break}}for(m[d]=c*S,S=0;S<b;S++)d=h[S],w=h[S+1],0>(d=0|ee(.5+p*(d-.5)))&&(d=0),(B=0|ee(.5+p*(w-.5)))>u/2&&(B=u/2),r[S]=(g[d]+g[B])/2,s[S]=g[B],f[S]=(v*w-m[s[S]])/(m[s[S]+1]-m[s[S]]),0>f[S]?f[S]=0:1<f[S]&&(f[S]=1),w=R(c*h[S]*p),w=i(w,15.5)/15.5,l[S]=n(10,1.25*(1-W(Q*w))-2.5);for(s=S=0;s<A;s++)r=a[s],w=R(c*S),l=R(c*(S+r-1)),o[s]=.5*(w+l),w=R(c*(S-.5)),l=R(c*(S+r-.5)),_[s]=l-w,S+=r;return A}function B(e,s,n,r,o,_){var l=a([H.CBANDS,H.CBANDS]),f=0;if(_)for(var c=0;c<s;c++)for(_=0;_<s;_++){var u=n[c]-n[_];if(.5<=(u=0<=u?3*u:1.5*u)&&2.5>=u){var h=u-.5;h=8*(h*h-2*h)}else h=0;-60>=(u=15.811389+7.5*(u+=.474)-17.5*$(1+u*u))?h=0:h=(u=J(.2302585093*(h+u)))/.6609193,u=h*r[_],l[c][_]=u*o[c]}else for(_=0;_<s;_++){var p,b;for(c=h=15+i(21/n[_],12),p=0;1e-20<S(p,c);--p);var d=p;for(b=0;1e-12<te(b-d);)0<S(p=(b+d)/2,c)?b=p:d=p;for(u=d,p=0;1e-20<S(p,c);p+=1);for(d=0,b=p;1e-12<te(b-d);)0<S(p=(b+d)/2,c)?d=p:b=p;d=b;var m=0;for(b=0;1e3>=b;++b)m+=p=S(p=u+b*(d-u)/1e3,c);for(p=1001/(m*(d-u)),c=0;c<s;c++)u=p*S(n[c]-n[_],h)*r[_],l[c][_]=u*o[c]}for(c=0;c<s;c++){for(_=0;_<s&&!(0<l[c][_]);_++);for(e[c][0]=_,_=s-1;0<_&&!(0<l[c][_]);_--);e[c][1]=_,f+=e[c][1]-e[c][0]+1}for(n=t(f),c=r=0;c<s;c++)for(_=e[c][0];_<=e[c][1];_++)n[r++]=l[c][_];return n}function w(e){return e=R(e),e=i(e,15.5)/15.5,n(10,1.25*(1-W(Q*e))-2.5)}function y(e,t){return-.3>e&&(e=3410),e=r(.1,e/1e3),3.64*n(e,-.8)-6.8*J(-.6*n(e-3.4,2))+6*J(-.15*n(e-8.7,2))+.001*(.6+.04*t)*n(e,4)}var k,T,E,x=new F,M=1/217621504/(H.BLKSIZE/2),I=[1,.79433,.63096,.63096,.63096,.63096,.63096,.25119,.11749],P=[3.3246*3.3246,3.23837*3.23837,9.9500500969,9.0247369744,8.1854926609,7.0440875649,2.46209*2.46209,2.284*2.284,4.4892710641,1.96552*1.96552,1.82335*1.82335,1.69146*1.69146,2.4621061921,2.1508568964,1.37074*1.37074,1.31036*1.31036,1.5691069696,1.4555939904,1.16203*1.16203,1.2715945225,1.09428*1.09428,1.0659*1.0659,1.0779838276,1.0382591025,1],L=[1.7782755904,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.6999465924,1.22321*1.22321,1.3169398564,1],V=[5.5396212496,2.29259*2.29259,4.9868695969,2.12675*2.12675,2.02545*2.02545,1.87894*1.87894,1.74303*1.74303,1.61695*1.61695,2.2499700001,1.39148*1.39148,1.29083*1.29083,1.19746*1.19746,1.2339655056,1.0779838276],O=[1.7782755904,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.6999465924,1.22321*1.22321,1.3169398564,1],N=[11.8,13.6,17.2,32,46.5,51.3,57.5,67.1,71.5,84.6,97.6,130],D=[6.8,5.8,5.8,6.4,6.5,9.9,12.1,14.4,15,18.9,21.6,26.9,34.2,40.2,46.8,56.5,60.7,73.9,85.7,93.4,126.1],C=[-1730326e-23,-.01703172,-1349528e-23,.0418072,-673278e-22,-.0876324,-30835e-21,.1863476,-1104424e-22,-.627638];this.L3psycho_anal_ns=function(_,g,S,R,A,B,w,y,k,T){var E,M,P,L,V,O,N,D=_.internal_flags,X=a([2,H.BLKSIZE]),F=a([2,3,H.BLKSIZE_s]),Y=t(H.CBANDS+1),q=t(H.CBANDS+1),j=t(H.CBANDS+2),z=e(2),G=e(2),K=a([2,576]),U=e(H.CBANDS+2),Z=e(H.CBANDS+2);se.fill(Z,0);var W=D.channels_out;_.mode==c.JOINT_STEREO&&(W=4);var Q=_.VBR==f.vbr_off?0==D.ResvMax?0:D.ResvSize/D.ResvMax*.5:_.VBR==f.vbr_rh||_.VBR==f.vbr_mtrh||_.VBR==f.vbr_mt?.6:1;for(E=0;E<D.channels_out;E++){var J=g[E],$=S+576-350-21+192;for(P=0;576>P;P++){var ee,ae=J[$+P+10];for(L=ee=0;9>L;L+=2)ae+=C[L]*(J[$+P+L]+J[$+P+21-L]),ee+=C[L+1]*(J[$+P+L+1]+J[$+P+21-L-1]);K[E][P]=ae+ee}A[R][E].en.assign(D.en[E]),A[R][E].thm.assign(D.thm[E]),2<W&&(B[R][E].en.assign(D.en[E+2]),B[R][E].thm.assign(D.thm[E+2]))}for(E=0;E<W;E++){var ne=t(12),ie=[0,0,0,0],oe=t(12),_e=1,le=t(H.CBANDS),fe=t(H.CBANDS),ce=[0,0,0,0],ue=t(H.HBLKSIZE),he=a([3,H.HBLKSIZE_s]);for(P=0;3>P;P++)ne[P]=D.nsPsy.last_en_subshort[E][P+6],oe[P]=ne[P]/D.nsPsy.last_en_subshort[E][P+4],ie[0]+=ne[P];if(2==E)for(P=0;576>P;P++){var pe=K[0][P],be=K[1][P];K[0][P]=pe+be,K[1][P]=pe-be}var de=K[1&E],me=0;for(P=0;9>P;P++){for(var ve=me+64,ge=1;me<ve;me++)ge<te(de[me])&&(ge=te(de[me]));D.nsPsy.last_en_subshort[E][P]=ne[P+3]=ge,ie[1+P/3]+=ge,ge=ge>ne[P+3-2]?ge/ne[P+3-2]:ne[P+3-2]>10*ge?ne[P+3-2]/(10*ge):0,oe[P+3]=ge}if(_.analysis){var Se=oe[0];for(P=1;12>P;P++)Se<oe[P]&&(Se=oe[P]);D.pinfo.ers[R][E]=D.pinfo.ers_save[E],D.pinfo.ers_save[E]=Se}var Re=3==E?D.nsPsy.attackthre_s:D.nsPsy.attackthre;for(P=0;12>P;P++)0==ce[P/3]&&oe[P]>Re&&(ce[P/3]=P%3+1);for(P=1;4>P;P++)1.7>(ie[P-1]>ie[P]?ie[P-1]/ie[P]:ie[P]/ie[P-1])&&(ce[P]=0,1==P&&(ce[0]=0));0!=ce[0]&&0!=D.nsPsy.lastAttacks[E]&&(ce[0]=0),(3==D.nsPsy.lastAttacks[E]||0!=ce[0]+ce[1]+ce[2]+ce[3])&&(_e=0,0!=ce[1]&&0!=ce[0]&&(ce[1]=0),0!=ce[2]&&0!=ce[1]&&(ce[2]=0),0!=ce[3]&&0!=ce[2]&&(ce[3]=0)),2>E?G[E]=_e:0==_e&&(G[0]=G[1]=0),k[E]=D.tot_ener[E];var Ae=_,Be=ue,we=he,ye=X,ke=1&E,Te=F,Ee=1&E,xe=R,Me=E,Ie=g,Pe=S,Le=Ae.internal_flags;if(2>Me)x.fft_long(Le,ye[ke],Me,Ie,Pe),x.fft_short(Le,Te[Ee],Me,Ie,Pe);else if(2==Me){for(var Ve=H.BLKSIZE-1;0<=Ve;--Ve){var He=ye[ke+0][Ve],Oe=ye[ke+1][Ve];ye[ke+0][Ve]=(He+Oe)*re.SQRT2*.5,ye[ke+1][Ve]=(He-Oe)*re.SQRT2*.5}for(var Ne=2;0<=Ne;--Ne)for(Ve=H.BLKSIZE_s-1;0<=Ve;--Ve)He=Te[Ee+0][Ne][Ve],Oe=Te[Ee+1][Ne][Ve],Te[Ee+0][Ne][Ve]=(He+Oe)*re.SQRT2*.5,Te[Ee+1][Ne][Ve]=(He-Oe)*re.SQRT2*.5}for(Be[0]=ye[ke+0][0],Be[0]*=Be[0],Ve=H.BLKSIZE/2-1;0<=Ve;--Ve){var De=ye[ke+0][H.BLKSIZE/2-Ve],Ce=ye[ke+0][H.BLKSIZE/2+Ve];Be[H.BLKSIZE/2-Ve]=.5*(De*De+Ce*Ce)}for(Ne=2;0<=Ne;--Ne)for(we[Ne][0]=Te[Ee+0][Ne][0],we[Ne][0]*=we[Ne][0],Ve=H.BLKSIZE_s/2-1;0<=Ve;--Ve)De=Te[Ee+0][Ne][H.BLKSIZE_s/2-Ve],Ce=Te[Ee+0][Ne][H.BLKSIZE_s/2+Ve],we[Ne][H.BLKSIZE_s/2-Ve]=.5*(De*De+Ce*Ce);var Xe=0;for(Ve=11;Ve<H.HBLKSIZE;Ve++)Xe+=Be[Ve];if(Le.tot_ener[Me]=Xe,Ae.analysis){for(Ve=0;Ve<H.HBLKSIZE;Ve++)Le.pinfo.energy[xe][Me][Ve]=Le.pinfo.energy_save[Me][Ve],Le.pinfo.energy_save[Me][Ve]=Be[Ve];Le.pinfo.pe[xe][Me]=Le.pe[Me]}for(2==Ae.athaa_loudapprox&&2>Me&&(Le.loudness_sq[xe][Me]=Le.loudness_sq_save[Me],Le.loudness_sq_save[Me]=s(Be,Le)),m(D,ue,Y,le,fe),v(D,le,fe,U),N=0;3>N;N++){var Fe=void 0,Ye=void 0,qe=q,je=j,ze=E,Ge=N,Ke=_.internal_flags;for(Fe=Ye=0;Fe<Ke.npart_s;++Fe){for(var Ue,Ze=0,We=0,Qe=Ke.numlines_s[Fe],Je=0;Je<Qe;++Je,++Ye)Ze+=Ue=he[Ge][Ye],We<Ue&&(We=Ue);qe[Fe]=Ze}for(Ye=Fe=0;Fe<Ke.npart_s;Fe++){var $e=Ke.s3ind_s[Fe][0],et=Ke.s3_ss[Ye++]*qe[$e];for(++$e;$e<=Ke.s3ind_s[Fe][1];)et+=Ke.s3_ss[Ye]*qe[$e],++Ye,++$e;var tt=2*Ke.nb_s1[ze][Fe];je[Fe]=i(et,tt),Ke.blocktype_old[1&ze]==H.SHORT_TYPE&&(tt=16*Ke.nb_s2[ze][Fe],je[Fe]=i(tt,je[Fe])),Ke.nb_s2[ze][Fe]=Ke.nb_s1[ze][Fe],Ke.nb_s1[ze][Fe]=et}for(;Fe<=H.CBANDS;++Fe)qe[Fe]=0,je[Fe]=0;for(u(D,q,j,E,N),O=0;O<H.SBMAX_s;O++){var at=D.thm[E].s[O][N];if(at*=.8,2<=ce[N]||1==ce[N+1]){var st=0==N?2:N-1;ge=p(D.thm[E].s[O][st],at,.6*Q),at=i(at,ge)}1==ce[N]?(st=0==N?2:N-1,ge=p(D.thm[E].s[O][st],at,.3*Q),at=i(at,ge)):(0!=N&&3==ce[N-1]||0==N&&3==D.nsPsy.lastAttacks[E])&&(st=2==N?0:N+1,ge=p(D.thm[E].s[O][st],at,.3*Q),at=i(at,ge));var nt=ne[3*N+3]+ne[3*N+4]+ne[3*N+5];6*ne[3*N+5]<nt&&(at*=.5,6*ne[3*N+4]<nt&&(at*=.5)),D.thm[E].s[O][N]=at}}for(D.nsPsy.lastAttacks[E]=ce[2],M=V=0;M<D.npart_l;M++){for(var rt=D.s3ind[M][0],it=Y[rt]*I[U[rt]],ot=D.s3_ll[V++]*it;++rt<=D.s3ind[M][1];)it=Y[rt]*I[U[rt]],ot=o(ot,D.s3_ll[V++]*it,rt,rt-M,D,0);ot*=.158489319246111,j[M]=D.blocktype_old[1&E]==H.SHORT_TYPE?ot:p(i(ot,i(2*D.nb_1[E][M],16*D.nb_2[E][M])),ot,Q),D.nb_2[E][M]=D.nb_1[E][M],D.nb_1[E][M]=ot}for(;M<=H.CBANDS;++M)Y[M]=0,j[M]=0;h(D,Y,j,E)}if((_.mode==c.STEREO||_.mode==c.JOINT_STEREO)&&0<_.interChRatio){var _t=_.interChRatio,lt=_.internal_flags;if(1<lt.channels_out){for(var ft=0;ft<H.SBMAX_l;ft++){var ct=lt.thm[0].l[ft],ut=lt.thm[1].l[ft];lt.thm[0].l[ft]+=ut*_t,lt.thm[1].l[ft]+=ct*_t}for(ft=0;ft<H.SBMAX_s;ft++)for(var ht=0;3>ht;ht++)ct=lt.thm[0].s[ft][ht],ut=lt.thm[1].s[ft][ht],lt.thm[0].s[ft][ht]+=ut*_t,lt.thm[1].s[ft][ht]+=ct*_t}}if(_.mode==c.JOINT_STEREO){for(var pt,bt=0;bt<H.SBMAX_l;bt++)if(!(D.thm[0].l[bt]>1.58*D.thm[1].l[bt]||D.thm[1].l[bt]>1.58*D.thm[0].l[bt])){var dt=D.mld_l[bt]*D.en[3].l[bt],mt=r(D.thm[2].l[bt],i(D.thm[3].l[bt],dt));dt=D.mld_l[bt]*D.en[2].l[bt];var vt=r(D.thm[3].l[bt],i(D.thm[2].l[bt],dt));D.thm[2].l[bt]=mt,D.thm[3].l[bt]=vt}for(bt=0;bt<H.SBMAX_s;bt++)for(var gt=0;3>gt;gt++)D.thm[0].s[bt][gt]>1.58*D.thm[1].s[bt][gt]||D.thm[1].s[bt][gt]>1.58*D.thm[0].s[bt][gt]||(dt=D.mld_s[bt]*D.en[3].s[bt][gt],mt=r(D.thm[2].s[bt][gt],i(D.thm[3].s[bt][gt],dt)),dt=D.mld_s[bt]*D.en[2].s[bt][gt],vt=r(D.thm[3].s[bt][gt],i(D.thm[2].s[bt][gt],dt)),D.thm[2].s[bt][gt]=mt,D.thm[3].s[bt][gt]=vt);if(pt=_.msfix,0<te(pt)){var St=pt,Rt=St,At=n(10,_.ATHlower*D.ATH.adjust);St*=2,Rt*=2;for(var Bt=0;Bt<H.SBMAX_l;Bt++){var wt=D.ATH.cb_l[D.bm_l[Bt]]*At,yt=i(r(D.thm[0].l[Bt],wt),r(D.thm[1].l[Bt],wt)),kt=r(D.thm[2].l[Bt],wt),Tt=r(D.thm[3].l[Bt],wt);if(yt*St<kt+Tt){var Et=yt*Rt/(kt+Tt);kt*=Et,Tt*=Et}D.thm[2].l[Bt]=i(kt,D.thm[2].l[Bt]),D.thm[3].l[Bt]=i(Tt,D.thm[3].l[Bt])}for(At*=H.BLKSIZE_s/H.BLKSIZE,Bt=0;Bt<H.SBMAX_s;Bt++)for(var xt=0;3>xt;xt++)wt=D.ATH.cb_s[D.bm_s[Bt]]*At,(yt=i(r(D.thm[0].s[Bt][xt],wt),r(D.thm[1].s[Bt][xt],wt)))*St<(kt=r(D.thm[2].s[Bt][xt],wt))+(Tt=r(D.thm[3].s[Bt][xt],wt))&&(kt*=Et=yt*St/(kt+Tt),Tt*=Et),D.thm[2].s[Bt][xt]=i(D.thm[2].s[Bt][xt],kt),D.thm[3].s[Bt][xt]=i(D.thm[3].s[Bt][xt],Tt)}}var Mt=_.internal_flags;_.short_blocks!=l.short_block_coupled||0!=G[0]&&0!=G[1]||(G[0]=G[1]=0);for(var It=0;It<Mt.channels_out;It++)z[It]=H.NORM_TYPE,_.short_blocks==l.short_block_dispensed&&(G[It]=1),_.short_blocks==l.short_block_forced&&(G[It]=0),0==G[It]?(z[It]=H.SHORT_TYPE,Mt.blocktype_old[It]==H.NORM_TYPE&&(Mt.blocktype_old[It]=H.START_TYPE),Mt.blocktype_old[It]==H.STOP_TYPE&&(Mt.blocktype_old[It]=H.SHORT_TYPE)):Mt.blocktype_old[It]==H.SHORT_TYPE&&(z[It]=H.STOP_TYPE),T[It]=Mt.blocktype_old[It],Mt.blocktype_old[It]=z[It];for(E=0;E<W;E++){var Pt=0;if(1<E){var Lt=y;Pt=-2;var Vt=H.NORM_TYPE;(T[0]==H.SHORT_TYPE||T[1]==H.SHORT_TYPE)&&(Vt=H.SHORT_TYPE);var Ht=B[R][E-2]}else Lt=w,Pt=0,Vt=T[E],Ht=A[R][E];Lt[Pt+E]=Vt==H.SHORT_TYPE?b(Ht,D.masking_lower):d(Ht,D.masking_lower),_.analysis&&(D.pinfo.pe[R][E]=Lt[Pt+E])}return 0};var X=[-1730326e-23,-.01703172,-1349528e-23,.0418072,-673278e-22,-.0876324,-30835e-21,.1863476,-1104424e-22,-.627638];this.L3psycho_anal_vbr=function(n,o,f,S,R,A,B,w,y,k){for(var T=n.internal_flags,E=t(H.HBLKSIZE),M=a([3,H.HBLKSIZE_s]),P=a([2,H.BLKSIZE]),L=a([2,3,H.BLKSIZE_s]),V=a([4,H.CBANDS]),O=a([4,H.CBANDS]),N=a([4,3]),D=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],C=e(2),F=n.mode==c.JOINT_STEREO?4:T.channels_out,Y=a([2,576]),q=n.internal_flags,j=q.channels_out,z=n.mode==c.JOINT_STEREO?4:j,G=0;G<j;G++){firbuf=o[G];for(var K=f+576-350-21+192,U=0;576>U;U++){for(var Z,W=firbuf[K+U+10],Q=Z=0;9>Q;Q+=2)W+=X[Q]*(firbuf[K+U+Q]+firbuf[K+U+21-Q]),Z+=X[Q+1]*(firbuf[K+U+Q+1]+firbuf[K+U+21-Q-1]);Y[G][U]=W+Z}R[S][G].en.assign(q.en[G]),R[S][G].thm.assign(q.thm[G]),2<z&&(A[S][G].en.assign(q.en[G+2]),A[S][G].thm.assign(q.thm[G+2]))}for(G=0;G<z;G++){var J=t(12),$=t(12),ee=[0,0,0,0],ae=Y[1&G],se=0,ne=3==G?q.nsPsy.attackthre_s:q.nsPsy.attackthre,ie=1;if(2==G)for(U=0,Q=576;0<Q;++U,--Q){var oe=Y[0][U],_e=Y[1][U];Y[0][U]=oe+_e,Y[1][U]=oe-_e}for(U=0;3>U;U++)$[U]=q.nsPsy.last_en_subshort[G][U+6],J[U]=$[U]/q.nsPsy.last_en_subshort[G][U+4],ee[0]+=$[U];for(U=0;9>U;U++){for(var le=se+64,fe=1;se<le;se++)fe<te(ae[se])&&(fe=te(ae[se]));q.nsPsy.last_en_subshort[G][U]=$[U+3]=fe,ee[1+U/3]+=fe,fe=fe>$[U+3-2]?fe/$[U+3-2]:$[U+3-2]>10*fe?$[U+3-2]/(10*fe):0,J[U+3]=fe}for(U=0;3>U;++U){var ce=$[3*U+3]+$[3*U+4]+$[3*U+5],ue=1;6*$[3*U+5]<ce&&(ue*=.5,6*$[3*U+4]<ce&&(ue*=.5)),N[G][U]=ue}if(n.analysis){var he=J[0];for(U=1;12>U;U++)he<J[U]&&(he=J[U]);q.pinfo.ers[S][G]=q.pinfo.ers_save[G],q.pinfo.ers_save[G]=he}for(U=0;12>U;U++)0==D[G][U/3]&&J[U]>ne&&(D[G][U/3]=U%3+1);for(U=1;4>U;U++){var pe=ee[U-1],be=ee[U];4e4>r(pe,be)&&pe<1.7*be&&be<1.7*pe&&(1==U&&D[G][0]<=D[G][U]&&(D[G][0]=0),D[G][U]=0)}D[G][0]<=q.nsPsy.lastAttacks[G]&&(D[G][0]=0),(3==q.nsPsy.lastAttacks[G]||0!=D[G][0]+D[G][1]+D[G][2]+D[G][3])&&(ie=0,0!=D[G][1]&&0!=D[G][0]&&(D[G][1]=0),0!=D[G][2]&&0!=D[G][1]&&(D[G][2]=0),0!=D[G][3]&&0!=D[G][2]&&(D[G][3]=0)),2>G?C[G]=ie:0==ie&&(C[0]=C[1]=0),y[G]=q.tot_ener[G]}var de=n.internal_flags;n.short_blocks!=l.short_block_coupled||0!=C[0]&&0!=C[1]||(C[0]=C[1]=0);for(var me=0;me<de.channels_out;me++)n.short_blocks==l.short_block_dispensed&&(C[me]=1),n.short_blocks==l.short_block_forced&&(C[me]=0);for(var ve,ge=0;ge<F;ge++){var Se=n,Re=ge,Ae=S,Be=E,we=P,ye=ve=1&ge,ke=Se.internal_flags;if(2>Re)x.fft_long(ke,we[ye],Re,o,f);else if(2==Re)for(var Te=H.BLKSIZE-1;0<=Te;--Te){var Ee=we[ye+0][Te],xe=we[ye+1][Te];we[ye+0][Te]=(Ee+xe)*re.SQRT2*.5,we[ye+1][Te]=(Ee-xe)*re.SQRT2*.5}for(Be[0]=we[ye+0][0],Be[0]*=Be[0],Te=H.BLKSIZE/2-1;0<=Te;--Te){var Me=we[ye+0][H.BLKSIZE/2-Te],Ie=we[ye+0][H.BLKSIZE/2+Te];Be[H.BLKSIZE/2-Te]=.5*(Me*Me+Ie*Ie)}var Pe=0;for(Te=11;Te<H.HBLKSIZE;Te++)Pe+=Be[Te];if(ke.tot_ener[Re]=Pe,Se.analysis){for(Te=0;Te<H.HBLKSIZE;Te++)ke.pinfo.energy[Ae][Re][Te]=ke.pinfo.energy_save[Re][Te],ke.pinfo.energy_save[Re][Te]=Be[Te];ke.pinfo.pe[Ae][Re]=ke.pe[Re]}var Le=ge,Ve=n.internal_flags;if(2==n.athaa_loudapprox&&2>Le&&(Ve.loudness_sq[S][Le]=Ve.loudness_sq_save[Le],Ve.loudness_sq_save[Le]=s(E,Ve)),0!=C[ve]){var He=void 0,Oe=T,Ne=V[ge],De=O[ge],Ce=ge,Xe=t(H.CBANDS),Fe=t(H.CBANDS),Ye=e(H.CBANDS+2);m(Oe,E,Ne,Xe,Fe),v(Oe,Xe,Fe,Ye);var qe=0;for(He=0;He<Oe.npart_l;He++){var je=Oe.s3ind[He][0],ze=Oe.s3ind[He][1],Ge=0,Ke=0;Ge=Ye[je],Ke+=1;var Ue=Oe.s3_ll[qe]*Ne[je]*I[Ye[je]];for(++qe,++je;je<=ze;){Ge+=Ye[je],Ke+=1;var Ze=Oe.s3_ll[qe]*Ne[je]*I[Ye[je]];Ue=_(Ue,Ze,je-He),++qe,++je}var We=.5*I[Ge=(1+2*Ge)/(2*Ke)];if(Ue*=We,Oe.blocktype_old[1&Ce]==H.SHORT_TYPE){var Qe=2*Oe.nb_1[Ce][He];De[He]=i(Ue,0<Qe?Qe:.3*Ne[He])}else{var Je=16*Oe.nb_2[Ce][He],$e=2*Oe.nb_1[Ce][He];0>=Je&&(Je=Ue),0>=$e&&($e=Ue),Qe=Oe.blocktype_old[1&Ce]==H.NORM_TYPE?i($e,Je):$e,De[He]=i(Ue,Qe)}Oe.nb_2[Ce][He]=Oe.nb_1[Ce][He],Oe.nb_1[Ce][He]=Ue,Ze=Xe[He],Ze*=Oe.minval_l[He],Ze*=We,De[He]>Ze&&(De[He]=Ze),1<Oe.masking_lower&&(De[He]*=Oe.masking_lower),De[He]>Ne[He]&&(De[He]=Ne[He]),1>Oe.masking_lower&&(De[He]*=Oe.masking_lower)}for(;He<H.CBANDS;++He)Ne[He]=0,De[He]=0}else for(var et=T,tt=ge,at=0;at<et.npart_l;at++)et.nb_2[tt][at]=et.nb_1[tt][at],et.nb_1[tt][at]=0}for(2==C[0]+C[1]&&n.mode==c.JOINT_STEREO&&g(V,O,T.mld_cb_l,T.ATH.cb_l,n.ATHlower*T.ATH.adjust,n.msfix,T.npart_l),ge=0;ge<F;ge++)0!=C[ve=1&ge]&&h(T,V[ge],O[ge],ge);for(var st=0;3>st;st++){for(ge=0;ge<F;++ge)if(0!=C[ve=1&ge]){var nt=T,rt=ge;if(0==st)for(var it=0;it<nt.npart_s;it++)nt.nb_s2[rt][it]=nt.nb_s1[rt][it],nt.nb_s1[rt][it]=0}else{var ot=ge,_t=st,lt=M,ft=L,ct=ve,ut=n.internal_flags;if(0==_t&&2>ot&&x.fft_short(ut,ft[ct],ot,o,f),2==ot)for(var ht=H.BLKSIZE_s-1;0<=ht;--ht){var pt=ft[ct+0][_t][ht],bt=ft[ct+1][_t][ht];ft[ct+0][_t][ht]=(pt+bt)*re.SQRT2*.5,ft[ct+1][_t][ht]=(pt-bt)*re.SQRT2*.5}for(lt[_t][0]=ft[ct+0][_t][0],lt[_t][0]*=lt[_t][0],ht=H.BLKSIZE_s/2-1;0<=ht;--ht){var dt=ft[ct+0][_t][H.BLKSIZE_s/2-ht],mt=ft[ct+0][_t][H.BLKSIZE_s/2+ht];lt[_t][H.BLKSIZE_s/2-ht]=.5*(dt*dt+mt*mt)}var vt=void 0,gt=void 0,St=void 0,Rt=V[ge],At=O[ge],Bt=ge,wt=st,yt=n.internal_flags,kt=new float[H.CBANDS],Tt=t(H.CBANDS),Et=new int[H.CBANDS];for(vt=gt=0;vt<yt.npart_s;++vt){var xt=0,Mt=0,It=yt.numlines_s[vt];for(St=0;St<It;++St,++gt){var Pt=M[wt][gt];xt+=Pt,Mt<Pt&&(Mt=Pt)}Rt[vt]=xt,kt[vt]=Mt,Tt[vt]=xt/It}for(;vt<H.CBANDS;++vt)kt[vt]=0,Tt[vt]=0;var Lt=yt,Vt=kt,Ht=Tt,Ot=Et,Nt=I.length-1,Dt=0,Ct=Ht[Dt]+Ht[Dt+1];if(0<Ct){var Xt=Vt[Dt];Xt<Vt[Dt+1]&&(Xt=Vt[Dt+1]);var Ft=0|(Ct=20*(2*Xt-Ct)/(Ct*(Lt.numlines_s[Dt]+Lt.numlines_s[Dt+1]-1)));Ft>Nt&&(Ft=Nt),Ot[Dt]=Ft}else Ot[Dt]=0;for(Dt=1;Dt<Lt.npart_s-1;Dt++)0<(Ct=Ht[Dt-1]+Ht[Dt]+Ht[Dt+1])?((Xt=Vt[Dt-1])<Vt[Dt]&&(Xt=Vt[Dt]),Xt<Vt[Dt+1]&&(Xt=Vt[Dt+1]),(Ft=0|(Ct=20*(3*Xt-Ct)/(Ct*(Lt.numlines_s[Dt-1]+Lt.numlines_s[Dt]+Lt.numlines_s[Dt+1]-1))))>Nt&&(Ft=Nt),Ot[Dt]=Ft):Ot[Dt]=0;for(0<(Ct=Ht[Dt-1]+Ht[Dt])?((Xt=Vt[Dt-1])<Vt[Dt]&&(Xt=Vt[Dt]),(Ft=0|(Ct=20*(2*Xt-Ct)/(Ct*(Lt.numlines_s[Dt-1]+Lt.numlines_s[Dt]-1))))>Nt&&(Ft=Nt),Ot[Dt]=Ft):Ot[Dt]=0,gt=vt=0;vt<yt.npart_s;vt++){var Yt=yt.s3ind_s[vt][0],qt=yt.s3ind_s[vt][1],jt=Et[Yt],zt=1,Gt=yt.s3_ss[gt]*Rt[Yt]*I[Et[Yt]];for(++gt,++Yt;Yt<=qt;){jt+=Et[Yt],zt+=1;var Kt=yt.s3_ss[gt]*Rt[Yt]*I[Et[Yt]];Gt=_(Gt,Kt,Yt-vt),++gt,++Yt}var Ut=.5*I[jt=(1+2*jt)/(2*zt)];Gt*=Ut,At[vt]=Gt,yt.nb_s2[Bt][vt]=yt.nb_s1[Bt][vt],yt.nb_s1[Bt][vt]=Gt,Kt=kt[vt],Kt*=yt.minval_s[vt],Kt*=Ut,At[vt]>Kt&&(At[vt]=Kt),1<yt.masking_lower&&(At[vt]*=yt.masking_lower),At[vt]>Rt[vt]&&(At[vt]=Rt[vt]),1>yt.masking_lower&&(At[vt]*=yt.masking_lower)}for(;vt<H.CBANDS;++vt)Rt[vt]=0,At[vt]=0}for(0==C[0]+C[1]&&n.mode==c.JOINT_STEREO&&g(V,O,T.mld_cb_s,T.ATH.cb_s,n.ATHlower*T.ATH.adjust,n.msfix,T.npart_s),ge=0;ge<F;++ge)0==C[ve=1&ge]&&u(T,V[ge],O[ge],ge,st)}for(ge=0;ge<F;ge++)if(0==C[ve=1&ge])for(var Zt,Wt=0;Wt<H.SBMAX_s;Wt++){for(Zt=t(3),st=0;3>st;st++){var Qt=T.thm[ge].s[Wt][st];if(Qt*=.8,2<=D[ge][st]||1==D[ge][st+1]){var Jt=0==st?2:st-1,$t=p(T.thm[ge].s[Wt][Jt],Qt,.36);Qt=i(Qt,$t)}else 1==D[ge][st]?(Jt=0==st?2:st-1,$t=p(T.thm[ge].s[Wt][Jt],Qt,.18),Qt=i(Qt,$t)):(0!=st&&3==D[ge][st-1]||0==st&&3==T.nsPsy.lastAttacks[ge])&&(Jt=2==st?0:st+1,$t=p(T.thm[ge].s[Wt][Jt],Qt,.18),Qt=i(Qt,$t));Qt*=N[ge][st],Zt[st]=Qt}for(st=0;3>st;st++)T.thm[ge].s[Wt][st]=Zt[st]}for(ge=0;ge<F;ge++)T.nsPsy.lastAttacks[ge]=D[ge][2];for(var ea,ta=n.internal_flags,aa=0;aa<ta.channels_out;aa++)ea=H.NORM_TYPE,0==C[aa]?(ea=H.SHORT_TYPE,ta.blocktype_old[aa]==H.NORM_TYPE&&(ta.blocktype_old[aa]=H.START_TYPE),ta.blocktype_old[aa]==H.STOP_TYPE&&(ta.blocktype_old[aa]=H.SHORT_TYPE)):ta.blocktype_old[aa]==H.SHORT_TYPE&&(ea=H.STOP_TYPE),k[aa]=ta.blocktype_old[aa],ta.blocktype_old[aa]=ea;for(ge=0;ge<F;ge++){if(1<ge){var sa=w,na=-2,ra=H.NORM_TYPE;(k[0]==H.SHORT_TYPE||k[1]==H.SHORT_TYPE)&&(ra=H.SHORT_TYPE);var ia=A[S][ge-2]}else sa=B,na=0,ra=k[ge],ia=R[S][ge];sa[na+ge]=ra==H.SHORT_TYPE?b(ia,T.masking_lower):d(ia,T.masking_lower),n.analysis&&(T.pinfo.pe[S][ge]=sa[na+ge])}return 0},this.psymodel_init=function(e){var a,s=Math.log,r=e.internal_flags,i=!0,o=13,_=0,l=0,c=-8.25,u=-4.5,h=t(H.CBANDS),p=t(H.CBANDS),b=t(H.CBANDS),d=e.out_samplerate;switch(e.experimentalZ){default:case 0:i=!0;break;case 1:i=e.VBR!=f.vbr_mtrh&&e.VBR!=f.vbr_mt;break;case 2:i=!1;break;case 3:o=8,_=-1.75,l=-.0125,c=-8.25,u=-2.25}for(r.ms_ener_ratio_old=.25,r.blocktype_old[0]=r.blocktype_old[1]=H.NORM_TYPE,a=0;4>a;++a){for(var m=0;m<H.CBANDS;++m)r.nb_1[a][m]=1e20,r.nb_2[a][m]=1e20,r.nb_s1[a][m]=r.nb_s2[a][m]=1;for(var v=0;v<H.SBMAX_l;v++)r.en[a].l[v]=1e20,r.thm[a].l[v]=1e20;for(m=0;3>m;++m){for(v=0;v<H.SBMAX_s;v++)r.en[a].s[v][m]=1e20,r.thm[a].s[v][m]=1e20;r.nsPsy.lastAttacks[a]=0}for(m=0;9>m;m++)r.nsPsy.last_en_subshort[a][m]=10}for(r.loudness_sq_save[0]=r.loudness_sq_save[1]=0,r.npart_l=A(r.numlines_l,r.bo_l,r.bm_l,h,p,r.mld_l,r.PSY.bo_l_weight,d,H.BLKSIZE,r.scalefac_band.l,H.BLKSIZE/1152,H.SBMAX_l),a=0;a<r.npart_l;a++)v=_,h[a]>=o&&(v=l*(h[a]-o)/(24-o)+_*(24-h[a])/(24-o)),b[a]=n(10,v/10),r.rnumlines_l[a]=0<r.numlines_l[a]?1/r.numlines_l[a]:0;for(r.s3_ll=B(r.s3ind,r.npart_l,h,p,b,i),a=m=0;a<r.npart_l;a++){for(l=ie.MAX_VALUE,v=0;v<r.numlines_l[a];v++,m++)_=d*m/(1e3*H.BLKSIZE),_=this.ATHformula(1e3*_,e)-20,_=n(10,.1*_),l>(_*=r.numlines_l[a])&&(l=_);r.ATH.cb_l[a]=l,6<(l=20*h[a]/10-20)&&(l=100),-15>l&&(l=-15),l-=8,r.minval_l[a]=n(10,l/10)*r.numlines_l[a]}for(r.npart_s=A(r.numlines_s,r.bo_s,r.bm_s,h,p,r.mld_s,r.PSY.bo_s_weight,d,H.BLKSIZE_s,r.scalefac_band.s,H.BLKSIZE_s/384,H.SBMAX_s),a=m=0;a<r.npart_s;a++){for(v=c,h[a]>=o&&(v=u*(h[a]-o)/(24-o)+c*(24-h[a])/(24-o)),b[a]=n(10,v/10),l=ie.MAX_VALUE,v=0;v<r.numlines_s[a];v++,m++)_=d*m/(1e3*H.BLKSIZE_s),_=this.ATHformula(1e3*_,e)-20,_=n(10,.1*_),l>(_*=r.numlines_s[a])&&(l=_);r.ATH.cb_s[a]=l,l=7*h[a]/12-7,12<h[a]&&(l*=1+3.1*s(1+l)),12>h[a]&&(l*=1+2.3*s(1-l)),-15>l&&(l=-15),l-=8,r.minval_s[a]=n(10,l/10)*r.numlines_s[a]}for(r.s3_ss=B(r.s3ind_s,r.npart_s,h,p,b,i),k=3.651741272548377,T=31.622776601683793,E=31.622776601683793,x.init_fft(r),r.decay=J(-2.302585092994046/(.01*d/192)),a=3.5,0!=(2&e.exp_nspsytune)&&(a=1),0<te(e.msfix)&&(a=e.msfix),e.msfix=a,i=0;i<r.npart_l;i++)r.s3ind[i][1]>r.npart_l-1&&(r.s3ind[i][1]=r.npart_l-1);if(r.ATH.decay=n(10,576*r.mode_gr/d*-1.2),r.ATH.adjust=.01,r.ATH.adjustLimit=1,-1!=e.ATHtype){for(m=e.out_samplerate/H.BLKSIZE,a=_=i=0;a<H.BLKSIZE/2;++a)_+=m,r.ATH.eql_w[a]=1/n(10,this.ATHformula(_,e)/10),i+=r.ATH.eql_w[a];for(i=1/i,a=H.BLKSIZE/2;0<=--a;)r.ATH.eql_w[a]*=i}for(i=m=0;i<r.npart_s;++i)for(a=0;a<r.numlines_s[i];++a)++m;for(i=m=0;i<r.npart_l;++i)for(a=0;a<r.numlines_l[i];++a)++m;for(a=m=0;a<r.npart_l;a++)_=d*(m+r.numlines_l[a]/2)/(1*H.BLKSIZE),r.mld_cb_l[a]=w(_),m+=r.numlines_l[a];for(;a<H.CBANDS;++a)r.mld_cb_l[a]=1;for(a=m=0;a<r.npart_s;a++)_=d*(m+r.numlines_s[a]/2)/(1*H.BLKSIZE_s),r.mld_cb_s[a]=w(_),m+=r.numlines_s[a];for(;a<H.CBANDS;++a)r.mld_cb_s[a]=1;return 0},this.ATHformula=function(e,t){switch(t.ATHtype){case 0:e=y(e,9);break;case 1:e=y(e,-1);break;case 2:e=y(e,0);break;case 3:e=y(e,1)+6;break;case 4:e=y(e,t.ATHcurve);break;default:e=y(e,0)}return e}}function q(){function e(){this.mask_adjust_short=this.mask_adjust=0,this.bo_l_weight=t(H.SBMAX_l),this.bo_s_weight=t(H.SBMAX_s)}function a(){this.lowerlimit=0}function s(e,t){this.lowpass=t}function _(e){return 1<e?0:0>=e?1:W(Q/2*e)}function u(e,t){return 44100===e?(t.version=1,0):48e3===e?t.version=1:32e3===e?(t.version=1,2):22050===e?t.version=0:24e3===e?(t.version=0,1):16e3===e?(t.version=0,2):11025===e?t.version=0:12e3===e?(t.version=0,1):8e3===e?(t.version=0,2):(t.version=0,-1)}function p(e,t,a){16e3>a&&(t=2),a=oe.bitrate_table[t][1];for(var s=2;14>=s;s++)0<oe.bitrate_table[t][s]&&te(oe.bitrate_table[t][s]-e)<te(a-e)&&(a=oe.bitrate_table[t][s]);return a}function b(e,t,a){for(16e3>a&&(t=2),a=0;14>=a;a++)if(0<oe.bitrate_table[t][a]&&oe.bitrate_table[t][a]==e)return a;return-1}function d(e,t){var a=[new s(8,2e3),new s(16,3700),new s(24,3900),new s(32,5500),new s(40,7e3),new s(48,7500),new s(56,1e4),new s(64,11e3),new s(80,13500),new s(96,15100),new s(112,15600),new s(128,17e3),new s(160,17500),new s(192,18600),new s(224,19400),new s(256,19700),new s(320,20500)];t=A.nearestBitrateFullIndex(t),e.lowerlimit=a[t].lowpass}function v(e){var t=H.BLKSIZE+e.framesize-H.FFTOFFSET;return r(t,512+e.framesize-32)}function g(){this.n_out=this.n_in=0}function S(){this.num_used=0}function R(e,t){return 0==t?e:R(t,e%t)}var A=this;q.V9=410,q.V8=420,q.V7=430,q.V6=440,q.V5=450,q.V4=460,q.V3=470,q.V2=480,q.V1=490,q.V0=500,q.R3MIX=1e3,q.STANDARD=1001,q.EXTREME=1002,q.INSANE=1003,q.STANDARD_FAST=1004,q.EXTREME_FAST=1005,q.MEDIUM=1006,q.MEDIUM_FAST=1007,q.LAME_MAXMP3BUFFER=147456;var T,E,x,M,I,P,L,V,O=new Y;this.enc=new H,this.setModules=function(e,t,a,s,n,r,i,o,_){T=e,E=t,x=a,M=s,I=n,P=r,L=o,V=_,this.enc.setModules(E,O,M,P)},this.lame_init=function(){var e=new B;e.class_id=4294479419;var t=e.internal_flags=new X;return e.mode=c.NOT_SET,e.original=1,e.in_samplerate=44100,e.num_channels=2,e.num_samples=-1,e.bWriteVbrTag=!0,e.quality=-1,e.short_blocks=null,t.subblock_gain=-1,e.lowpassfreq=0,e.highpassfreq=0,e.lowpasswidth=-1,e.highpasswidth=-1,e.VBR=f.vbr_off,e.VBR_q=4,e.ATHcurve=-1,e.VBR_mean_bitrate_kbps=128,e.VBR_min_bitrate_kbps=0,e.VBR_max_bitrate_kbps=0,e.VBR_hard_min=0,t.VBR_min_bitrate=1,t.VBR_max_bitrate=13,e.quant_comp=-1,e.quant_comp_short=-1,e.msfix=-1,t.resample_ratio=1,t.OldValue[0]=180,t.OldValue[1]=180,t.CurrentStep[0]=4,t.CurrentStep[1]=4,t.masking_lower=1,t.nsPsy.attackthre=-1,t.nsPsy.attackthre_s=-1,e.scale=-1,e.athaa_type=-1,e.ATHtype=-1,e.athaa_loudapprox=-1,e.athaa_sensitivity=0,e.useTemporal=null,e.interChRatio=-1,t.mf_samples_to_encode=H.ENCDELAY+H.POSTDELAY,e.encoder_padding=0,t.mf_size=H.ENCDELAY-H.MDCTDELAY,e.findReplayGain=!1,e.decode_on_the_fly=!1,t.decode_on_the_fly=!1,t.findReplayGain=!1,t.findPeakSample=!1,t.RadioGain=0,t.AudiophileGain=0,t.noclipGainChange=0,t.noclipScale=-1,e.preset=0,e.write_id3tag_automatic=!0,e.lame_allocated_gfp=1,e},this.nearestBitrateFullIndex=function(e){for(var t=[8,16,24,32,40,48,56,64,80,96,112,128,160,192,224,256,320],a=t[16],s=16,n=t[16],i=16,o=0;16>o;o++)if(r(e,t[o+1])!=e){a=t[o+1],s=o+1,n=t[o],i=o;break}return a-e>e-n?i:s},this.lame_init_params=function(t){var s=t.internal_flags;if(s.Class_ID=0,null==s.ATH&&(s.ATH=new k),null==s.PSY&&(s.PSY=new e),null==s.rgdata&&(s.rgdata=new w),s.channels_in=t.num_channels,1==s.channels_in&&(t.mode=c.MONO),s.channels_out=t.mode==c.MONO?1:2,s.mode_ext=H.MPG_MD_MS_LR,t.mode==c.MONO&&(t.force_ms=!1),t.VBR==f.vbr_off&&128!=t.VBR_mean_bitrate_kbps&&0==t.brate&&(t.brate=t.VBR_mean_bitrate_kbps),t.VBR!=f.vbr_off&&t.VBR!=f.vbr_mtrh&&t.VBR!=f.vbr_mt&&(t.free_format=!1),t.VBR==f.vbr_off&&0==t.brate&&m.EQ(t.compression_ratio,0)&&(t.compression_ratio=11.025),t.VBR==f.vbr_off&&0<t.compression_ratio&&(0==t.out_samplerate&&(t.out_samplerate=map2MP3Frequency(int(.97*t.in_samplerate))),t.brate=0|16*t.out_samplerate*s.channels_out/(1e3*t.compression_ratio),s.samplerate_index=u(t.out_samplerate,t),t.free_format||(t.brate=p(t.brate,t.version,t.out_samplerate))),0!=t.out_samplerate&&(16e3>t.out_samplerate?(t.VBR_mean_bitrate_kbps=r(t.VBR_mean_bitrate_kbps,8),t.VBR_mean_bitrate_kbps=i(t.VBR_mean_bitrate_kbps,64)):32e3>t.out_samplerate?(t.VBR_mean_bitrate_kbps=r(t.VBR_mean_bitrate_kbps,8),t.VBR_mean_bitrate_kbps=i(t.VBR_mean_bitrate_kbps,160)):(t.VBR_mean_bitrate_kbps=r(t.VBR_mean_bitrate_kbps,32),t.VBR_mean_bitrate_kbps=i(t.VBR_mean_bitrate_kbps,320))),0==t.lowpassfreq){switch(t.VBR){case f.vbr_off:var v=new a;d(v,t.brate),v=v.lowerlimit;break;case f.vbr_abr:d(v=new a,t.VBR_mean_bitrate_kbps),v=v.lowerlimit;break;case f.vbr_rh:var g=[19500,19e3,18600,18e3,17500,16e3,15600,14900,12500,1e4,3950];if(0<=t.VBR_q&&9>=t.VBR_q){v=g[t.VBR_q],g=g[t.VBR_q+1];var S=t.VBR_q_frac;v=linear_int(v,g,S)}else v=19500;break;default:g=[19500,19e3,18500,18e3,17500,16500,15500,14500,12500,9500,3950],0<=t.VBR_q&&9>=t.VBR_q?(v=g[t.VBR_q],g=g[t.VBR_q+1],S=t.VBR_q_frac,v=linear_int(v,g,S)):v=19500}t.mode!=c.MONO||t.VBR!=f.vbr_off&&t.VBR!=f.vbr_abr||(v*=1.5),t.lowpassfreq=0|v}if(0==t.out_samplerate&&(2*t.lowpassfreq>t.in_samplerate&&(t.lowpassfreq=t.in_samplerate/2),v=0|t.lowpassfreq,S=44100,48e3<=(g=t.in_samplerate)?S=48e3:44100<=g?S=44100:32e3<=g?S=32e3:24e3<=g?S=24e3:22050<=g?S=22050:16e3<=g?S=16e3:12e3<=g?S=12e3:11025<=g?S=11025:8e3<=g&&(S=8e3),-1==v?v=S:(15960>=v&&(S=44100),15250>=v&&(S=32e3),11220>=v&&(S=24e3),9970>=v&&(S=22050),7230>=v&&(S=16e3),5420>=v&&(S=12e3),4510>=v&&(S=11025),3970>=v&&(S=8e3),v=g<S?44100<g?48e3:32e3<g?44100:24e3<g?32e3:22050<g?24e3:16e3<g?22050:12e3<g?16e3:11025<g?12e3:8e3<g?11025:8e3:S),t.out_samplerate=v),t.lowpassfreq=i(20500,t.lowpassfreq),t.lowpassfreq=i(t.out_samplerate/2,t.lowpassfreq),t.VBR==f.vbr_off&&(t.compression_ratio=16*t.out_samplerate*s.channels_out/(1e3*t.brate)),t.VBR==f.vbr_abr&&(t.compression_ratio=16*t.out_samplerate*s.channels_out/(1e3*t.VBR_mean_bitrate_kbps)),t.bWriteVbrTag||(t.findReplayGain=!1,t.decode_on_the_fly=!1,s.findPeakSample=!1),s.findReplayGain=t.findReplayGain,s.decode_on_the_fly=t.decode_on_the_fly,s.decode_on_the_fly&&(s.findPeakSample=!0),s.findReplayGain&&T.InitGainAnalysis(s.rgdata,t.out_samplerate)==h.INIT_GAIN_ANALYSIS_ERROR)return t.internal_flags=null,-6;switch(s.decode_on_the_fly&&!t.decode_only&&(null!=s.hip&&V.hip_decode_exit(s.hip),s.hip=V.hip_decode_init()),s.mode_gr=24e3>=t.out_samplerate?1:2,t.framesize=576*s.mode_gr,t.encoder_delay=H.ENCDELAY,s.resample_ratio=t.in_samplerate/t.out_samplerate,t.VBR){case f.vbr_mt:case f.vbr_rh:case f.vbr_mtrh:t.compression_ratio=[5.7,6.5,7.3,8.2,10,11.9,13,14,15,16.5][t.VBR_q];break;case f.vbr_abr:t.compression_ratio=16*t.out_samplerate*s.channels_out/(1e3*t.VBR_mean_bitrate_kbps);break;default:t.compression_ratio=16*t.out_samplerate*s.channels_out/(1e3*t.brate)}t.mode==c.NOT_SET&&(t.mode=c.JOINT_STEREO),0<t.highpassfreq?(s.highpass1=2*t.highpassfreq,s.highpass2=0<=t.highpasswidth?2*(t.highpassfreq+t.highpasswidth):2*t.highpassfreq,s.highpass1/=t.out_samplerate,s.highpass2/=t.out_samplerate):(s.highpass1=0,s.highpass2=0),0<t.lowpassfreq?(s.lowpass2=2*t.lowpassfreq,0<=t.lowpasswidth?(s.lowpass1=2*(t.lowpassfreq-t.lowpasswidth),0>s.lowpass1&&(s.lowpass1=0)):s.lowpass1=2*t.lowpassfreq,s.lowpass1/=t.out_samplerate,s.lowpass2/=t.out_samplerate):(s.lowpass1=0,s.lowpass2=0);var R=32,A=-1;if(0<(v=t.internal_flags).lowpass1){var B=999;for(g=0;31>=g;g++)(S=g/31)>=v.lowpass2&&(R=i(R,g)),v.lowpass1<S&&S<v.lowpass2&&(B=i(B,g));v.lowpass1=999==B?(R-.75)/31:(B-.75)/31,v.lowpass2=R/31}if(0<v.highpass2&&v.highpass2<.75/31*.9&&(v.highpass1=0,v.highpass2=0,ne.err.println("Warning: highpass filter disabled.  highpass frequency too small\n")),0<v.highpass2){for(R=-1,g=0;31>=g;g++)(S=g/31)<=v.highpass1&&(A=r(A,g)),v.highpass1<S&&S<v.highpass2&&(R=r(R,g));v.highpass1=A/31,v.highpass2=-1==R?(A+.75)/31:(R+.75)/31}for(g=0;32>g;g++)S=g/31,A=v.highpass2>v.highpass1?_((v.highpass2-S)/(v.highpass2-v.highpass1+1e-20)):1,S=v.lowpass2>v.lowpass1?_((S-v.lowpass1)/(v.lowpass2-v.lowpass1+1e-20)):1,v.amp_filter[g]=A*S;if(s.samplerate_index=u(t.out_samplerate,t),0>s.samplerate_index)return t.internal_flags=null,-1;if(t.VBR!=f.vbr_off)s.bitrate_index=1;else if(t.free_format)s.bitrate_index=0;else if(t.brate=p(t.brate,t.version,t.out_samplerate),s.bitrate_index=b(t.brate,t.version,t.out_samplerate),0>=s.bitrate_index)return t.internal_flags=null,-1;for(t.analysis&&(t.bWriteVbrTag=!1),null!=s.pinfo&&(t.bWriteVbrTag=!1),E.init_bit_stream_w(s),v=s.samplerate_index+3*t.version+6*(16e3>t.out_samplerate?1:0),g=0;g<H.SBMAX_l+1;g++)s.scalefac_band.l[g]=M.sfBandIndex[v].l[g];for(g=0;g<H.PSFB21+1;g++)S=(s.scalefac_band.l[22]-s.scalefac_band.l[21])/H.PSFB21,S=s.scalefac_band.l[21]+g*S,s.scalefac_band.psfb21[g]=S;for(s.scalefac_band.psfb21[H.PSFB21]=576,g=0;g<H.SBMAX_s+1;g++)s.scalefac_band.s[g]=M.sfBandIndex[v].s[g];for(g=0;g<H.PSFB12+1;g++)S=(s.scalefac_band.s[13]-s.scalefac_band.s[12])/H.PSFB12,S=s.scalefac_band.s[12]+g*S,s.scalefac_band.psfb12[g]=S;for(s.scalefac_band.psfb12[H.PSFB12]=192,s.sideinfo_len=1==t.version?1==s.channels_out?21:36:1==s.channels_out?13:21,t.error_protection&&(s.sideinfo_len+=2),v=t.internal_flags,t.frameNum=0,t.write_id3tag_automatic&&L.id3tag_write_v2(t),v.bitrate_stereoMode_Hist=o([16,5]),v.bitrate_blockType_Hist=o([16,6]),v.PeakSample=0,t.bWriteVbrTag&&P.InitVbrTag(t),s.Class_ID=4294479419,v=0;19>v;v++)s.nsPsy.pefirbuf[v]=700*s.mode_gr*s.channels_out;switch(-1==t.ATHtype&&(t.ATHtype=4),t.VBR){case f.vbr_mt:t.VBR=f.vbr_mtrh;case f.vbr_mtrh:null==t.useTemporal&&(t.useTemporal=!1),x.apply_preset(t,500-10*t.VBR_q,0),0>t.quality&&(t.quality=LAME_DEFAULT_QUALITY),5>t.quality&&(t.quality=0),5<t.quality&&(t.quality=5),s.PSY.mask_adjust=t.maskingadjust,s.PSY.mask_adjust_short=t.maskingadjust_short,s.sfb21_extra=!t.experimentalY&&44e3<t.out_samplerate,s.iteration_loop=new VBRNewIterationLoop(I);break;case f.vbr_rh:x.apply_preset(t,500-10*t.VBR_q,0),s.PSY.mask_adjust=t.maskingadjust,s.PSY.mask_adjust_short=t.maskingadjust_short,s.sfb21_extra=!t.experimentalY&&44e3<t.out_samplerate,6<t.quality&&(t.quality=6),0>t.quality&&(t.quality=LAME_DEFAULT_QUALITY),s.iteration_loop=new VBROldIterationLoop(I);break;default:s.sfb21_extra=!1,0>t.quality&&(t.quality=LAME_DEFAULT_QUALITY),(v=t.VBR)==f.vbr_off&&(t.VBR_mean_bitrate_kbps=t.brate),x.apply_preset(t,t.VBR_mean_bitrate_kbps,0),t.VBR=v,s.PSY.mask_adjust=t.maskingadjust,s.PSY.mask_adjust_short=t.maskingadjust_short,s.iteration_loop=v==f.vbr_off?new y(I):new ABRIterationLoop(I)}if(t.VBR!=f.vbr_off){if(s.VBR_min_bitrate=1,s.VBR_max_bitrate=14,16e3>t.out_samplerate&&(s.VBR_max_bitrate=8),0!=t.VBR_min_bitrate_kbps&&(t.VBR_min_bitrate_kbps=p(t.VBR_min_bitrate_kbps,t.version,t.out_samplerate),s.VBR_min_bitrate=b(t.VBR_min_bitrate_kbps,t.version,t.out_samplerate),0>s.VBR_min_bitrate)||0!=t.VBR_max_bitrate_kbps&&(t.VBR_max_bitrate_kbps=p(t.VBR_max_bitrate_kbps,t.version,t.out_samplerate),s.VBR_max_bitrate=b(t.VBR_max_bitrate_kbps,t.version,t.out_samplerate),0>s.VBR_max_bitrate))return-1;t.VBR_min_bitrate_kbps=oe.bitrate_table[t.version][s.VBR_min_bitrate],t.VBR_max_bitrate_kbps=oe.bitrate_table[t.version][s.VBR_max_bitrate],t.VBR_mean_bitrate_kbps=i(oe.bitrate_table[t.version][s.VBR_max_bitrate],t.VBR_mean_bitrate_kbps),t.VBR_mean_bitrate_kbps=r(oe.bitrate_table[t.version][s.VBR_min_bitrate],t.VBR_mean_bitrate_kbps)}switch(t.tune&&(s.PSY.mask_adjust+=t.tune_value_a,s.PSY.mask_adjust_short+=t.tune_value_a),v=t.internal_flags,t.quality){default:case 9:v.psymodel=0,v.noise_shaping=0,v.noise_shaping_amp=0,v.noise_shaping_stop=0,v.use_best_huffman=0,v.full_outer_loop=0;break;case 8:t.quality=7;case 7:v.psymodel=1,v.noise_shaping=0,v.noise_shaping_amp=0,v.noise_shaping_stop=0,v.use_best_huffman=0,v.full_outer_loop=0;break;case 6:case 5:v.psymodel=1,0==v.noise_shaping&&(v.noise_shaping=1),v.noise_shaping_amp=0,v.noise_shaping_stop=0,-1==v.subblock_gain&&(v.subblock_gain=1),v.use_best_huffman=0,v.full_outer_loop=0;break;case 4:v.psymodel=1,0==v.noise_shaping&&(v.noise_shaping=1),v.noise_shaping_amp=0,v.noise_shaping_stop=0,-1==v.subblock_gain&&(v.subblock_gain=1),v.use_best_huffman=1,v.full_outer_loop=0;break;case 3:v.psymodel=1,0==v.noise_shaping&&(v.noise_shaping=1),v.noise_shaping_amp=1,v.noise_shaping_stop=1,-1==v.subblock_gain&&(v.subblock_gain=1),v.use_best_huffman=1,v.full_outer_loop=0;break;case 2:v.psymodel=1,0==v.noise_shaping&&(v.noise_shaping=1),0==v.substep_shaping&&(v.substep_shaping=2),v.noise_shaping_amp=1,v.noise_shaping_stop=1,-1==v.subblock_gain&&(v.subblock_gain=1),v.use_best_huffman=1,v.full_outer_loop=0;break;case 1:v.psymodel=1,0==v.noise_shaping&&(v.noise_shaping=1),0==v.substep_shaping&&(v.substep_shaping=2),v.noise_shaping_amp=2,v.noise_shaping_stop=1,-1==v.subblock_gain&&(v.subblock_gain=1),v.use_best_huffman=1,v.full_outer_loop=0;break;case 0:v.psymodel=1,0==v.noise_shaping&&(v.noise_shaping=1),0==v.substep_shaping&&(v.substep_shaping=2),v.noise_shaping_amp=2,v.noise_shaping_stop=1,-1==v.subblock_gain&&(v.subblock_gain=1),v.use_best_huffman=1,v.full_outer_loop=0}return s.ATH.useAdjust=0>t.athaa_type?3:t.athaa_type,s.ATH.aaSensitivityP=n(10,t.athaa_sensitivity/-10),null==t.short_blocks&&(t.short_blocks=l.short_block_allowed),t.short_blocks!=l.short_block_allowed||t.mode!=c.JOINT_STEREO&&t.mode!=c.STEREO||(t.short_blocks=l.short_block_coupled),0>t.quant_comp&&(t.quant_comp=1),0>t.quant_comp_short&&(t.quant_comp_short=0),0>t.msfix&&(t.msfix=0),t.exp_nspsytune|=1,0>t.internal_flags.nsPsy.attackthre&&(t.internal_flags.nsPsy.attackthre=Y.NSATTACKTHRE),0>t.internal_flags.nsPsy.attackthre_s&&(t.internal_flags.nsPsy.attackthre_s=Y.NSATTACKTHRE_S),0>t.scale&&(t.scale=1),0>t.ATHtype&&(t.ATHtype=4),0>t.ATHcurve&&(t.ATHcurve=4),0>t.athaa_loudapprox&&(t.athaa_loudapprox=2),0>t.interChRatio&&(t.interChRatio=0),null==t.useTemporal&&(t.useTemporal=!0),s.slot_lag=s.frac_SpF=0,t.VBR==f.vbr_off&&(s.slot_lag=s.frac_SpF=0|72e3*(t.version+1)*t.brate%t.out_samplerate),M.iteration_init(t),O.psymodel_init(t),0},this.lame_encode_flush=function(e,t,a,s){var n=e.internal_flags,r=function e(t){if(1==t.length)return new Int16Array(t[0]);var a=t[0];t=t.slice(1);for(var s=[],n=0;n<a;n++)s.push(e(t));return s}([2,1152]),i=0,o=n.mf_samples_to_encode-H.POSTDELAY,_=v(e);if(1>n.mf_samples_to_encode)return 0;var l=0;e.in_samplerate!=e.out_samplerate&&(o+=16*e.out_samplerate/e.in_samplerate);var f=e.framesize-o%e.framesize;for(576>f&&(f+=e.framesize),e.encoder_padding=f,f=(o+f)/e.framesize;0<f&&0<=i;){var c=_-n.mf_size;o=e.frameNum,c*=e.in_samplerate,1152<(c/=e.out_samplerate)&&(c=1152),1>c&&(c=1),i=s-l,0==s&&(i=0),a+=i=this.lame_encode_buffer(e,r[0],r[1],c,t,a,i),l+=i,f-=o==e.frameNum?0:1}if(n.mf_samples_to_encode=0,0>i)return i;if(i=s-l,0==s&&(i=0),E.flush_bitstream(e),0>(i=E.copy_buffer(n,t,a,i,1)))return i;if(a+=i,i=s-(l+=i),0==s&&(i=0),e.write_id3tag_automatic){if(L.id3tag_write_v1(e),0>(i=E.copy_buffer(n,t,a,i,0)))return i;l+=i}return l},this.lame_encode_buffer=function(e,a,s,n,r,o,_){var l=e.internal_flags,f=[null,null];if(4294479419!=l.Class_ID)return-3;if(0==n)return 0;(null==l.in_buffer_0||l.in_buffer_nsamples<n)&&(l.in_buffer_0=t(n),l.in_buffer_1=t(n),l.in_buffer_nsamples=n),f[0]=l.in_buffer_0,f[1]=l.in_buffer_1;for(var c=0;c<n;c++)f[0][c]=a[c],1<l.channels_in&&(f[1][c]=s[c]);return function(e,a,s,n,r,o,_){var l=e.internal_flags,f=0,c=[null,null],u=[null,null];if(4294479419!=l.Class_ID)return-3;if(0==n)return 0;var p=E.copy_buffer(l,r,o,_,0);if(0>p)return p;if(o+=p,f+=p,u[0]=a,u[1]=s,m.NEQ(e.scale,0)&&m.NEQ(e.scale,1))for(p=0;p<n;++p)u[0][p]*=e.scale,2==l.channels_out&&(u[1][p]*=e.scale);if(m.NEQ(e.scale_left,0)&&m.NEQ(e.scale_left,1))for(p=0;p<n;++p)u[0][p]*=e.scale_left;if(m.NEQ(e.scale_right,0)&&m.NEQ(e.scale_right,1))for(p=0;p<n;++p)u[1][p]*=e.scale_right;if(2==e.num_channels&&1==l.channels_out)for(p=0;p<n;++p)u[0][p]=.5*(u[0][p]+u[1][p]),u[1][p]=0;for(a=v(e),c[0]=l.mfbuf[0],c[1]=l.mfbuf[1],s=0;0<n;){var b=[null,null];b[0]=u[0],b[1]=u[1];var d=e,B=c,w=s,y=n,k=p=new g,x=d.internal_flags;if(.9999>x.resample_ratio||1.0001<x.resample_ratio)for(var M=0;M<x.channels_out;M++){var I,P=new S,L=B[M],V=x.mf_size,O=d.framesize,N=b[M],D=w,C=y,F=P,Y=M,q=d.internal_flags,j=0,z=d.out_samplerate/R(d.out_samplerate,d.in_samplerate);z>X.BPC&&(z=X.BPC);var G=1e-4>te(q.resample_ratio-ee(.5+q.resample_ratio))?1:0,K=1/q.resample_ratio;1<K&&(K=1);var U=31;if(0==U%2&&--U,G=(U+=G)+1,0==q.fill_buffer_resample_init){for(q.inbuf_old[0]=t(G),q.inbuf_old[1]=t(G),I=0;I<=2*z;++I)q.blackfilt[I]=t(G);for(q.itime[0]=0,j=q.itime[1]=0;j<=2*z;j++){var Z=0,J=(j-z)/(2*z);for(I=0;I<=U;I++){var $=q.blackfilt[j],ae=I,se=I-J,ne=Q*K;0>(se/=U)&&(se=0),1<se&&(se=1);var re=se-.5;se=.42-.5*W(2*se*Q)+.08*W(4*se*Q),Z+=$[ae]=1e-9>te(re)?ne/Q:se*Math.sin(U*ne*re)/(Q*U*re)}for(I=0;I<=U;I++)q.blackfilt[j][I]/=Z}q.fill_buffer_resample_init=1}for(Z=q.inbuf_old[Y],K=0;K<O&&(I=K*q.resample_ratio,!(U+(j=0|ee(I-q.itime[Y]))-U/2>=C));K++){for(J=I-q.itime[Y]-(j+U%2*.5),J=0|ee(2*J*z+z+.5),I=$=0;I<=U;++I)$+=(0>(ae=0|I+j-U/2)?Z[G+ae]:N[D+ae])*q.blackfilt[J][I];L[V+K]=$}if(F.num_used=i(C,U+j-U/2),q.itime[Y]+=F.num_used-K*q.resample_ratio,F.num_used>=G)for(I=0;I<G;I++)Z[I]=N[D+F.num_used+I-G];else{for(L=G-F.num_used,I=0;I<L;++I)Z[I]=Z[I+F.num_used];for(j=0;I<G;++I,++j)Z[I]=N[D+j]}k.n_out=K,k.n_in=P.num_used}else for(k.n_out=i(d.framesize,y),k.n_in=k.n_out,d=0;d<k.n_out;++d)B[0][x.mf_size+d]=b[0][w+d],2==x.channels_out&&(B[1][x.mf_size+d]=b[1][w+d]);if(B=p.n_in,p=p.n_out,l.findReplayGain&&!l.decode_on_the_fly&&T.AnalyzeSamples(l.rgdata,c[0],l.mf_size,c[1],l.mf_size,p,l.channels_out)==h.GAIN_ANALYSIS_ERROR)return-6;if(n-=B,s+=B,l.mf_size+=p,1>l.mf_samples_to_encode&&(l.mf_samples_to_encode=H.ENCDELAY+H.POSTDELAY),l.mf_samples_to_encode+=p,l.mf_size>=a){if(B=_-f,0==_&&(B=0),p=e,B=A.enc.lame_encode_mp3_frame(p,c[0],c[1],r,o,B),p.frameNum++,0>(p=B))return p;for(o+=p,f+=p,l.mf_size-=e.framesize,l.mf_samples_to_encode-=e.framesize,B=0;B<l.channels_out;B++)for(p=0;p<l.mf_size;p++)c[B][p]=c[B][p+e.framesize]}}return f}(e,f[0],f[1],n,r,o,_)}}function j(){this.setModules=function(){}}function z(){this.setModules=function(){}}function G(){}function K(){this.setModules=function(){}}function U(){this.sampleRate=this.channels=this.dataLen=this.dataOffset=0}function Z(e){return e.charCodeAt(0)<<24|e.charCodeAt(1)<<16|e.charCodeAt(2)<<8|e.charCodeAt(3)}var W=Math.cos,Q=Math.PI,J=Math.exp,$=Math.sqrt,ee=Math.floor,te=Math.abs,ae=Math.ceil,se={fill:function(e,t,a,s){if(2==arguments.length)for(var n=0;n<e.length;n++)e[n]=arguments[1];else for(n=t;n<a;n++)e[n]=s}},ne={arraycopy:function(e,t,a,s,n){for(n=t+n;t<n;)a[s++]=e[t++]}},re={SQRT2:1.4142135623730951,FAST_LOG10:function(e){return T()(e)},FAST_LOG10_X:function(e,t){return T()(e)*t}};l.short_block_allowed=new l(0),l.short_block_coupled=new l(1),l.short_block_dispensed=new l(2),l.short_block_forced=new l(3);var ie={MAX_VALUE:34028235e31};f.vbr_off=new f(0),f.vbr_mt=new f(1),f.vbr_rh=new f(2),f.vbr_abr=new f(3),f.vbr_mtrh=new f(4),f.vbr_default=f.vbr_mtrh,c.STEREO=new c(0),c.JOINT_STEREO=new c(1),c.DUAL_CHANNEL=new c(2),c.MONO=new c(3),c.NOT_SET=new c(4),h.STEPS_per_dB=100,h.MAX_dB=120,h.GAIN_NOT_ENOUGH_SAMPLES=-24601,h.GAIN_ANALYSIS_ERROR=0,h.GAIN_ANALYSIS_OK=1,h.INIT_GAIN_ANALYSIS_ERROR=0,h.INIT_GAIN_ANALYSIS_OK=1,h.YULE_ORDER=10,h.MAX_ORDER=h.YULE_ORDER,h.MAX_SAMP_FREQ=48e3,h.RMS_WINDOW_TIME_NUMERATOR=1,h.RMS_WINDOW_TIME_DENOMINATOR=20,h.MAX_SAMPLES_PER_WINDOW=h.MAX_SAMP_FREQ*h.RMS_WINDOW_TIME_NUMERATOR/h.RMS_WINDOW_TIME_DENOMINATOR+1,m.EQ=function(e,t){return te(e)>te(t)?te(e-t)<=1e-6*te(e):te(e-t)<=1e-6*te(t)},m.NEQ=function(e,t){return!m.EQ(e,t)},v.NUMTOCENTRIES=100,v.MAXFRAMESIZE=2880;var oe={t1HB:[1,1,1,0],t2HB:[1,2,1,3,1,1,3,2,0],t3HB:[3,2,1,1,1,1,3,2,0],t5HB:[1,2,6,5,3,1,4,4,7,5,7,1,6,1,1,0],t6HB:[7,3,5,1,6,2,3,2,5,4,4,1,3,3,2,0],t7HB:[1,2,10,19,16,10,3,3,7,10,5,3,11,4,13,17,8,4,12,11,18,15,11,2,7,6,9,14,3,1,6,4,5,3,2,0],t8HB:[3,4,6,18,12,5,5,1,2,16,9,3,7,3,5,14,7,3,19,17,15,13,10,4,13,5,8,11,5,1,12,4,4,1,1,0],t9HB:[7,5,9,14,15,7,6,4,5,5,6,7,7,6,8,8,8,5,15,6,9,10,5,1,11,7,9,6,4,1,14,4,6,2,6,0],t10HB:[1,2,10,23,35,30,12,17,3,3,8,12,18,21,12,7,11,9,15,21,32,40,19,6,14,13,22,34,46,23,18,7,20,19,33,47,27,22,9,3,31,22,41,26,21,20,5,3,14,13,10,11,16,6,5,1,9,8,7,8,4,4,2,0],t11HB:[3,4,10,24,34,33,21,15,5,3,4,10,32,17,11,10,11,7,13,18,30,31,20,5,25,11,19,59,27,18,12,5,35,33,31,58,30,16,7,5,28,26,32,19,17,15,8,14,14,12,9,13,14,9,4,1,11,4,6,6,6,3,2,0],t12HB:[9,6,16,33,41,39,38,26,7,5,6,9,23,16,26,11,17,7,11,14,21,30,10,7,17,10,15,12,18,28,14,5,32,13,22,19,18,16,9,5,40,17,31,29,17,13,4,2,27,12,11,15,10,7,4,1,27,12,8,12,6,3,1,0],t13HB:[1,5,14,21,34,51,46,71,42,52,68,52,67,44,43,19,3,4,12,19,31,26,44,33,31,24,32,24,31,35,22,14,15,13,23,36,59,49,77,65,29,40,30,40,27,33,42,16,22,20,37,61,56,79,73,64,43,76,56,37,26,31,25,14,35,16,60,57,97,75,114,91,54,73,55,41,48,53,23,24,58,27,50,96,76,70,93,84,77,58,79,29,74,49,41,17,47,45,78,74,115,94,90,79,69,83,71,50,59,38,36,15,72,34,56,95,92,85,91,90,86,73,77,65,51,44,43,42,43,20,30,44,55,78,72,87,78,61,46,54,37,30,20,16,53,25,41,37,44,59,54,81,66,76,57,54,37,18,39,11,35,33,31,57,42,82,72,80,47,58,55,21,22,26,38,22,53,25,23,38,70,60,51,36,55,26,34,23,27,14,9,7,34,32,28,39,49,75,30,52,48,40,52,28,18,17,9,5,45,21,34,64,56,50,49,45,31,19,12,15,10,7,6,3,48,23,20,39,36,35,53,21,16,23,13,10,6,1,4,2,16,15,17,27,25,20,29,11,17,12,16,8,1,1,0,1],t15HB:[7,12,18,53,47,76,124,108,89,123,108,119,107,81,122,63,13,5,16,27,46,36,61,51,42,70,52,83,65,41,59,36,19,17,15,24,41,34,59,48,40,64,50,78,62,80,56,33,29,28,25,43,39,63,55,93,76,59,93,72,54,75,50,29,52,22,42,40,67,57,95,79,72,57,89,69,49,66,46,27,77,37,35,66,58,52,91,74,62,48,79,63,90,62,40,38,125,32,60,56,50,92,78,65,55,87,71,51,73,51,70,30,109,53,49,94,88,75,66,122,91,73,56,42,64,44,21,25,90,43,41,77,73,63,56,92,77,66,47,67,48,53,36,20,71,34,67,60,58,49,88,76,67,106,71,54,38,39,23,15,109,53,51,47,90,82,58,57,48,72,57,41,23,27,62,9,86,42,40,37,70,64,52,43,70,55,42,25,29,18,11,11,118,68,30,55,50,46,74,65,49,39,24,16,22,13,14,7,91,44,39,38,34,63,52,45,31,52,28,19,14,8,9,3,123,60,58,53,47,43,32,22,37,24,17,12,15,10,2,1,71,37,34,30,28,20,17,26,21,16,10,6,8,6,2,0],t16HB:[1,5,14,44,74,63,110,93,172,149,138,242,225,195,376,17,3,4,12,20,35,62,53,47,83,75,68,119,201,107,207,9,15,13,23,38,67,58,103,90,161,72,127,117,110,209,206,16,45,21,39,69,64,114,99,87,158,140,252,212,199,387,365,26,75,36,68,65,115,101,179,164,155,264,246,226,395,382,362,9,66,30,59,56,102,185,173,265,142,253,232,400,388,378,445,16,111,54,52,100,184,178,160,133,257,244,228,217,385,366,715,10,98,48,91,88,165,157,148,261,248,407,397,372,380,889,884,8,85,84,81,159,156,143,260,249,427,401,392,383,727,713,708,7,154,76,73,141,131,256,245,426,406,394,384,735,359,710,352,11,139,129,67,125,247,233,229,219,393,743,737,720,885,882,439,4,243,120,118,115,227,223,396,746,742,736,721,712,706,223,436,6,202,224,222,218,216,389,386,381,364,888,443,707,440,437,1728,4,747,211,210,208,370,379,734,723,714,1735,883,877,876,3459,865,2,377,369,102,187,726,722,358,711,709,866,1734,871,3458,870,434,0,12,10,7,11,10,17,11,9,13,12,10,7,5,3,1,3],t24HB:[15,13,46,80,146,262,248,434,426,669,653,649,621,517,1032,88,14,12,21,38,71,130,122,216,209,198,327,345,319,297,279,42,47,22,41,74,68,128,120,221,207,194,182,340,315,295,541,18,81,39,75,70,134,125,116,220,204,190,178,325,311,293,271,16,147,72,69,135,127,118,112,210,200,188,352,323,306,285,540,14,263,66,129,126,119,114,214,202,192,180,341,317,301,281,262,12,249,123,121,117,113,215,206,195,185,347,330,308,291,272,520,10,435,115,111,109,211,203,196,187,353,332,313,298,283,531,381,17,427,212,208,205,201,193,186,177,169,320,303,286,268,514,377,16,335,199,197,191,189,181,174,333,321,305,289,275,521,379,371,11,668,184,183,179,175,344,331,314,304,290,277,530,383,373,366,10,652,346,171,168,164,318,309,299,287,276,263,513,375,368,362,6,648,322,316,312,307,302,292,284,269,261,512,376,370,364,359,4,620,300,296,294,288,282,273,266,515,380,374,369,365,361,357,2,1033,280,278,274,267,264,259,382,378,372,367,363,360,358,356,0,43,20,19,17,15,13,11,9,7,6,4,7,5,3,1,3],t32HB:[1,10,8,20,12,20,16,32,14,12,24,0,28,16,24,16],t33HB:[15,28,26,48,22,40,36,64,14,24,20,32,12,16,8,0],t1l:[1,4,3,5],t2l:[1,4,7,4,5,7,6,7,8],t3l:[2,3,7,4,4,7,6,7,8],t5l:[1,4,7,8,4,5,8,9,7,8,9,10,8,8,9,10],t6l:[3,4,6,8,4,4,6,7,5,6,7,8,7,7,8,9],t7l:[1,4,7,9,9,10,4,6,8,9,9,10,7,7,9,10,10,11,8,9,10,11,11,11,8,9,10,11,11,12,9,10,11,12,12,12],t8l:[2,4,7,9,9,10,4,4,6,10,10,10,7,6,8,10,10,11,9,10,10,11,11,12,9,9,10,11,12,12,10,10,11,11,13,13],t9l:[3,4,6,7,9,10,4,5,6,7,8,10,5,6,7,8,9,10,7,7,8,9,9,10,8,8,9,9,10,11,9,9,10,10,11,11],t10l:[1,4,7,9,10,10,10,11,4,6,8,9,10,11,10,10,7,8,9,10,11,12,11,11,8,9,10,11,12,12,11,12,9,10,11,12,12,12,12,12,10,11,12,12,13,13,12,13,9,10,11,12,12,12,13,13,10,10,11,12,12,13,13,13],t11l:[2,4,6,8,9,10,9,10,4,5,6,8,10,10,9,10,6,7,8,9,10,11,10,10,8,8,9,11,10,12,10,11,9,10,10,11,11,12,11,12,9,10,11,12,12,13,12,13,9,9,9,10,11,12,12,12,9,9,10,11,12,12,12,12],t12l:[4,4,6,8,9,10,10,10,4,5,6,7,9,9,10,10,6,6,7,8,9,10,9,10,7,7,8,8,9,10,10,10,8,8,9,9,10,10,10,11,9,9,10,10,10,11,10,11,9,9,9,10,10,11,11,12,10,10,10,11,11,11,11,12],t13l:[1,5,7,8,9,10,10,11,10,11,12,12,13,13,14,14,4,6,8,9,10,10,11,11,11,11,12,12,13,14,14,14,7,8,9,10,11,11,12,12,11,12,12,13,13,14,15,15,8,9,10,11,11,12,12,12,12,13,13,13,13,14,15,15,9,9,11,11,12,12,13,13,12,13,13,14,14,15,15,16,10,10,11,12,12,12,13,13,13,13,14,13,15,15,16,16,10,11,12,12,13,13,13,13,13,14,14,14,15,15,16,16,11,11,12,13,13,13,14,14,14,14,15,15,15,16,18,18,10,10,11,12,12,13,13,14,14,14,14,15,15,16,17,17,11,11,12,12,13,13,13,15,14,15,15,16,16,16,18,17,11,12,12,13,13,14,14,15,14,15,16,15,16,17,18,19,12,12,12,13,14,14,14,14,15,15,15,16,17,17,17,18,12,13,13,14,14,15,14,15,16,16,17,17,17,18,18,18,13,13,14,15,15,15,16,16,16,16,16,17,18,17,18,18,14,14,14,15,15,15,17,16,16,19,17,17,17,19,18,18,13,14,15,16,16,16,17,16,17,17,18,18,21,20,21,18],t15l:[3,5,6,8,8,9,10,10,10,11,11,12,12,12,13,14,5,5,7,8,9,9,10,10,10,11,11,12,12,12,13,13,6,7,7,8,9,9,10,10,10,11,11,12,12,13,13,13,7,8,8,9,9,10,10,11,11,11,12,12,12,13,13,13,8,8,9,9,10,10,11,11,11,11,12,12,12,13,13,13,9,9,9,10,10,10,11,11,11,11,12,12,13,13,13,14,10,9,10,10,10,11,11,11,11,12,12,12,13,13,14,14,10,10,10,11,11,11,11,12,12,12,12,12,13,13,13,14,10,10,10,11,11,11,11,12,12,12,12,13,13,14,14,14,10,10,11,11,11,11,12,12,12,13,13,13,13,14,14,14,11,11,11,11,12,12,12,12,12,13,13,13,13,14,15,14,11,11,11,11,12,12,12,12,13,13,13,13,14,14,14,15,12,12,11,12,12,12,13,13,13,13,13,13,14,14,15,15,12,12,12,12,12,13,13,13,13,14,14,14,14,14,15,15,13,13,13,13,13,13,13,13,14,14,14,14,15,15,14,15,13,13,13,13,13,13,13,14,14,14,14,14,15,15,15,15],t16_5l:[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,11,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,11,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,12,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,13,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,12,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,13,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,13,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,13,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,13,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,14,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,13,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,14,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,14,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,14,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,14,11,11,11,12,12,13,13,13,14,14,14,14,14,14,14,12],t16l:[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,10,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,10,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,11,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,12,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,11,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,12,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,12,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,12,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,12,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,13,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,12,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,13,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,13,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,13,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,13,10,10,10,11,11,12,12,12,13,13,13,13,13,13,13,10],t24l:[4,5,7,8,9,10,10,11,11,12,12,12,12,12,13,10,5,6,7,8,9,10,10,11,11,11,12,12,12,12,12,10,7,7,8,9,9,10,10,11,11,11,11,12,12,12,13,9,8,8,9,9,10,10,10,11,11,11,11,12,12,12,12,9,9,9,9,10,10,10,10,11,11,11,12,12,12,12,13,9,10,9,10,10,10,10,11,11,11,11,12,12,12,12,12,9,10,10,10,10,10,11,11,11,11,12,12,12,12,12,13,9,11,10,10,10,11,11,11,11,12,12,12,12,12,13,13,10,11,11,11,11,11,11,11,11,11,12,12,12,12,13,13,10,11,11,11,11,11,11,11,12,12,12,12,12,13,13,13,10,12,11,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,10,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,10,13,12,12,12,12,12,12,13,13,13,13,13,13,13,13,10,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,6],t32l:[1,5,5,7,5,8,7,9,5,7,7,9,7,9,9,10],t33l:[4,5,5,6,5,6,6,7,5,6,6,7,6,7,7,8]};oe.ht=[new g(0,0,null,null),new g(2,0,oe.t1HB,oe.t1l),new g(3,0,oe.t2HB,oe.t2l),new g(3,0,oe.t3HB,oe.t3l),new g(0,0,null,null),new g(4,0,oe.t5HB,oe.t5l),new g(4,0,oe.t6HB,oe.t6l),new g(6,0,oe.t7HB,oe.t7l),new g(6,0,oe.t8HB,oe.t8l),new g(6,0,oe.t9HB,oe.t9l),new g(8,0,oe.t10HB,oe.t10l),new g(8,0,oe.t11HB,oe.t11l),new g(8,0,oe.t12HB,oe.t12l),new g(16,0,oe.t13HB,oe.t13l),new g(0,0,null,oe.t16_5l),new g(16,0,oe.t15HB,oe.t15l),new g(1,1,oe.t16HB,oe.t16l),new g(2,3,oe.t16HB,oe.t16l),new g(3,7,oe.t16HB,oe.t16l),new g(4,15,oe.t16HB,oe.t16l),new g(6,63,oe.t16HB,oe.t16l),new g(8,255,oe.t16HB,oe.t16l),new g(10,1023,oe.t16HB,oe.t16l),new g(13,8191,oe.t16HB,oe.t16l),new g(4,15,oe.t24HB,oe.t24l),new g(5,31,oe.t24HB,oe.t24l),new g(6,63,oe.t24HB,oe.t24l),new g(7,127,oe.t24HB,oe.t24l),new g(8,255,oe.t24HB,oe.t24l),new g(9,511,oe.t24HB,oe.t24l),new g(11,2047,oe.t24HB,oe.t24l),new g(13,8191,oe.t24HB,oe.t24l),new g(0,0,oe.t32HB,oe.t32l),new g(0,0,oe.t33HB,oe.t33l)],oe.largetbl=[65540,327685,458759,589832,655369,655370,720906,720907,786443,786444,786444,851980,851980,851980,917517,655370,262149,393222,524295,589832,655369,720906,720906,720907,786443,786443,786444,851980,917516,851980,917516,655370,458759,524295,589832,655369,720905,720906,786442,786443,851979,786443,851979,851980,851980,917516,917517,720905,589832,589832,655369,720905,720906,786442,786442,786443,851979,851979,917515,917516,917516,983052,983052,786441,655369,655369,720905,720906,786442,786442,851978,851979,851979,917515,917516,917516,983052,983052,983053,720905,655370,655369,720906,720906,786442,851978,851979,917515,851979,917515,917516,983052,983052,983052,1048588,786441,720906,720906,720906,786442,851978,851979,851979,851979,917515,917516,917516,917516,983052,983052,1048589,786441,720907,720906,786442,786442,851979,851979,851979,917515,917516,983052,983052,983052,983052,1114125,1114125,786442,720907,786443,786443,851979,851979,851979,917515,917515,983051,983052,983052,983052,1048588,1048589,1048589,786442,786443,786443,786443,851979,851979,917515,917515,983052,983052,983052,983052,1048588,983053,1048589,983053,851978,786444,851979,786443,851979,917515,917516,917516,917516,983052,1048588,1048588,1048589,1114125,1114125,1048589,786442,851980,851980,851979,851979,917515,917516,983052,1048588,1048588,1048588,1048588,1048589,1048589,983053,1048589,851978,851980,917516,917516,917516,917516,983052,983052,983052,983052,1114124,1048589,1048589,1048589,1048589,1179661,851978,983052,917516,917516,917516,983052,983052,1048588,1048588,1048589,1179661,1114125,1114125,1114125,1245197,1114125,851978,917517,983052,851980,917516,1048588,1048588,983052,1048589,1048589,1114125,1179661,1114125,1245197,1114125,1048589,851978,655369,655369,655369,720905,720905,786441,786441,786441,851977,851977,851977,851978,851978,851978,851978,655366],oe.table23=[65538,262147,458759,262148,327684,458759,393222,458759,524296],oe.table56=[65539,262148,458758,524296,262148,327684,524294,589831,458757,524294,589831,655368,524295,524295,589832,655369],oe.bitrate_table=[[0,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1],[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],[0,8,16,24,32,40,48,56,64,-1,-1,-1,-1,-1,-1,-1]],oe.samplerate_table=[[22050,24e3,16e3,-1],[44100,48e3,32e3,-1],[11025,12e3,8e3,-1]],oe.scfsi_band=[0,6,11,16,21],x.Q_MAX=257,x.Q_MAX2=116,x.LARGE_BITS=1e5,x.IXMAX_VAL=8206;var _e={};_e.SFBMAX=3*H.SBMAX_s,H.ENCDELAY=576,H.POSTDELAY=1152,H.MDCTDELAY=48,H.FFTOFFSET=224+H.MDCTDELAY,H.DECDELAY=528,H.SBLIMIT=32,H.CBANDS=64,H.SBPSY_l=21,H.SBPSY_s=12,H.SBMAX_l=22,H.SBMAX_s=13,H.PSFB21=6,H.PSFB12=6,H.BLKSIZE=1024,H.HBLKSIZE=H.BLKSIZE/2+1,H.BLKSIZE_s=256,H.HBLKSIZE_s=H.BLKSIZE_s/2+1,H.NORM_TYPE=0,H.START_TYPE=1,H.SHORT_TYPE=2,H.STOP_TYPE=3,H.MPG_MD_LR_LR=0,H.MPG_MD_LR_I=1,H.MPG_MD_MS_LR=2,H.MPG_MD_MS_I=3,H.fircoef=[-.1039435,-.1892065,5*-.0432472,-.155915,3898045e-23,5*.0467745,.50455,.756825,5*.187098],X.MFSIZE=3456+H.ENCDELAY-H.MDCTDELAY,X.MAX_HEADER_BUF=256,X.MAX_BITS_PER_CHANNEL=4095,X.MAX_BITS_PER_GRANULE=7680,X.BPC=320,U.RIFF=Z("RIFF"),U.WAVE=Z("WAVE"),U.fmt_=Z("fmt "),U.data=Z("data"),U.readHeader=function(e){var t=new U,a=e.getUint32(0,!1);if(U.RIFF==a&&(e.getUint32(4,!0),U.WAVE==e.getUint32(8,!1)&&U.fmt_==e.getUint32(12,!1))){var s=e.getUint32(16,!0),n=20;switch(s){case 16:case 18:t.channels=e.getUint16(n+2,!0),t.sampleRate=e.getUint32(n+4,!0);break;default:throw"extended fmt chunk not implemented"}n+=s,s=U.data;for(var r=0;s!=a&&(a=e.getUint32(n,!1),r=e.getUint32(n+4,!0),s!=a);)n+=r+8;return t.dataLen=r,t.dataOffset=n+8,t}},_e.SFBMAX=3*H.SBMAX_s,s.Mp3Encoder=function(e,t,a){3!=arguments.length&&(console.error("WARN: Mp3Encoder(channels, samplerate, kbps) not specified"),e=1,t=44100,a=128);var s=new q,n=new j,r=new h,i=new m,o=new p,_=new x,l=new P,f=new v,g=new u,S=new K,R=new d,A=new b,B=new z,w=new G;s.setModules(r,i,o,_,l,f,g,S,w),i.setModules(r,w,g,f),S.setModules(i,g),o.setModules(s),l.setModules(i,R,_,A),_.setModules(A,R,s.enc.psy),R.setModules(i),A.setModules(_),f.setModules(s,i,g),n.setModules(B,w),B.setModules(g,S,o);var y=s.lame_init();y.num_channels=e,y.in_samplerate=t,y.brate=a,y.mode=c.STEREO,y.quality=3,y.bWriteVbrTag=!1,y.disable_reservoir=!0,y.write_id3tag_automatic=!1,s.lame_init_params(y);var k=1152,T=0|1.25*k+7200,E=new Int8Array(T);this.encodeBuffer=function(t,a){return 1==e&&(a=t),t.length>k&&(k=t.length,T=0|1.25*k+7200,E=new Int8Array(T)),t=s.lame_encode_buffer(y,t,a,t.length,E,0,T),new Int8Array(E.subarray(0,t))},this.flush=function(){var e=s.lame_encode_flush(y,E,0,T);return new Int8Array(E.subarray(0,e))}},s.WavHeader=U}var n=Math.pow,r=Math.max,i=Math.min,o=a(18),_=a.n(o),l=a(125),f=a.n(l),c=a(135),u=a.n(c),h=a(136),p=a.n(h),b=a(16),d=a.n(b),m=a(129),v=a.n(m),g=a(130),S=a.n(g),R=a(113),A=a.n(R),B=function(){function e(t,a){var s=this;v()(this,e),this.config={bufferLen:512,numChannels:2,mimeType:"audio/wav"},this.recording=!1,this.callbacks={getBuffer:[],exportWAV:[]};var n=a.volume||100;delete a.volume,d()(this.config,a),this.context=t.context,this.node=this.context.createScriptProcessor.call(this.context,this.config.bufferLen,this.config.numChannels,this.config.numChannels);var r=this.context.createGain();t.connect(r),r.connect(this.node),r.gain.value=(n/100).toFixed(1),this.analyser=this.context.createAnalyser(),t.connect(this.analyser),this.analyser.connect(this.node),this.node.connect(this.context.destination),this.analyser.fftSize=this.config.bufferLen;var i=new Uint8Array(this.config.bufferLen);this.analyser.getByteFrequencyData(i),this.node.onaudioprocess=function(e){if(s.recording){for(var t=[],a=0;a<s.config.numChannels;a++)t.push(e.inputBuffer.getChannelData(a));s.worker.postMessage({command:"record",buffer:t})}},this.worker=new A.a((function(){function e(){for(var e=[],t=0;t<n;t++)e.push(s(i[t],r));var a;a=2===n?function(e,t){for(var a=e.length+t.length,s=new Float32Array(a),n=0,r=0;n<a;)s[n++]=e[r],s[n++]=t[r],r++;return s}(e[0],e[1]):e[0],this.postMessage({command:"exportWAV",data:a})}function t(){for(var e=[],t=0;t<n;t++)e.push(s(i[t],r));this.postMessage({command:"getBuffer",data:e})}function a(){for(var e=0;e<n;e++)i[e]=[]}function s(e,t){for(var a=new Float32Array(t),s=0,n=0;n<e.length;n++)a.set(e[n],s),s+=e[n].length;return a}var n,r=0,i=[];this.onmessage=function(s){switch(s.data.command){case"init":!function(e){e.sampleRate,n=e.numChannels,a()}(s.data.config);break;case"record":!function(e){for(var t=0;t<n;t++)i[t].push(e[t]);r+=e[0].length}(s.data.buffer);break;case"exportWAV":e(s.data.type);break;case"getBuffer":t();break;case"clear":r=0,i=[],a()}}}),{}),this.worker.postMessage({command:"init",config:{sampleRate:this.context.sampleRate,numChannels:this.config.numChannels}}),this.worker.onmessage=function(e){var t=s.callbacks[e.data.command].pop();"function"==typeof t&&t(e.data.data)}}return S()(e,[{key:"record",value:function(){this.recording=!0}},{key:"stop",value:function(){this.recording=!1}},{key:"clear",value:function(){this.worker.postMessage({command:"clear"})}},{key:"getBuffer",value:function(e){if(!(e=e||this.config.callback))throw new Error("Callback not set");this.callbacks.getBuffer.push(e),this.worker.postMessage({command:"getBuffer"})}},{key:"exportWAV",value:function(e,t){if(t=t||this.config.mimeType,!(e=e||this.config.callback))throw new Error("Callback not set");this.callbacks.exportWAV.push(e),this.worker.postMessage({command:"exportWAV",type:t})}},{key:"forceDownload",value:function(e,t){var a=(window.URL||window.webkitURL).createObjectURL(e),s=window.document.createElement("a");s.href=a,s.download=t||"output.wav";var n=document.createEvent("Event");n.initEvent("click",!0,!0),s.dispatchEvent(n)}}]),e}(),w=a(263),y=a.n(w),k=a(171),T=a.n(k),E=function(){function e(t){v()(this,e),this.config=t,this.samples=t.float32Array,this.numChannels=t.channels,this.sampleBits=t.sampleBits,this.sampleRate=t.sampleRate}return S()(e,[{key:"toWavBlob",value:function(e){var t=this.config.samples||[],a=this.config.numChannels,s=this.config.sampleBits,n=this.config.sampleRate,o=function(e,t,a){for(var s=0;s<a.length;s++)e.setUint8(t+s,a.charCodeAt(s))},_=t.length*(s/8),l=new ArrayBuffer(44+_),f=new DataView(l);o(f,0,"RIFF"),f.setUint32(4,36+_,!0),o(f,8,"WAVE"),o(f,12,"fmt "),f.setUint32(16,16,!0),f.setUint16(20,1,!0),f.setUint16(22,a,!0),f.setUint32(24,n,!0),f.setUint32(28,n*a*(s/8),!0),f.setUint16(32,a*(s/8),!0),f.setUint16(34,s,!0),o(f,36,"data"),f.setUint32(40,_,!0),16==s?function(e,t,a){for(var s,n=0;n<a.length;n++,t+=2)s=r(-1,i(1,a[n])),e.setInt16(t,0>s?32768*s:32767*s,!0)}(f,44,t):function(e,t,a){for(var s=0;s<a.length;s++,t++){var n=r(-1,i(1,a[s])),o=0>n?32768*n:32767*n;o=parseInt(255/(65535/(o+32768))),e.setInt8(t,o,!0)}}(f,44,t),e(new Blob([f],{type:"audio/wav"}))}},{key:"toMP3Blob",value:function(e){var t=this,a="id_"+Date.now();console.log(a+":","开始转换.........");var s=this.toWavBlob(),n=(s.size,new FileReader);Date.now();n.onload=function(a){console.log("开始转换......");var s=t.encodeToMp3Buf(a.target.result),n=new Blob(s,{type:"audio/mp3"});console.log("转换结束！"),console.log(n),e&&e instanceof Function&&e(n)},n.readAsArrayBuffer(s)}},{key:"encodeToMp3Buf",value:function(e){var t=s.WavHeader.readHeader(new DataView(e)),a=[],n=[],r=[],i=void 0,o=1152;if(console.log("wav",t),!t)return console.log("不是一个wav文件！");var _=new Int16Array(e,t.dataOffset,t.dataLen/2);if(a=1===t.channels?_:new Int16Array(t.dataLen/(2*t.channels)),n=2===t.channels?new Int16Array(t.dataLen/(2*t.channels)):void 0,1<t.channels)for(var l=0;l<a.length;l++)a[l]=_[2*l],n[l]=_[2*l+1];i=new s.Mp3Encoder(t.channels,t.samplesRate,this.config.bitRate||96);for(var f=a.length,c=0;f>=o;c+=o){var u=a.subarray(c,c+o),h=void 0;n&&(h=n.subarray(c,c+o));var p=i.encodeBuffer(u,h);r.push(new Int8Array(p)),f-=o}var b=i.flush();return r.push(new Int8Array(b)),r}}]),e}();s();var x=new y.a;t.a=function(e){var t=this;this.supported=!1,this.ready=!1,this.audioCtx=null,this.recorder=null,this.recording=!1,this.deviceChangeTimes=0,this.defaultAudioInputDeviceId=null,this.currentAudioInputDeviceId=null,this.audioInputList=[],this.audioOutputList=[],this.audioRecordOriginal=[],this.checkTimer=null,this.events={},this.recordFilePath="",this.option=e||null,this.init=p()(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{t.audioCtx&&(t.closeAudioContext(),t.recorder=null),t.audioCtx=t.audioCtx||new AudioContext,t.supported=!0}catch(e){t.supported=!1,console.log("No web audio support in this browser!",e)}return e.prev=1,e.next=4,t.getAudioInputList();case 4:return e.next=6,t.getComputerDefaultAudioInput();case 6:return e.next=8,t.ensureAudioInput();case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(1),console.log(e.t0);case 13:case"end":return e.stop()}}),e,t,[[1,10]])}))),this.getAudioInputList=function(){return new f.a((function(e,a){navigator.mediaDevices.enumerateDevices().then((function(a){var s=a.filter((function(e){return"audioinput"===e.kind})),n=a.filter((function(e){return"audiooutput"===e.kind}));t.audioOutputList=n,t.audioInputList=s,e(s)})).catch((function(e){a(e)}))}))},this.getComputerDefaultAudioInput=function(){var e=t.audioInputList||[];if(0===e.length)return!1;var a=e.filter((function(e){return"default"===e.deviceId}))[0].groupId,s=e.filter((function(e){return e.groupId===a&&"default"!==e.deviceId}))[0];return s&&(t.defaultAudioInputDeviceId=s.deviceId),s},this.ensureAudioInput=function(){return 0===t.audioInputList.length?(t.fire("ready"),!1):(t.initAudioInput(),void(t.currentAudioInputDeviceId=t.defaultAudioInputDeviceId))},this.useSpecifyEarphone=function(e){e&&(t.initAudioInput({audio:{deviceId:{exact:e}}}),t.currentAudioInputDeviceId=t.deviceId)},this.initAudioInput=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{audio:!0};navigator.getUserMedia(e,t.getAudioStream,(function(e){console.log("设备不支持或用户拒绝授权：",e),t.supported=!1,t.fire("ready")}))},this.getAudioStream=function(e){try{var a=t.audioCtx.createMediaStreamSource(e);t.recorder=new B(a,{numChannels:1,sampleBits:16,sampleRate:44100,compressRate:1,volume:t.option&&t.option.volume?t.option.volume:40}),t.supported=!0}catch(e){console.log("创建音频源失败，原因：",e),t.supported=!1}t.fire("ready")},this.listenDeviceChange=function(){navigator.mediaDevices.ondevicechange=function(){var e=p()(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.deviceChangeTimes++,0!=t.deviceChangeTimes%2){e.next=9;break}return e.next=4,t.getAudioInputList();case 4:return e.next=6,t.getComputerDefaultAudioInput();case 6:t.fire("devicechange"),e.next=11;break;case 9:t.lastAudioInputList=JSON.parse(_()(t.audioInputList)),t.lastAudioInputDeviceId=t.currentAudioInputDeviceId;case 11:case"end":return e.stop()}}),e,t)})));return function(){return e.apply(this,arguments)}}()},this.reInit=function(){t.stopRecord("ignoreFile"),t.init()},this.startRecord=function(){t.recording||(t.recorder&&t.recorder.record(),t.recording=!0,t.recorder&&t.recorder.node.addEventListener("audioprocess",t.onAudioProcess))},this.stopRecord=function(e,a){t.recording&&(t.recorder&&t.recorder.stop(),t.recording=!1,t.recorder&&t.recorder.node.removeEventListener("audioprocess",t.onAudioProcess),!e&&(a&&(t.recordFilePath=a),t.handleAudioData()),t.recorder&&t.recorder.clear())},this.checkDevice=function(e){return!e||isNaN(e)?void 0:t.recording?console.log("Recorder is busy!"):(t.recorder&&t.recorder.record(),t.recorder&&t.recorder.node.addEventListener("audioprocess",t.collectRecordBuffers),t.recording=!0,void(t.checkTimer=setInterval((function(){if(0>=e){t.stopCheckDevice();var a=t.analyIsVocalByRecord(t.audioRecordOriginal);t.fire("checkEnd",a),t.recorder&&t.recorder.clear()}e--}),1e3)))},this.stopCheckDevice=function(){t.recorder&&t.recorder.stop(),t.recorder&&t.recorder.node.removeEventListener("audioprocess",t.collectRecordBuffers),t.recording=!1,clearInterval(t.checkTimer),t.checkTimer=null},this.onAudioProcess=function(){var e=new Uint8Array(256);t.recorder&&t.recorder.analyser.getByteFrequencyData(e),t.fire("audioprocess",e)},this.collectRecordBuffers=function(){var e=new Uint8Array(256);t.recorder&&t.recorder.analyser.getByteFrequencyData(e),t.audioRecordOriginal.push(e[0]),t.fire("audioprocess",e)},this.analyIsVocalByRecord=function(e){if(e&&e.length){var t,a=0;return a=e.reduce((function(e,t){return e+t}),0),t=a/e.length,.3<(a=e.reduce((function(e,a){return e+n(a-t,2)}),0))/e.length}},this.handleAudioData=function(){t.recorder&&t.recorder.exportWAV((function(e){var a=t.recorder.config.sampleBits,s=t.recorder.config.numChannels;new E({samples:e,numChannels:s,sampleBits:a,sampleRate:44100}).toWavBlob((function(e){t.saveAudioDataToLocalFile(e)}))}))},this.saveAudioDataToLocalFile=function(e){var a=new FileReader;a.onload=function(e){var a=t.arrayBuffer2buffer(e.target.result);x.writeFile(t.recordFilePath||"test.mp3",a,!0),t.recordFilePath="",t.fire("save")},a.readAsArrayBuffer(e)},this.arrayBuffer2buffer=function(e){return Buffer.from(e)},this.on=function(e,a){t.events[e]?t.events[e].funcs=[a]:t.events[e]={funcs:[a]}},this.fire=function(e,a,s){t.events&&t.events[e]&&(t.events[e].funcs||[]).forEach((function(e){e&&"function"==typeof e&&e(a,s)}))},this.removeEvent=function(e){return"all"===e?(t.events=null,!1):void(!t.events[e]||(t.events[e].funcs=[]))},this.closeAudioContext=function(){t.audioCtx.close(),t.audioCtx=null},this.destroy=function(){return t.closeAudioContext(),t.recorder&&(t.recorder.stop(),t.recorder.clear(),t.recorder=null),t.events=null,navigator.mediaDevices.ondevicechange=null,null},this.init(),this.listenDeviceChange()}},145:function(){},263:function(e,t,a){var s=a(102),n=a(103);e.exports=function(e){function t(e,t){if(t)return e;var n="/"==e.substr(0,1)||"\\"==e.substr(0,1)?".":"",r=s.join(a,n+e);return s.normalize(r)}var a=e||process.cwd();this.existsFile=function(e,a){return n.existsSync(t(e,a))},this.existsPath=function(e,a){return n.existsSync(t(e,a)).isDirectory()},this.setWorkSpace=function(e){a=e||process.cwd()},this.getWorkSpace=function(){return a},this.copyPath=function(e,a,r){var i=t(e,r),o=t(a,r);return n.existsSync(i)?(n.existsSync(o+s.sep)||n.mkdirSync(o+s.sep),function e(t,a){var r=[];return n.readdirSync(t).forEach((function(i){var o=s.join(t,i),_=s.join(a,i),l=n.statSync(o);l.isFile()?(r.push(o),n.writeFileSync(_,n.readFileSync(o))):l.isDirectory()&&(r.push(o+s.sep),!n.existsSync(_)&&n.mkdirSync(_),r=r.concat(e(o,_)))})),r}(i,o)):[]},this.copyFile=function(e,a,s){var r=t(e,s),i=t(a,s);n.writeFileSync(i,n.readFileSync(r))},this.readFile=function(e,a,s){return n.readFileSync(t(e,s),a)},this.readDir=function(e,a){return n.readdirSync(t(e,a))},this.mkdirs=function(e,a){var r=t(e,a),i=s.parse(r),o=i.dir.substr(i.root.length).split(s.sep),_=i.root;o.forEach((function(e){e&&(_+=e+s.sep,n.existsSync(_)||n.mkdirSync(_))}))},this.fileState=function(e,a){return n.statSync(t(e,a))},this.writeFile=function(e,a,s){var r=t(e,s);this.mkdirs(r,!0);var i=n.openSync(r,"w"),o=n.writeFileSync(i,a);return n.closeSync(i),o},this.findFile=function(e,a,r){return function e(t){var r=[];return n.existsSync(t)?(n.readdirSync(t).forEach((function(i){var o=s.join(t,i),_=n.statSync(o);_.isFile()?(a&&a.test&&a.test(o),r.push(o)):_.isDirectory()&&(r=r.concat(e(o)))})),r):r}(t(e,r))},this.deletePath=function(e,a){!function e(t){n.existsSync(t)&&(n.readdirSync(t).forEach((function(a){var r=t+s.sep+a;n.statSync(r).isDirectory()?e(r):n.unlinkSync(r)})),n.rmdirSync(t))}(t(e,a))}}}}]);